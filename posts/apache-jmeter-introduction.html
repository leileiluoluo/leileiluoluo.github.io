<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>Apache JMeter 初探 - 磊磊落落</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=keywords content="JMeter,自动化测试,性能测试,负载测试,压力测试"><meta name=description content="Apache JMeter 初探。本文分三部分对 JMeter 进行初探：首先会梳理 JMeter 中常用的一些概念或组件；接着会介绍 JMeter 的下载与安装；最后会对其进行简单的使用，即构建一个 Web 测试计划。"><meta name=author content="磊磊落落"><meta name=generator content="Hugo 0.123.7"><link rel=stylesheet href=https://leileiluoluo.github.io/css/bootstrap.min.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/themify-icons.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/larry-custom-v1.6.css><link rel=stylesheet href=https://leileiluoluo.github.io/scss/style.min.css media=screen><link rel="shortcut icon" href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><link rel=icon href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?526723b767317055572c85bdb445353c",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><header class="fixed-top navigation"><div class=container><nav class="navbar navbar-expand-lg navbar-light bg-transparent"><a class=navbar-brand href=https://leileiluoluo.github.io/>磊磊落落</a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/></a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/>计算机</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E9%9A%8F%E7%AC%94/>随笔</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AF%BB%E4%B9%A6/>读书</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%A7%82%E5%BD%B1/>观影</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E7%BB%83%E5%AD%97/>练字</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/about>关于</a></li></ul><div class=search><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://leileiluoluo.github.io//search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder=键入关键字后回车...></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><div class="py-5 d-none d-lg-block"></div><section class=section><div class=container><div class=row><div class="col-lg-8 mx-auto block shadow mb-5"><h1>Apache JMeter 初探</h1><div class="mb-3 post-meta">2022年07月27日
<a href=/categories/%e8%ae%a1%e7%ae%97%e6%9c%ba>计算机</a></div><div class="content mb-5"><p>Apache JMeter 是一个使用纯 Java 编写的、由 Apache 软件基金会开源的、用于度量软件性能的负载测试工具。</p><p>其最初是为了测试 Web 应用而设计，但后来支持测试的应用类型已非常丰富。</p><p>JMeter 目前支持测试的协议或应用类型具体如下：</p><ul><li>Web - HTTP、HTTPS（实现语言可以是 Java、NodeJS、PHP 及 ASP.NET 等）</li><li>SOAP 或 REST Web 服务</li><li>FTP</li><li>数据库（使用 JDBC）</li><li>LDAP</li><li>面向消息的中间件（使用 JMS）</li><li>邮件功能 - SMTP(S)、POP3(S) 或 IMAP(S)</li><li>原生命令或 Shell 脚本</li><li>TCP</li><li>Java 对象</li></ul><p>此外，JMeter 还具有如下特性：</p><ul><li>GUI 模式功能齐全，支持从浏览器或原生应用录制测试计划，支持调试。</li><li>命令行模式支持在任何可以运行 Java 的操作系统上进行负载测试。</li><li>HTML 报告功能丰富，易于使用。</li><li>可以非常方便的从 HTML、JSON、XML 等流行的文本响应格式中提取数据。</li><li>以多线程方式来模拟并发访问。</li><li>支持通过插件来扩展数据可视化能力。</li><li>支持脚本化采样器（可使用诸如 Groovy 与 BeanShell 等 JSR223 兼容的语言来编写采样脚本）。</li></ul><p><strong><em>需要注意的是 JMeter 不是浏览器，其在协议级别工作。不会像浏览器一样解析 JavaScript，也不会渲染页面。</em></strong></p><p>本文接下来分三部分对 JMeter 进行初探：首先会梳理 JMeter 中常用的一些概念或组件；接着会介绍 JMeter 的下载与安装；最后会对其进行简单的使用，即构建一个 Web 测试计划。</p><h3 id=1-概念梳理>1 概念梳理</h3><p>JMeter 中常用的一些概念或组件梳理如下。</p><ul><li><p>测试计划（Test Plan）</p><p>测试计划是 JMeter 整个测试任务树的根结点。</p></li><li><p>线程组（Thread Group）</p><p>线程组用于模拟执行测试的一组用户，是测试计划的起始点。控制器（Controller）及采样器（Sampler）必须置于线程组下；诸如监听器（Listener）等虽可以直接置于测试计划下，但会应用到所有的线程组。线程组用于设置线程数、加速期及循环次数。</p><p>多个线程用于模拟对服务器应用的并发访问，线程之间相互独立，各自完整的执行测试计划。</p><p>加速期（Ramp-up）用于告诉 JMeter 需要多长时间来“加速到”设定的全部线程数量。如设置线程数为 30，加速期为 120 秒，每个线程将会在上一个线程启动 4（120/30）秒后启动。需要根据实际需求来设定加速期。加速期设置的太短会导致在测试开始时工作负载太大；而设置的太长又会使负载太小，而没有达到预期的并发量（即第一个线程已完成工作，而最后一个线程还没启动运行）。</p></li><li><p>逻辑控制器（Logic Controller）</p><p>JMeter 有采样器（Sampler）和逻辑控制器（Logic Controller）两类控制器。</p><p>逻辑控制器用于控制采样器的处理顺序。</p><p>常见的逻辑控制器有 Simple Controller、Loop Controller 和 If Controller 等。Simple Controller 没什么别的功能，只用于将其它逻辑控制器或采样器进行组合；Loop Controller 用于对其它逻辑控制器或采样器执行多次（如将一个 HTTP Request 采样器添加到循环次数为 2 的 Loop Controller，并将 Thread Group 循环次数配置为 3，那么 JMeter 将总共执行 2 * 3 = 6 次 HTTP Request）；If Controller 用于控制在其下的测试元素是否执行。</p></li><li><p>采样器（Sampler）</p><p>采样器用于对被测试应用发起请求。每个采样器都会生成一组采样结果（有成功/失败、耗时、数据大小等属性），这些采样结果可在监听器（Listener）中查看。</p><p>常用的采样器有 HTTP Request、FTP Request 和 JDBC Request 等。HTTP Request 用于向 Web 服务器发送 HTTP/HTTPS 请求；FTP Request 用于向 FTP 服务器发送“检索文件”或“上传文件”请求；JDBC Request 用于向数据库发送 JDBC 请求（SQL 查询）。</p></li><li><p>监听器（Listener）</p><p>监听器用于监听、保存和读取测试结果，一般在测试流程的最后执行。默认情况下测试结果保存在一个后缀为<code>.jtl</code>的 XML 文件里。</p><p>常用的监听器有 Graph Results 和 View Results in Table 等。Graph Results 会将测试结果以图形的方式显示（很直观，但很占用内存和 CPU，所以仅在 GUI 端调试测试用例时使用）；View Results in Table 会将测试结果按表格方式显示，也仅在调试用例时使用。</p></li><li><p>配置元素（Configuration Element）</p><p>配置元素可用来设置变量和默认值以供后面的采样器使用。</p><p>常用的配置元素有 CSV Data Set Config、HTTP Header Manager 等。CSV Data Set Config 用于从文件中读取行，并将它们拆分为变量；HTTP Header Manager 用于设置 HTTP 请求头参数，以供多个 HTTP Request 采样器复用。</p></li><li><p>断言（Assertion）</p><p>断言用于对采样器结果执行额外的检查，一般会添加到对应的采样器下。</p><p>常用的断言有 Response Assertion 等。Response Assertion 用于断言响应体是否包含或匹配某个指定的字符串。</p></li><li><p>计时器（Timer）</p><p>计时器用于控制采样的时间间隔。</p><p>常用的计时器有 Constant Timer 等。Constant Timer 会将每个线程在请求之前暂停相同的时间。</p></li><li><p>预处理器（Pre Processor）</p><p>预处理器用于在采样器执行前做一些前置工作。</p><p>常用的预处理器有 JSR223 PreProcessor 等。JSR223 PreProcessor 允许在采样前使用 JSR223 脚本代码做一些前置工作。</p></li><li><p>后处理器（Post Processor）</p><p>后处理器用于在采样器执行后做一些后置工作。</p><p>常用的后处理器有 Regular Expression Extractor、XPath Extractor 等。Regular Expression Extractor 允许用户使用正则表达式从响应中提取信息；XPath Extractor 允许用户使用 XPath 查询语言从响应（XML 或 HTML）中提取信息。</p></li></ul><p>JMeter 中常用的一些概念或组件即梳理完了。下面接着介绍下 JMeter 的下载与安装。最后会对 JMeter 进行一些初步的使用。</p><h3 id=2-下载安装>2 下载安装</h3><p><strong><em>安装 JMeter 前请确保已安装 JDK，且保证版本为 1.8 及以上。</em></strong></p><p>从官网（<a href=http://jmeter.apache.org/download_jmeter.cgi>http://jmeter.apache.org/download_jmeter.cgi</a>）下载最新版的 JMeter 压缩包，解压至指定文件夹，并设置系统环境变量。键入<code>jmeter --version</code>命令能正常输出版本号，即说明安装成功。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>jmeter --version
</span></span></code></pre></div><h3 id=3-构建一个-web-测试计划>3 构建一个 Web 测试计划</h3><p>该部分以测试<code>jmeter.apache.org</code>做示例，演示如何创建一个用于测试 Web 站点的最基本的测试计划。我们会创建 5 个用户，对 JMeter 网站的 2 个页面发送请求，并且会让用户运行 2 次这样的测试。所以，请求总数为：(5 个用户) x (2 个请求) x (重复 2 次) = 20 个 HTTP 请求。要构建测试计划，将用到如下元素：线程组（Thread Group）、HTTP Request、HTTP Request Defaults 和 Graph Results.</p><p>具体步骤如下：</p><ul><li><p>添加用户</p><p>每个 JMeter 测试计划的第一步都是添加一个线程组（Thread Group）。线程组会告诉 JMeter 用于模拟的用户数量及用户发送请求的频率和数目。</p><p>选择 Test Plan，然后单击鼠标右键，选择 Add -> Threads -> Thread Group，即可看到 Thread Group 元素的控制面板。</p><p>接下来，修改默认属性值：将 Number of Threads 修改为 5；Ramp-up period 使用默认值 1（其为启动每个用户的延迟时间，假设有 5 个用户，Ramp-up period 为 5，则意味着每隔 1 秒启动一个用户）；将 Loop Count 设置为 2（该属性告诉 JMeter 重复执行测试的次数）。</p><p>修改后的 Thread Group 如下图所示。</p><p><img loading=lazy src=https://leileiluoluo.github.io/static/images/uploads/2022/07/jmeter-thread-group.png#center alt="Thread Group"></p></li><li><p>添加默认 HTTP 请求属性</p><p>上一步定义好了用户，现在开始定义它们要执行的任务。</p><p>这一步指定 HTTP 请求的默认设置，从而为下一步的 HTTP Request 元素所使用。</p><p>选择 Thread Group，然后单击鼠标右键，选择 Add -> Config Element -> HTTP Request Defaults，即可看到 HTTP Request Defaults 的控制面板。</p><p>接下来，填写属性值：将 Server Name or IP 填写为 jmeter.apache.org（对于我们正在构建的测试计划，所有 HTTP 请求都将发送到该服务器）；其它字段无需填写，采用默认值即可。</p><p><strong><em>HTTP Request Defaults 元素不会告诉 JMeter 发送 HTTP 请求，它只是定义了 HTTP Request 元素使用的默认值。</em></strong></p><p>配置后的 HTTP Request Defaults 如下图所示。</p><p><img loading=lazy src=https://leileiluoluo.github.io/static/images/uploads/2022/07/jmeter-http-request-defaults.png#center alt="HTTP Request Defaults"></p></li><li><p>添加 Cookie 支持</p><p>几乎绝大多数的网站都需要 Cookie 支持。</p><p>欲添加 Cookie 支持，需要在测试计划的每个 Thread Group 下添加一个 HTTP Cookie Manager。这将确保每个线程都有自己的 Cookie，但在所有 HTTP Request 对象之间共享。</p><p>添加方式为：选择 Thread Group，然后单击鼠标右键，选择 Add -> Config Element -> HTTP Cookie Manager，即可看到 HTTP Cookie Manager 的控制面板。</p><p>添加 HTTP Cookie Manager 后的 Test Plan 如下图所示。</p><p><img loading=lazy src=https://leileiluoluo.github.io/static/images/uploads/2022/07/jmeter-http-cookie-manager.png#center alt="HTTP Cookie Manager"></p></li><li><p>添加 HTTP 请求</p><p>在我们的 Test Plan 中，会对两个页面发送 HTTP 请求。第一个是 JMeter Home 页（http://jmeter.apache.org/），第二个是 Changes 页（http://jmeter.apache.org/changes.html）。</p><p><strong><em>JMeter 会按照 HTTP Request 在树中出现的顺序依次发送请求。</em></strong></p><p>HTTP Request 添加方式为：选择 Thread Group，然后单击鼠标右键，选择 Add -> Sampler -> HTTP Request，即可看到 HTTP Request 的控制面板。</p><p>先添加第一个：将 Name 字段填写为 “Home Page”；将 Path 字段填写为 “/”。Server Name or IP 字段无需填写，因为已在 HTTP Request Defaults 元素中设置。</p><p>第一个 HTTP Request 添加完后，如下图所示。</p><p><img loading=lazy src=https://leileiluoluo.github.io/static/images/uploads/2022/07/jmeter-http-request-home-page.png#center alt="HTTP Request"></p><p>再添加第二个：将 Name 字段填写为 “Changes”；将 Path 字段填写为 “/changes.html”。</p><p>第二个 HTTP Request 添加完后，如下图所示。</p><p><img loading=lazy src=https://leileiluoluo.github.io/static/images/uploads/2022/07/jmeter-http-request-changes-page.png#center alt="HTTP Request"></p></li><li><p>添加监听器以查看测试结果</p><p>最后一个要添加的元素是一个 Listener，名为 View Results Tree，用于查看每个请求的发送次序及响应结果。</p><p>添加方式为：选择 Thread Group，然后单击鼠标右键，选择 Add -> Listener -> View Results Tree 即可。</p><p>添加 View Results Tree 后的 Test Plan 如下图所示。</p><p><img loading=lazy src=https://leileiluoluo.github.io/static/images/uploads/2022/07/jmeter-view-results-tree.png#center alt="View Results Tree"></p></li></ul><p>所有步骤已配置完成，最终的<code>jmx</code>文件（<code>build-web-test-plan.jmx</code>）已托管至 <a href=https://github.com/leileiluoluo/daily-exercises/blob/main/jmeter/build-web-test-plan.jmx>本人 GitHub</a>。</p><p>点击 Start 即可在 GUI 端调试运行。运行结果如下图所示：</p><p><img loading=lazy src=https://leileiluoluo.github.io/static/images/uploads/2022/07/jmeter-view-results-tree-result.png#center alt="View Results Tree Result"></p><p>可以在 View Results Tree 看到，一共发送了 20 次请求，点击某个请求可查看具体的采样结果和响应信息。</p><p>真正做负载测试时，需要使用命令行模式进行。</p><p>基于<code>jmx</code>文件执行测试，生成结果数据文件以及生成报告文件夹的命令如下：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>jmeter -n -t build-web-test-plan.jmx -l build-web-test-plan.jtl -e -o build-web-test-plan.report
</span></span></code></pre></div><p>执行完成后，打开报告文件夹（<code>build-web-test-plan.report</code>）的<code>index.html</code>文件，即可看到测试报告。效果如下图所示。</p><p><img loading=lazy src=https://leileiluoluo.github.io/static/images/uploads/2022/07/jmeter-report.png#center alt=Report></p><br><p>综上，完成了对 JMeter 的初探。</p><blockquote><p>参考资料</p><p>[1] <a href=https://jmeter.apache.org/index.html>Apache JMeter - apache.org</a></p><p>[2] <a href=https://cwiki.apache.org/confluence/display/JMETER/Home>JMeter Wiki - cwiki.apache.org</a></p><p>[3] <a href=https://github.com/apache/jmeter>Apache JMeter - GitHub</a></p></blockquote></div><div class=content-footer><div class=weixinhao><img src=/static/images/self/weixinhao-white.jpg></div><div class=post-tags><a href=/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/>#自动化测试</a>
<a href=/tags/jmeter/>#JMeter</a></div><div class=license><i class=ti-info-alt></i><div class=info>版权声明：该博客文章由作者通过「<a href=https://creativecommons.org/licenses/by/4.0/deed.zh>知识共享署名 4.0 许可证</a>」进行授权，转载须注明文章原始链接。</div></div></div></div><div class="col-lg-8 mx-auto block shadow"><h3>相关文章</h3><ul><li><a href=/posts/selenium-grid.html>Selenium Grid 搭建及使用</a></li><li><a href=/posts/serenity-bdd-cucumber-integration.html>Serenity BDD 如何与 Cucumber 进行集成？</a></li><li><a href=/posts/how-to-perform-api-testing-using-serenity-bdd.html>如何使用 Serenity BDD 进行 API 测试？</a></li><li><a href=/posts/how-to-write-ui-test-cases-using-screenplay-pattern.html>如何使用 Screenplay 模式编写 UI 测试用例？</a></li><li><a href=/posts/how-to-perform-ui-testing-using-serenity-bdd.html>如何使用 Serenity BDD 进行 UI 测试？</a></li></ul></div><div class="col-lg-8 mx-auto block shadow"><div><h3>评论</h3><div id=comment-loading style=text-align:center;font-size:14px><img style=width:52px src=/static/images/site/mona-loading-default.gif>
<span>正在加载评论......</span></div><script>function handleMessage(e){if(e.origin!=="https://giscus.app")return;if(typeof e.data!="object"||!e.data.giscus)return;const t=document.getElementById("comment-loading");t.style.display="none"}window.addEventListener("message",handleMessage)</script><script src=https://giscus.app/client.js data-repo=leileiluoluo/leileiluoluo.github.io data-repo-id=R_kgDOJkLT8w data-category=General data-category-id=DIC_kwDOJkLT884CdtEh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></div></div></section><footer class="py-4 bg-lights border-top"><div class=container><div class="row justify-content-between text-center align-items-center"><div class="col-lg-4 text-center text-lg-left mb-4 mb-lg-0"></div><div class="col-lg-4 text-center mb-4 mb-lg-0"><ul class="list-inline mb-0"><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/sponsor>随喜打赏</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/about>关于本博</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/links>友情链接</a></li></ul></div><div class="col-lg-4 text-lg-right text-center mb-4 mb-lg-0"><ul class="list-inline social-icon mb-0"><li class=list-inline-item><a title=文章归档 href=/archives/><i class=ti-archive></i></a></li><li class=list-inline-item><a title=文章标签 href=/tags/><i class=ti-tag></i></a></li><li class=list-inline-item><a title="我的 GitHub" href=https://github.com/leileiluoluo><i class=ti-github></i></a></li><li class=list-inline-item><a title="网站 RSS" href=/index.xml><i class=ti-rss></i></a></li></ul></div></div><div style=text-align:center;font-size:18px;margin-bottom:22px><a style="-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-image:linear-gradient(to right,#14100f,#d55b5b,#4d14e6)" href=https://www.boyouquan.com/planet-shuttle>「博友圈 · 星球穿梭」</a></div><div class="text-center mt-4"><span>Made with <a href=https://gohugo.io/>Hugo</a> | Theme by <a href=https://github.com/themefisher/northendlab-hugo>NorthendLab</a> | <a href=https://beian.miit.gov.cn>辽ICP备2022012085号-5</a> | Copyright © 2017-2024</span></div></div></footer><script>var indexURL="https://leileiluoluo.github.io/index.json"</script><script src=https://leileiluoluo.github.io/js/jquery.min.js></script><script src=https://leileiluoluo.github.io/js/bootstrap.min.js></script><script src=https://leileiluoluo.github.io/js/fuse.min.js></script><script src=https://leileiluoluo.github.io/js/mark.js></script><script src=https://leileiluoluo.github.io/js/search.js></script><script src=https://leileiluoluo.github.io/js/script.min.js></script></body></html>