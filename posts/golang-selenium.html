<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>Golang 使用 Selenium 实现自动化测试初探 - 磊磊落落</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=keywords content="Java,Golang,Python,云原生,架构设计,DevOps,自动化测试,技术博客,生活博客"><meta name=description content="我是浩然，一名软件开发工程师，我的博客「磊磊落落」建立于 2017 年，是我用于记录内心波澜，分享读书感想，思考人生哲学，关注社会百态，梳理计算机专业知识的纯原创站点。目前我在技术上主要关注：Java、Golang、Python、前端开发、云原生、架构设计、DevOps 和自动化测试。"><meta name=author content="磊磊落落"><meta name=generator content="Hugo 0.123.7"><link rel=stylesheet href=https://leileiluoluo.github.io/css/bootstrap.min.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/themify-icons.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/larry-custom-v1.6.css><link rel=stylesheet href=https://leileiluoluo.github.io/scss/style.min.css media=screen><link rel="shortcut icon" href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><link rel=icon href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?526723b767317055572c85bdb445353c",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><header class="fixed-top navigation"><div class=container><nav class="navbar navbar-expand-lg navbar-light bg-transparent"><a class=navbar-brand href=https://leileiluoluo.github.io/>磊磊落落</a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/></a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/>计算机</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E9%9A%8F%E7%AC%94/>随笔</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AF%BB%E4%B9%A6/>读书</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%A7%82%E5%BD%B1/>观影</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E7%BB%83%E5%AD%97/>练字</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/about>关于</a></li></ul><div class=search><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://leileiluoluo.github.io//search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder=键入关键字后回车...></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><div class="py-5 d-none d-lg-block"></div><section class=section><div class=container><div class=row><div class="col-lg-8 mx-auto block shadow mb-5"><h1>Golang 使用 Selenium 实现自动化测试初探</h1><div class="mb-3 post-meta">2020年03月14日
<a href=/categories/%e8%ae%a1%e7%ae%97%e6%9c%ba>计算机</a></div><div class="content mb-5"><p>Selenium 整合了一揽子工具与依赖库，支持 Web 浏览器自动化，提供一组扩展来模拟人与浏览器交互。我们基于其满足 W3C 标准的 WebDriver 来编写的自动化代码可在各种主流浏览器复用。</p><p>所以这里关键的一个组件即是 WebDriver，其负责与浏览器厂商提供的 API 来与浏览器交互。</p><p>使用其即可做出模拟终端用户的操作，如：文本框输入，下拉框选择，链接点击等。此外还提供鼠标移动，JavaScript 脚本执行等能力。</p><h3 id=1-环境准备>1 环境准备</h3><p>Selenium 提供多种执行方式：如在本机安装 WebDriver 二进制可执行文件，或安装单独的服务，或使用远程 WebDriver 服务，甚至支持多种浏览器多种版本的 Grid 集群方式。</p><p>下面我们使用 docker 方式启动一个拥有 Chrome 环境的单独服务。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -d -p 4444:4444 -v /dev/shm:/dev/shm selenium/standalone-chrome:3.141.59-zirconium
</span></span></code></pre></div><p>查看页面<code>http://localhost:4444/</code>发现已启动成功。</p><p>下面我们用 Golang 写个测试用例试试吧。</p><h3 id=2-golang-selenium-测试代码>2 Golang Selenium 测试代码</h3><p>测试场景就选我的博客吧：打开博客首页<code>leileiluoluo.com</code>，点击搜索按钮，搜索框输入<code>istio</code>关键字后回车，应至少有一条结果，此外将搜索结果截图保存。</p><p>本文选择 Golang 的 selenium 包<code>github.com/tebeka/selenium</code>。</p><p>如下为代码说明：</p><ul><li>setup 函数初始化 driver 对象；</li><li>TestSearch 即为测试搜索功能的函数：打开搜索页，输入关键字，点击搜索按钮，验证搜索结果，保存结果截图；</li><li>teardown 函数负责 driver 对象的资源释放。</li></ul><p>代码已托管至 GitHub：<a href=https://github.com/leileiluoluo/go-exercises/tree/master/selenium/1.0>https://github.com/leileiluoluo/go-exercises</a></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Golang data-lang=Golang><span style=display:flex><span><span style=color:#000;font-weight:700>package</span> blog_test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#d14>&#34;flag&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d14>&#34;io/ioutil&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d14>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d14>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d14>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#d14>&#34;github.com/tebeka/selenium&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>var</span> (
</span></span><span style=display:flex><span>	browserName                    = flag.<span style=color:#900;font-weight:700>String</span>(<span style=color:#d14>&#34;browser&#34;</span>, <span style=color:#d14>&#34;chrome&#34;</span>, <span style=color:#d14>&#34;browser name&#34;</span>)
</span></span><span style=display:flex><span>	gridUrl                        = flag.<span style=color:#900;font-weight:700>String</span>(<span style=color:#d14>&#34;grid&#34;</span>, <span style=color:#d14>&#34;http://localhost:4444/wd/hub&#34;</span>, <span style=color:#d14>&#34;grid url&#34;</span>)
</span></span><span style=display:flex><span>	blogURL                        = <span style=color:#d14>&#34;https://leileiluoluo.com/&#34;</span>
</span></span><span style=display:flex><span>	searchButtonIdSelector         = <span style=color:#d14>&#34;searchOpen&#34;</span>
</span></span><span style=display:flex><span>	keywordInputIdSelector         = <span style=color:#d14>&#34;search-query&#34;</span>
</span></span><span style=display:flex><span>	searchResultLoadingCssSelector = <span style=color:#d14>&#34;#search-results #loadingDiv&#34;</span>
</span></span><span style=display:flex><span>	searchResultCssSelector        = <span style=color:#d14>&#34;#search-results .border-bottom&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	keyword = <span style=color:#d14>&#34;istio&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>var</span> driver selenium.WebDriver
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>setup</span>() <span style=color:#000;font-weight:700>func</span>() {
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// new remote driver
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	caps <span style=color:#000;font-weight:700>:=</span> selenium.Capabilities{<span style=color:#d14>&#34;browserName&#34;</span>: <span style=color:#000;font-weight:700>*</span>browserName}
</span></span><span style=display:flex><span>	webDriver, err <span style=color:#000;font-weight:700>:=</span> selenium.<span style=color:#900;font-weight:700>NewRemote</span>(caps, <span style=color:#000;font-weight:700>*</span>gridUrl)
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>		<span style=color:#0086b3>panic</span>(err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	driver = webDriver
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// teardown
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	<span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>func</span>() {
</span></span><span style=display:flex><span>		driver.<span style=color:#900;font-weight:700>Quit</span>()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>screenshot</span>(filename <span style=color:#458;font-weight:700>string</span>) {
</span></span><span style=display:flex><span>	bytes, err <span style=color:#000;font-weight:700>:=</span> driver.<span style=color:#900;font-weight:700>Screenshot</span>()
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>		log.<span style=color:#900;font-weight:700>Printf</span>(<span style=color:#d14>&#34;take screenshot error, err: %s&#34;</span>, err)
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	err = ioutil.<span style=color:#900;font-weight:700>WriteFile</span>(filename, bytes, <span style=color:#099>0666</span>)
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>		log.<span style=color:#900;font-weight:700>Printf</span>(<span style=color:#d14>&#34;save screenshot error, err: %s&#34;</span>, err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>TestSearch</span>(t <span style=color:#000;font-weight:700>*</span>testing.T) {
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// open blog
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	err <span style=color:#000;font-weight:700>:=</span> driver.<span style=color:#900;font-weight:700>Get</span>(blogURL)
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>		t.<span style=color:#900;font-weight:700>Errorf</span>(<span style=color:#d14>&#34;search page open error, err: %s&#34;</span>, err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// click search button
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	elem, err <span style=color:#000;font-weight:700>:=</span> driver.<span style=color:#900;font-weight:700>FindElement</span>(selenium.ByID, searchButtonIdSelector)
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>		t.<span style=color:#900;font-weight:700>Errorf</span>(<span style=color:#d14>&#34;search button not found, err: %s&#34;</span>, err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	elem.<span style=color:#900;font-weight:700>Click</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// type keyword and enter
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	elem, err = driver.<span style=color:#900;font-weight:700>FindElement</span>(selenium.ByID, keywordInputIdSelector)
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>		t.<span style=color:#900;font-weight:700>Errorf</span>(<span style=color:#d14>&#34;keyword input element not found, err: %s&#34;</span>, err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	elem.<span style=color:#900;font-weight:700>SendKeys</span>(keyword <span style=color:#000;font-weight:700>+</span> <span style=color:#d14>&#34;\n&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// wait until search result displayed
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	driver.<span style=color:#900;font-weight:700>WaitWithTimeout</span>(<span style=color:#000;font-weight:700>func</span>(driver selenium.WebDriver) (<span style=color:#458;font-weight:700>bool</span>, <span style=color:#458;font-weight:700>error</span>) {
</span></span><span style=display:flex><span>		elem, err = driver.<span style=color:#900;font-weight:700>FindElement</span>(selenium.ByCSSSelector, searchResultLoadingCssSelector)
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>			<span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>false</span>, <span style=color:#000;font-weight:700>nil</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		visible, err <span style=color:#000;font-weight:700>:=</span> elem.<span style=color:#900;font-weight:700>IsDisplayed</span>()
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>return</span> !visible, err
</span></span><span style=display:flex><span>	}, <span style=color:#099>30</span><span style=color:#000;font-weight:700>*</span>time.Second)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// assert
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	elems, err <span style=color:#000;font-weight:700>:=</span> driver.<span style=color:#900;font-weight:700>FindElements</span>(selenium.ByCSSSelector, searchResultCssSelector)
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err <span style=color:#000;font-weight:700>||</span> <span style=color:#0086b3>len</span>(elems) &lt; <span style=color:#099>1</span> {
</span></span><span style=display:flex><span>		t.<span style=color:#900;font-weight:700>Errorf</span>(<span style=color:#d14>&#34;no search result, err: %s&#34;</span>, err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// save screenshot
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	<span style=color:#900;font-weight:700>screenshot</span>(<span style=color:#d14>&#34;search.png&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>TestMain</span>(m <span style=color:#000;font-weight:700>*</span>testing.M) {
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// parse flags
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	flag.<span style=color:#900;font-weight:700>Parse</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// setup / teardown
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	teardown <span style=color:#000;font-weight:700>:=</span> <span style=color:#900;font-weight:700>setup</span>()
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>defer</span> <span style=color:#900;font-weight:700>teardown</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// run tests
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	m.<span style=color:#900;font-weight:700>Run</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>执行测试：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ go <span style=color:#0086b3>test</span> -v
</span></span></code></pre></div><p>测试结果：</p><pre tabindex=0><code>=== RUN   TestSearch
--- PASS: TestSearch (46.40s)
PASS
ok  	github.com/leileiluoluo/test	91.427s
</code></pre><p>至此，我们已可以使用 Selenium 进行自动化测试了。</p><p>分析如上代码，代码编排的有一点粗陋，面对实际 Web 应用的复杂性，测试代码如何落地呢？有一点即是测试代码的编排。</p><h3 id=3-如何编排测试代码>3 如何编排测试代码</h3><p>如上测试代码的组织方式在测试逻辑复杂的情况下可能会变得庞杂又混乱。面对一个交互场景稍微复杂些的 Web 应用的时候，我们如何编排测试代码的包结构，或者进而设计一个通用的测试框架呢？</p><p>Selenium 给出一个指导原则——<a href=https://www.selenium.dev/documentation/en/guidelines_and_recommendations/page_object_models/>页面对象模型</a>，简单点说即是摒弃直接从测试者的角度想问题，而应从终端用户的视角出发，一个测试场景应是一组动作结合页面上下文的组合。</p><p>所以编写测试用例时重要的是：不要一开始就设想点哪个按钮，选哪个字段，提交哪个表单这么细粒度的问题，而是过一遍真实用户体验。</p><p>所以，写测试用例即如编写业务代码一样，需要考虑重用，封装，单一职责，面向对象，设计模式等知识。</p><p>基于此，自动化测试领域的编码规范或设计模式即页面对象模型应运而生。其采用面向对象原则，将各个页面的选择器标记及行为封装在各自的页面，通过方法提供该页面的服务，且页面模型内不应有断言。</p><p>下面就基于该规范将上边的代码试着改进一下吧。</p><p>blog_test.go 为总测试入口，pages 包下为各页面功能，所以搜索页面的定位标记及功能均封装在 search.go，这样，我们在 blog_test.go 写测试函数调用 pages 下的页面的方法即可进行断言。</p><p>改进后的代码已托管至 GitHub：<a href=https://github.com/leileiluoluo/go-exercises/tree/master/selenium/2.0>https://github.com/leileiluoluo/go-exercises</a></p><ul><li>代码结构(github.com/leileiluoluo/test)</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ tree
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>├─ blog_test.go
</span></span><span style=display:flex><span>├─ pages
</span></span><span style=display:flex><span>│   ├─ ...
</span></span><span style=display:flex><span>│   └─ search.go
</span></span><span style=display:flex><span>├─ go.mod
</span></span><span style=display:flex><span>└─ go.sum
</span></span></code></pre></div><ul><li>blog_test.go</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Golang data-lang=Golang><span style=display:flex><span><span style=color:#000;font-weight:700>package</span> blog_test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#d14>&#34;flag&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d14>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#d14>&#34;github.com/leileiluoluo/test/pages&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d14>&#34;github.com/tebeka/selenium&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>var</span> (
</span></span><span style=display:flex><span>	browserName = flag.<span style=color:#900;font-weight:700>String</span>(<span style=color:#d14>&#34;browser&#34;</span>, <span style=color:#d14>&#34;chrome&#34;</span>, <span style=color:#d14>&#34;browser name&#34;</span>)
</span></span><span style=display:flex><span>	gridUrl     = flag.<span style=color:#900;font-weight:700>String</span>(<span style=color:#d14>&#34;grid&#34;</span>, <span style=color:#d14>&#34;http://localhost:4444/wd/hub&#34;</span>, <span style=color:#d14>&#34;grid url&#34;</span>)
</span></span><span style=display:flex><span>	keyword     = <span style=color:#d14>&#34;istio&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>var</span> driver selenium.WebDriver
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>setup</span>() <span style=color:#000;font-weight:700>func</span>() {
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// new remote driver
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	caps <span style=color:#000;font-weight:700>:=</span> selenium.Capabilities{<span style=color:#d14>&#34;browserName&#34;</span>: <span style=color:#000;font-weight:700>*</span>browserName}
</span></span><span style=display:flex><span>	webDriver, err <span style=color:#000;font-weight:700>:=</span> selenium.<span style=color:#900;font-weight:700>NewRemote</span>(caps, <span style=color:#000;font-weight:700>*</span>gridUrl)
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>		<span style=color:#0086b3>panic</span>(err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	driver = webDriver
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// teardown
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	<span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>func</span>() {
</span></span><span style=display:flex><span>		driver.<span style=color:#900;font-weight:700>Quit</span>()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>TestSearch</span>(t <span style=color:#000;font-weight:700>*</span>testing.T) {
</span></span><span style=display:flex><span>	sp <span style=color:#000;font-weight:700>:=</span> pages.<span style=color:#900;font-weight:700>NewSearchPage</span>(driver)
</span></span><span style=display:flex><span>	count, err <span style=color:#000;font-weight:700>:=</span> sp.<span style=color:#900;font-weight:700>Search</span>(keyword)
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err <span style=color:#000;font-weight:700>||</span> count &lt; <span style=color:#099>1</span> {
</span></span><span style=display:flex><span>		t.<span style=color:#900;font-weight:700>Errorf</span>(<span style=color:#d14>&#34;search error, count: %d, err: %s&#34;</span>, count, err)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>TestMain</span>(m <span style=color:#000;font-weight:700>*</span>testing.M) {
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// parse flags
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	flag.<span style=color:#900;font-weight:700>Parse</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// setup / teardown
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	teardown <span style=color:#000;font-weight:700>:=</span> <span style=color:#900;font-weight:700>setup</span>()
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>defer</span> <span style=color:#900;font-weight:700>teardown</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// run tests
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	m.<span style=color:#900;font-weight:700>Run</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>pages/search.go</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Golang data-lang=Golang><span style=display:flex><span><span style=color:#000;font-weight:700>package</span> pages
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#d14>&#34;errors&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d14>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#d14>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#d14>&#34;github.com/tebeka/selenium&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>const</span> (
</span></span><span style=display:flex><span>	blogURL                        = <span style=color:#d14>&#34;https://leileiluoluo.com/&#34;</span>
</span></span><span style=display:flex><span>	searchButtonIdSelector         = <span style=color:#d14>&#34;searchOpen&#34;</span>
</span></span><span style=display:flex><span>	keywordInputIdSelector         = <span style=color:#d14>&#34;search-query&#34;</span>
</span></span><span style=display:flex><span>	searchResultLoadingCssSelector = <span style=color:#d14>&#34;#search-results #loadingDiv&#34;</span>
</span></span><span style=display:flex><span>	searchResultCssSelector        = <span style=color:#d14>&#34;#search-results .border-bottom&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>var</span> drv selenium.WebDriver
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>type</span> SearchPage <span style=color:#000;font-weight:700>struct</span> {
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>// initializer
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>NewSearchPage</span>(driver selenium.WebDriver) <span style=color:#000;font-weight:700>*</span>SearchPage {
</span></span><span style=display:flex><span>	drv = driver
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>&amp;</span>SearchPage{}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>// open blog and click search button
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>func</span> (sp <span style=color:#000;font-weight:700>*</span>SearchPage) <span style=color:#900;font-weight:700>openBlogAndClickSearchButton</span>() <span style=color:#458;font-weight:700>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// open blog
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	err <span style=color:#000;font-weight:700>:=</span> drv.<span style=color:#900;font-weight:700>Get</span>(blogURL)
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>return</span> errors.<span style=color:#900;font-weight:700>New</span>(fmt.<span style=color:#900;font-weight:700>Sprintf</span>(<span style=color:#d14>&#34;search page open error, err: %s&#34;</span>, err))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// click search button
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	elem, err <span style=color:#000;font-weight:700>:=</span> drv.<span style=color:#900;font-weight:700>FindElement</span>(selenium.ByID, searchButtonIdSelector)
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>return</span> errors.<span style=color:#900;font-weight:700>New</span>(fmt.<span style=color:#900;font-weight:700>Sprintf</span>(<span style=color:#d14>&#34;search button not found, err: %s&#34;</span>, err))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>return</span> elem.<span style=color:#900;font-weight:700>Click</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>// type keyword and enter
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>func</span> (sp <span style=color:#000;font-weight:700>*</span>SearchPage) <span style=color:#900;font-weight:700>typeKeyword</span>(keyword <span style=color:#458;font-weight:700>string</span>) <span style=color:#458;font-weight:700>error</span> {
</span></span><span style=display:flex><span>	elem, err <span style=color:#000;font-weight:700>:=</span> drv.<span style=color:#900;font-weight:700>FindElement</span>(selenium.ByID, keywordInputIdSelector)
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>return</span> errors.<span style=color:#900;font-weight:700>New</span>(fmt.<span style=color:#900;font-weight:700>Sprintf</span>(<span style=color:#d14>&#34;keyword input element not found, err: %s&#34;</span>, err))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>return</span> elem.<span style=color:#900;font-weight:700>SendKeys</span>(keyword <span style=color:#000;font-weight:700>+</span> <span style=color:#d14>&#34;\n&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>// wait until search result displayed
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>func</span> (sp <span style=color:#000;font-weight:700>*</span>SearchPage) <span style=color:#900;font-weight:700>waitUntilResultDisplayed</span>() <span style=color:#458;font-weight:700>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>return</span> drv.<span style=color:#900;font-weight:700>WaitWithTimeout</span>(<span style=color:#000;font-weight:700>func</span>(driver selenium.WebDriver) (<span style=color:#458;font-weight:700>bool</span>, <span style=color:#458;font-weight:700>error</span>) {
</span></span><span style=display:flex><span>		elem, err <span style=color:#000;font-weight:700>:=</span> driver.<span style=color:#900;font-weight:700>FindElement</span>(selenium.ByCSSSelector, searchResultLoadingCssSelector)
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>			<span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>false</span>, <span style=color:#000;font-weight:700>nil</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		visible, err <span style=color:#000;font-weight:700>:=</span> elem.<span style=color:#900;font-weight:700>IsDisplayed</span>()
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>return</span> !visible, err
</span></span><span style=display:flex><span>	}, <span style=color:#099>30</span><span style=color:#000;font-weight:700>*</span>time.Second)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>// Search by keyword
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>// return count of search result
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>func</span> (sp <span style=color:#000;font-weight:700>*</span>SearchPage) <span style=color:#900;font-weight:700>Search</span>(keyword <span style=color:#458;font-weight:700>string</span>) (<span style=color:#458;font-weight:700>int</span>, <span style=color:#458;font-weight:700>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// open blog and click search button
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	err <span style=color:#000;font-weight:700>:=</span> sp.<span style=color:#900;font-weight:700>openBlogAndClickSearchButton</span>()
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>return</span> <span style=color:#099>0</span>, err
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// type keyword and enter
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	err = sp.<span style=color:#900;font-weight:700>typeKeyword</span>(keyword)
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>return</span> <span style=color:#099>0</span>, err
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// wait until search result displayed
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	err = sp.<span style=color:#900;font-weight:700>waitUntilResultDisplayed</span>()
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>return</span> <span style=color:#099>0</span>, err
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// return
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>	elems, err <span style=color:#000;font-weight:700>:=</span> drv.<span style=color:#900;font-weight:700>FindElements</span>(selenium.ByCSSSelector, searchResultCssSelector)
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>nil</span> <span style=color:#000;font-weight:700>!=</span> err {
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>return</span> <span style=color:#099>0</span>, errors.<span style=color:#900;font-weight:700>New</span>(fmt.<span style=color:#900;font-weight:700>Sprintf</span>(<span style=color:#d14>&#34;search element error, err: %s&#34;</span>, err))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>return</span> <span style=color:#0086b3>len</span>(elems), <span style=color:#000;font-weight:700>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>参考资料</p><p>[1] <a href=https://www.selenium.dev/ target=blank><a href=https://www.selenium.dev/>https://www.selenium.dev/</a></a></p><p>[2] <a href=https://github.com/tebeka/selenium target=blank><a href=https://github.com/tebeka/selenium>https://github.com/tebeka/selenium</a></a></p><p>[3] <a href=https://github.com/SeleniumHQ/docker-selenium target=blank><a href=https://github.com/SeleniumHQ/docker-selenium>https://github.com/SeleniumHQ/docker-selenium</a></a></p></blockquote></div><div class=content-footer><div class=weixinhao><img src=/static/images/self/weixinhao-white.jpg></div><div class=post-tags><a href=/tags/golang/>#Golang</a>
<a href=/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/>#自动化测试</a>
<a href=/tags/selenium/>#Selenium</a></div><div class=license><i class=ti-info-alt></i><div class=info>版权声明：该博客文章由作者通过「<a href=https://creativecommons.org/licenses/by/4.0/deed.zh>知识共享署名 4.0 许可证</a>」进行授权，转载须注明文章原始链接。</div></div></div></div><div class="col-lg-8 mx-auto block shadow"><h3>相关文章</h3><ul><li><a href=/posts/how-to-write-ui-test-cases-using-screenplay-pattern.html>如何使用 Screenplay 模式编写 UI 测试用例？</a></li><li><a href=/posts/how-to-perform-ui-testing-using-serenity-bdd.html>如何使用 Serenity BDD 进行 UI 测试？</a></li><li><a href=/posts/cucumber-java-spring-boot-integration.html>Cucumber Java 如何与 Spring Boot 进行集成？</a></li><li><a href=/posts/cucumber-java-dependency-injection-using-picocontainer.html>如何在 Cucumber Java 中使用 PicoContainer 进行依赖注入？</a></li><li><a href=/posts/how-to-perform-ui-testing-using-cucumber.html>如何使用 Cucumber Java 进行 UI 测试？</a></li></ul></div><div class="col-lg-8 mx-auto block shadow"><div><h3>评论</h3><div id=comment-loading style=text-align:center;font-size:14px><img style=width:52px src=/static/images/site/mona-loading-default.gif>
<span>正在加载评论......</span></div><script>function handleMessage(e){if(e.origin!=="https://giscus.app")return;if(typeof e.data!="object"||!e.data.giscus)return;const t=document.getElementById("comment-loading");t.style.display="none"}window.addEventListener("message",handleMessage)</script><script src=https://giscus.app/client.js data-repo=leileiluoluo/leileiluoluo.github.io data-repo-id=R_kgDOJkLT8w data-category=General data-category-id=DIC_kwDOJkLT884CdtEh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></div></div></section><footer class="py-4 bg-lights border-top"><div class=container><div class="row justify-content-between text-center align-items-center"><div class="col-lg-4 text-center text-lg-left mb-4 mb-lg-0"></div><div class="col-lg-4 text-center mb-4 mb-lg-0"><ul class="list-inline mb-0"><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/sponsor>随喜打赏</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/about>关于本博</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/links>友情链接</a></li></ul></div><div class="col-lg-4 text-lg-right text-center mb-4 mb-lg-0"><ul class="list-inline social-icon mb-0"><li class=list-inline-item><a title=文章归档 href=/archives/><i class=ti-archive></i></a></li><li class=list-inline-item><a title=文章标签 href=/tags/><i class=ti-tag></i></a></li><li class=list-inline-item><a title="我的 GitHub" href=https://github.com/leileiluoluo><i class=ti-github></i></a></li><li class=list-inline-item><a title="网站 RSS" href=/index.xml><i class=ti-rss></i></a></li></ul></div></div><div style=text-align:center;font-size:18px;margin-bottom:22px><a style="-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-image:linear-gradient(to right,#14100f,#d55b5b,#4d14e6)" href=https://www.boyouquan.com/planet-shuttle>「博友圈 · 星球穿梭」</a></div><div class="text-center mt-4"><span>Made with <a href=https://gohugo.io/>Hugo</a> | Theme by <a href=https://github.com/themefisher/northendlab-hugo>NorthendLab</a> | <a href=https://beian.miit.gov.cn>辽ICP备2022012085号-5</a> | Copyright © 2017-2025</span></div></div></footer><script>var indexURL="https://leileiluoluo.github.io/index.json"</script><script src=https://leileiluoluo.github.io/js/jquery.min.js></script><script src=https://leileiluoluo.github.io/js/bootstrap.min.js></script><script src=https://leileiluoluo.github.io/js/fuse.min.js></script><script src=https://leileiluoluo.github.io/js/mark.js></script><script src=https://leileiluoluo.github.io/js/search.js></script><script src=https://leileiluoluo.github.io/js/script.min.js></script></body></html>