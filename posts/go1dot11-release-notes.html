<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>Go 1.11 Release Notes 要点整理 - 磊磊落落</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=keywords content="Java,Golang,Python,云原生,架构设计,DevOps,自动化测试,技术博客,生活博客"><meta name=description content="我是浩然，一名软件开发工程师，我的博客「磊磊落落」建立于 2017 年，是我用于记录内心波澜，分享读书感想，思考人生哲学，关注社会百态，梳理计算机专业知识的纯原创站点。目前我在技术上主要关注：Java、Golang、Python、前端开发、云原生、架构设计、DevOps 和自动化测试。"><meta name=author content="磊磊落落"><meta name=generator content="Hugo 0.123.7"><link rel=stylesheet href=https://leileiluoluo.github.io/css/bootstrap.min.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/themify-icons.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/larry-custom-v1.6.css><link rel=stylesheet href=https://leileiluoluo.github.io/scss/style.min.css media=screen><link rel="shortcut icon" href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><link rel=icon href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?526723b767317055572c85bdb445353c",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><header class="fixed-top navigation"><div class=container><nav class="navbar navbar-expand-lg navbar-light bg-transparent"><a class=navbar-brand href=https://leileiluoluo.github.io/>磊磊落落</a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/></a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/>计算机</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E9%9A%8F%E7%AC%94/>随笔</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AF%BB%E4%B9%A6/>读书</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%A7%82%E5%BD%B1/>观影</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E7%BB%83%E5%AD%97/>练字</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/about>关于</a></li></ul><div class=search><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://leileiluoluo.github.io//search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder=键入关键字后回车...></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><div class="py-5 d-none d-lg-block"></div><section class=section><div class=container><div class=row><div class="col-lg-8 mx-auto block shadow mb-5"><h1>Go 1.11 Release Notes 要点整理</h1><div class="mb-3 post-meta">2019年10月05日
<a href=/categories/%e8%ae%a1%e7%ae%97%e6%9c%ba>计算机</a></div><div class="content mb-5"><p>Go 1.11，在 Go 1.10 发布半年后如期而至。多数变化在工具链实现、运行时及库上面。该版本继续秉承 Go 1 兼容性准则。期待几乎所有的程序均可像之前一样编译及运行。</p><p><strong>1 移植</strong></p><ul><li>WebAssembly
Go 1.11 对 WebAssembly（js/wasm）加入试验性支持。
目前，编译为一个 WebAssembly 模块的 Go 程序，包括支持 goroutine 调度的 go 运行时、垃圾收集器，map 等。这样即造成目标二进制文件最小接近 2 MB（压缩后 500 KB）。Go 程序可以使用 syscall/js 试验性包来调用 JavaScript。二进制大小的优化及与其它语言的交互还未排进优先事项，但可能会在后续的版本解决。</li></ul><p>所有新加了 GOOS 变量值"js"及 GOARCH 变量值"wasm",被命名为*_js.go 或*_wasm.go 的 go 文件将被 Go 工具忽略（除了 GOOS/GOARCH 设定的情况）。若现有程序包含满足该命名方式的文件，需要重命名。</p><p>关于 Go WebAssembly 的使用，请移步“<a href=/posts/golang-webassembly.html>Go WebAssembly 初探</a>”。</p><p><strong>2 工具</strong></p><ul><li><p>模块、包版本化，及依赖管理
Go 1.11 对模块增加了初步支持。使用模块，开发者不再限定于在 GOPATH 内开发，版本依赖信息显式且轻量，构建更可信且更可重现。详情请参阅“<a href=/posts/golang-modules.html>Golang Modules</a>”。</p></li><li><p>引用路径限制
因 Go 模块支持对命令行操作中的@符号赋予了特殊含义，所以，go 命令目前不允许引用路径中使用@符号。此类引用路径已不被 go get 所允许，该限制仅会影响构建自定义引用路径的场景。</p></li><li><p>包加载
新包<code>golang.org/x/tools/go/packages</code>对源码包的定位及加载提供一个简单的 API。尽管其非标准库的一部分，对许多任务，其已有效替代了 go/build 包（API 无法全力支持模块）。因其运行诸如 go list 的额外查询命令来获取包信息，使得分析工具的构建与诸如 Bazel 及 Buck 等可选构建系统的合力工作表现更佳。</p></li><li><p>构建缓存
Go 1.11 将会是最后一个支持设置环境变量 GOCACHE=off（取消构建缓存选项，由 Go 1.10 引入）的版本。自 Go 1.12 起，作为趋向移除$GOPATH/pkg 的一步，构建缓存是需要的。如上描述的模块及包加载支持已需要构建缓存开启。</p></li><li><p>编译器工具链
目前，更多函数中意于默认内敛，包含调用 panic 的函数。</p></li></ul><p>编译器工具链目前支持<a href=https://golang.org/cmd/compile/#hdr-Compiler_Directives>line 原语</a>的列信息。</p><p>一个新的包导出数据格式已被引入。除了对大型 Go 工程的构建次数加速，其对终端用户应是透明的。若其引起问题，可以在使用 go tool 构建二进制时，传入<code>gcflags=all=-iexport=false</code>来关闭该功能。</p><p>编译器目前禁止在类型选择语句中有未使用的变量声明。（诸如如下的 x 变量）</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>f</span>(v <span style=color:#000;font-weight:700>interface</span>{}) {
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>switch</span> x <span style=color:#000;font-weight:700>:=</span> v.(<span style=color:#000;font-weight:700>type</span>) {
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>调试
编译器目前对优化后的二进制生成更精确的调试信息，包含变量位置信息、行号及断点位置。其可用来调试不使用-N -l 编译的二进制。调试信息的质量仍然有限，有一些是基础的，还有一些会在后续版本改进。</li></ul><p>因调试器会生成更扩展更精确的调试信息，DWARF 部分目前已默认压缩。其对绝大多数 ELF 工具（诸如位于 Linux 及*BSD 的调试器）是透明的，且被 Delve 调试器的各平台所支持，但 macOS 及 Windows 的本地工具支持有限。取消 DWARF 压缩，构建二进制时，可以对 go tool 传入<code>-ldflags=-compressdwarf=false</code>。</p><p>Go 1.11 对调试器内部调用 Go 函数增加了试验性支持。这是很有用的，诸如停在某个断点调用 String 方法。该功能目前仅支持 Delve 1.1.0 及以上版本。</p><ul><li>测试
自 Go 1.10 起，go test 命令在即将被测试的包上运行 go vet，以检测测试前的问题。因 vet 在运行前对代码进行类型检查，类型检查不通过的用例将会失败。特别是，使用 Go 1.10 编译的（编译器错误的接受了该场景），闭包内部含有未使用变量的用例，目前会失败。</li></ul><p>用在 go test 的-memprofile 标记目前默认为“allocs”分析，记录自测试开始的总分配字节（包含垃圾收集字节）。</p><ul><li>Vet
当被分析的包未通过类型检查时，go vet 会报一个致命错误（之前仅打印一句警告）。</li></ul><p>此外，go vet 对 printf 的格式检查更健壮。诸如，如下代码会报错。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#998;font-style:italic>// test.go
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>wrapper</span>(s <span style=color:#458;font-weight:700>string</span>, args <span style=color:#000;font-weight:700>...</span><span style=color:#000;font-weight:700>interface</span>{}) {
</span></span><span style=display:flex><span>    fmt.<span style=color:#900;font-weight:700>Printf</span>(s, args<span style=color:#000;font-weight:700>...</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>func</span> <span style=color:#900;font-weight:700>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#900;font-weight:700>wrapper</span>(<span style=color:#d14>&#34;%s&#34;</span>, <span style=color:#099>42</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ go vet test.go
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># command-line-arguments</span>
</span></span><span style=display:flex><span>./test.go:10:2: wrapper format %s has arg <span style=color:#099>42</span> of wrong <span style=color:#0086b3>type</span> int
</span></span></code></pre></div><ul><li><p>Trace
使用新包 runtime/trace 的用户 API，用户可以记录 Trace 执行时的应用级信息，且可给相关的 goroutine 分组。go tool trace 还可将这些信息可视化。</p></li><li><p>Cgo
自 Go 1.10 起，cgo 已将一些 C 指针类型转换为 Go 类型 uintptr。这些类型包含 Darwin 核心框架的 CFTypeRef 层次结构及 Java JNI 接口的 jobject 层次结构。在 Go 1.11，已进行多项改进来检测这些类型。使用这些类型的代码可能需要更新。</p></li><li><p>Go 命令
GOFLAGS 环境变量目前可能会被用于设置 go 命令的默认标记。其在有些场景是很有用的。在有些因 DWARF 而链接很慢的系统，用户可能会默认设置-ldflags=-w。对于模块，用户或持续集成系统若想使用 vendor 模式，可以默认设置-mod=vendor。</p></li><li><p>Godoc
Go 1.11 将会是支持 godoc 命令行的最后一个版本。未来版本，godoc 仅是一个 web 服务，用户可以使用 go doc 作命令行帮助。</p></li><li><p>Run
go run 命令目前允许传入一个单一的引用路径，一个目录名称，或匹配一个包的模式。这样即允许 go run pkg 或 go run dir，甚至 go run .。</p></li></ul><p><strong>3 运行时</strong></p><p>目前，运行时使用一个稀疏堆的布局，所以没有了 Go 堆大小的上限（之前上限为 512GiB）。这样修复了少数情形“地址空间冲突”问题（混合 Go/C 二进制或使用-race 编译的二进制情形）。</p><p>在 macOS 及 iOS 系统，运行时目前使用 libSystem.dylib 代替直接调用内核。这将使 Go 二进制与未来的 macOS 及 iOS 的版本更兼容。syscall 包仍然采用直接系统调用，计划在未来修复。</p><p><strong>4 性能</strong></p><p>math/big 包有多项性能改进，同时，针对 GOARCH=arm64 有多项性能改进。</p><ul><li>编译器工具链
编译器目前优化了针对如下方式的 map 清理操作：</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000;font-weight:700>for</span> k <span style=color:#000;font-weight:700>:=</span> <span style=color:#000;font-weight:700>range</span> m {
</span></span><span style=display:flex><span>    <span style=color:#0086b3>delete</span>(m, k)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>同时，编译器还优化了针对如下方式的 slice 扩展：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#0086b3>append</span>(s, <span style=color:#0086b3>make</span>([]T, n)<span style=color:#000;font-weight:700>...</span>)
</span></span></code></pre></div><p>编译器目前在边界检查及分支淘汰上表现更佳。目前编译器会识别传递性联系，如：若 i&lt;j 且 j&lt;len(s)，则其会使用该事实略过对 s[i]的检查。其还会懂一点诸如 s[i-10]的简单算术，进而识别循环中更多归纳的情形。进而，编译器目前使用边界信息对移位操作作更积极的优化。</p><blockquote><p>参考资料</p><p>[1] <a href=https://golang.org/doc/go1.11 target=blank><a href=https://golang.org/doc/go1.11>https://golang.org/doc/go1.11</a></a></p></blockquote></div><div class=content-footer><div class=weixinhao><img src=/static/images/self/weixinhao-white.jpg></div><div class=post-tags><a href=/tags/golang/>#Golang</a></div><div class=license><i class=ti-info-alt></i><div class=info>版权声明：该博客文章由作者通过「<a href=https://creativecommons.org/licenses/by/4.0/deed.zh>知识共享署名 4.0 许可证</a>」进行授权，转载须注明文章原始链接。</div></div></div></div><div class="col-lg-8 mx-auto block shadow"><h3>相关文章</h3><ul><li><a href=/posts/leetcode-insert-into-a-binary-search-tree.html>LeetCode 701 二叉搜索树插入</a></li><li><a href=/posts/leetcode-binary-tree-zigzag-level-order-traversal.html>LeetCode 103 二叉树Z字形层次遍历</a></li><li><a href=/posts/leetcode-construct-binary-search-tree-from-preorder-traversal.html>LeetCode 1008 以先序遍历构建二叉搜索树</a></li><li><a href=/posts/leetcode-construct-binary-tree-from-preorder-and-postorder-traversal.html>LeetCode 889 以先序及后序遍历构建二叉树</a></li><li><a href=/posts/leetcode-binary-tree-postorder-traversal.html>LeetCode 145 二叉树后序遍历</a></li></ul></div><div class="col-lg-8 mx-auto block shadow"><div><h3>评论</h3><div id=comment-loading style=text-align:center;font-size:14px><img style=width:52px src=/static/images/site/mona-loading-default.gif>
<span>正在加载评论......</span></div><script>function handleMessage(e){if(e.origin!=="https://giscus.app")return;if(typeof e.data!="object"||!e.data.giscus)return;const t=document.getElementById("comment-loading");t.style.display="none"}window.addEventListener("message",handleMessage)</script><script src=https://giscus.app/client.js data-repo=leileiluoluo/leileiluoluo.github.io data-repo-id=R_kgDOJkLT8w data-category=General data-category-id=DIC_kwDOJkLT884CdtEh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></div></div></section><footer class="py-4 bg-lights border-top"><div class=container><div class="row justify-content-between text-center align-items-center"><div class="col-lg-4 text-center text-lg-left mb-4 mb-lg-0"></div><div class="col-lg-4 text-center mb-4 mb-lg-0"><ul class="list-inline mb-0"><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/sponsor>随喜打赏</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/about>关于本博</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/links>友情链接</a></li></ul></div><div class="col-lg-4 text-lg-right text-center mb-4 mb-lg-0"><ul class="list-inline social-icon mb-0"><li class=list-inline-item><a title=文章归档 href=/archives/><i class=ti-archive></i></a></li><li class=list-inline-item><a title=文章标签 href=/tags/><i class=ti-tag></i></a></li><li class=list-inline-item><a title="我的 GitHub" href=https://github.com/leileiluoluo><i class=ti-github></i></a></li><li class=list-inline-item><a title="网站 RSS" href=/index.xml><i class=ti-rss></i></a></li></ul></div></div><div style=text-align:center;font-size:18px;margin-bottom:22px><a style="-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-image:linear-gradient(to right,#14100f,#d55b5b,#4d14e6)" href=https://www.boyouquan.com/planet-shuttle>「博友圈 · 星球穿梭」</a></div><div class="text-center mt-4"><span>Made with <a href=https://gohugo.io/>Hugo</a> | Theme by <a href=https://github.com/themefisher/northendlab-hugo>NorthendLab</a> | <a href=https://beian.miit.gov.cn>辽ICP备2022012085号-5</a> | Copyright © 2017-2024</span></div></div></footer><script>var indexURL="https://leileiluoluo.github.io/index.json"</script><script src=https://leileiluoluo.github.io/js/jquery.min.js></script><script src=https://leileiluoluo.github.io/js/bootstrap.min.js></script><script src=https://leileiluoluo.github.io/js/fuse.min.js></script><script src=https://leileiluoluo.github.io/js/mark.js></script><script src=https://leileiluoluo.github.io/js/search.js></script><script src=https://leileiluoluo.github.io/js/script.min.js></script></body></html>