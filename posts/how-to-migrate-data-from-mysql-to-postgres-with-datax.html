<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>如何使用 Alibaba DataX 进行 MySQL 到 PostgreSQL 的数据迁移 - 磊磊落落</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=keywords content="MySQL,PostgreSQL,DataX,数据迁移"><meta name=description content="DataX 是阿里开源的一款基于 Java 编写的非常实用的数据迁移工具，其不仅支持关系型数据库间的数据迁移，还支持关系型数据库与非关系型数据库间的数据迁移。其使用也非常的简单，只需安装 JDK、配置 JSON 即可，无须关注太多实现细节。其性能也非常了得，能满足生产环境的数据迁移要求。"><meta name=author content="磊磊落落"><meta name=generator content="Hugo 0.123.7"><link rel=stylesheet href=https://leileiluoluo.github.io/css/bootstrap.min.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/themify-icons.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/larry-custom-v1.6.css><link rel=stylesheet href=https://leileiluoluo.github.io/scss/style.min.css media=screen><link rel="shortcut icon" href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><link rel=icon href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?526723b767317055572c85bdb445353c",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><header class="fixed-top navigation"><div class=container><nav class="navbar navbar-expand-lg navbar-light bg-transparent"><a class=navbar-brand href=https://leileiluoluo.github.io/>磊磊落落</a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/></a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/>计算机</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E9%9A%8F%E7%AC%94/>随笔</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AF%BB%E4%B9%A6/>读书</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%A7%82%E5%BD%B1/>观影</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E7%BB%83%E5%AD%97/>练字</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/about>关于</a></li></ul><div class=search><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://leileiluoluo.github.io//search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder=键入关键字后回车...></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><div class="py-5 d-none d-lg-block"></div><section class=section><div class=container><div class=row><div class="col-lg-8 mx-auto block shadow mb-5"><h1>如何使用 Alibaba DataX 进行 MySQL 到 PostgreSQL 的数据迁移</h1><div class="mb-3 post-meta">2025年05月06日
<a href=/categories/%e8%ae%a1%e7%ae%97%e6%9c%ba>计算机</a></div><div class="content mb-5"><p>DataX 是阿里开源的一款基于 Java 编写的非常实用的数据迁移工具，其不仅支持关系型数据库间的数据迁移，还支持关系型数据库与非关系型数据库间的数据迁移。其使用也非常的简单，只需安装 JDK、配置 JSON 即可，无须关注太多实现细节。其性能也非常了得，能满足生产环境的数据迁移要求。</p><p>本文即以 MySQL 到 PostgreSQL 数据迁移为例，介绍 DataX 的使用。</p><p>开始前，列出本文所使用的环境：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>操作系统：CentOS 7
</span></span><span style=display:flex><span>Java：17
</span></span><span style=display:flex><span>Python：3.6
</span></span></code></pre></div><h2 id=1-准备数据>1 准备数据</h2><p>开始迁移数据前，我们建一下表并准备一下测试数据。</p><p>MySQL 的建表语句和插入语句如下：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TABLE</span><span style=color:#bbb> </span>actor<span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>id<span style=color:#bbb> </span><span style=color:#0086b3>BIGINT</span><span style=color:#bbb> </span>AUTO_INCREMENT<span style=color:#bbb> </span><span style=color:#000;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>KEY</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>name<span style=color:#bbb> </span><span style=color:#0086b3>VARCHAR</span>(<span style=color:#099>100</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>nationality<span style=color:#bbb> </span><span style=color:#0086b3>VARCHAR</span>(<span style=color:#099>100</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>year_of_birth<span style=color:#bbb> </span><span style=color:#0086b3>INT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TABLE</span><span style=color:#bbb> </span>movie<span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>id<span style=color:#bbb> </span><span style=color:#0086b3>BIGINT</span><span style=color:#bbb> </span>AUTO_INCREMENT<span style=color:#bbb> </span><span style=color:#000;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>KEY</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>name<span style=color:#bbb> </span><span style=color:#0086b3>VARCHAR</span>(<span style=color:#099>100</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>released_at<span style=color:#bbb> </span><span style=color:#0086b3>INT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TABLE</span><span style=color:#bbb> </span>actor_movie<span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>actor_id<span style=color:#bbb> </span><span style=color:#0086b3>BIGINT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>movie_id<span style=color:#bbb> </span><span style=color:#0086b3>BIGINT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>role</span><span style=color:#bbb> </span><span style=color:#0086b3>VARCHAR</span>(<span style=color:#099>100</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>KEY</span><span style=color:#bbb> </span>(actor_id,<span style=color:#bbb> </span>movie_id)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>INSERT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>INTO</span><span style=color:#bbb> </span>actor(name,<span style=color:#bbb> </span>nationality,<span style=color:#bbb> </span>year_of_birth)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>VALUES</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>(<span style=color:#d14>&#39;吴京&#39;</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;中国&#39;</span>,<span style=color:#bbb> </span><span style=color:#099>1974</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>(<span style=color:#d14>&#39;卢靖姗&#39;</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;中国&#39;</span>,<span style=color:#bbb> </span><span style=color:#099>1985</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>INSERT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>INTO</span><span style=color:#bbb> </span>movie(name,<span style=color:#bbb> </span>released_at)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>VALUES</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>(<span style=color:#d14>&#39;战狼 Ⅱ&#39;</span>,<span style=color:#bbb> </span><span style=color:#099>2017</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>(<span style=color:#d14>&#39;太极宗师&#39;</span>,<span style=color:#bbb> </span><span style=color:#099>1998</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>(<span style=color:#d14>&#39;流浪地球 Ⅱ&#39;</span>,<span style=color:#bbb> </span><span style=color:#099>2023</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>(<span style=color:#d14>&#39;我和我的家乡&#39;</span>,<span style=color:#bbb> </span><span style=color:#099>2020</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>INSERT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>INTO</span><span style=color:#bbb> </span>actor_movie(actor_id,<span style=color:#bbb> </span>movie_id,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>role</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>VALUES</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>(<span style=color:#099>1</span>,<span style=color:#bbb> </span><span style=color:#099>1</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;冷峰&#39;</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>(<span style=color:#099>1</span>,<span style=color:#bbb> </span><span style=color:#099>2</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;杨昱乾&#39;</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>(<span style=color:#099>1</span>,<span style=color:#bbb> </span><span style=color:#099>3</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;刘培强&#39;</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>(<span style=color:#099>2</span>,<span style=color:#bbb> </span><span style=color:#099>1</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;Rachel&#39;</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>(<span style=color:#099>2</span>,<span style=color:#bbb> </span><span style=color:#099>4</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;EMMA MEIER&#39;</span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p>可以看到，我们在 MySQL 建了三张表：actor、movie、actor_movie，前两张为演员、电影实体表，最后一张为演员电影关系表。最后在三张表插入了数条测试数据，这样源库就准备好了。</p><p>PostgreSQL 为目的库，对应上述三张表的 PostgreSQL 建表语句如下：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TABLE</span><span style=color:#bbb> </span>actor<span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>id<span style=color:#bbb> </span>BIGSERIAL<span style=color:#bbb> </span><span style=color:#000;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>KEY</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>name<span style=color:#bbb> </span><span style=color:#0086b3>VARCHAR</span>(<span style=color:#099>100</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>nationality<span style=color:#bbb> </span><span style=color:#0086b3>VARCHAR</span>(<span style=color:#099>100</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>year_of_birth<span style=color:#bbb> </span><span style=color:#0086b3>INTEGER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TABLE</span><span style=color:#bbb> </span>movie<span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>id<span style=color:#bbb> </span>BIGSERIAL<span style=color:#bbb> </span><span style=color:#000;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>KEY</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>name<span style=color:#bbb> </span><span style=color:#0086b3>VARCHAR</span>(<span style=color:#099>100</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>released_at<span style=color:#bbb> </span><span style=color:#0086b3>INTEGER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TABLE</span><span style=color:#bbb> </span>actor_movie<span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>actor_id<span style=color:#bbb> </span><span style=color:#0086b3>BIGINT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>movie_id<span style=color:#bbb> </span><span style=color:#0086b3>BIGINT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>role</span><span style=color:#bbb> </span><span style=color:#0086b3>VARCHAR</span>(<span style=color:#099>100</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>KEY</span><span style=color:#bbb> </span>(actor_id,<span style=color:#bbb> </span>movie_id)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p>将建表语句在 PostgreSQL 对应 Database 执行后，目的库也准备好了。</p><h2 id=2-安装-datax>2 安装 DataX</h2><p>测试数据准备好后，开始安装 DataX。在 CentOS 主机安装 DataX 时，需从「<a href=https://github.com/alibaba/datax>GitHub DataX</a>」介绍页找到 DataX 下载地址，然后使用如下 Shell 命令将 DataX 下载及解压到对应位置（如：<code>/usr/local/datax</code>）。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#0086b3>cd</span> /usr/local
</span></span><span style=display:flex><span>sudo wget https://datax-opensource.oss-cn-hangzhou.aliyuncs.com/202308/datax.tar.gz
</span></span><span style=display:flex><span>sudo tar -zxvf datax.tar.gz
</span></span></code></pre></div><h2 id=3-使用-datax>3 使用 DataX</h2><p>DataX 安装好后即可开始使用了，下面先测试一下单表迁移，然后再考虑多表批量迁移的场景。</p><h3 id=31-单表数据迁移>3.1 单表数据迁移</h3><p>DataX 使用 JSON 格式的文件作配置，查阅「<a href=https://github.com/alibaba/datax>DataX</a>」使用文档，找到读 MySQL 写 PostgreSQL 的对应 reader 和 writer 配置，然后尝试做一个只迁移 actor 表的配置文件 <code>actor.json</code>。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:navy>&#34;job&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;setting&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;speed&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:navy>&#34;channel&#34;</span>: <span style=color:#099>3</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;errorLimit&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:navy>&#34;record&#34;</span>: <span style=color:#099>0</span>,
</span></span><span style=display:flex><span>        <span style=color:navy>&#34;percentage&#34;</span>: <span style=color:#099>0.02</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;content&#34;</span>: [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:navy>&#34;reader&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:navy>&#34;name&#34;</span>: <span style=color:#d14>&#34;mysqlreader&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:navy>&#34;parameter&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;username&#34;</span>: <span style=color:#d14>&#34;root&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;password&#34;</span>: <span style=color:#d14>&#34;root&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;column&#34;</span>: [<span style=color:#d14>&#34;*&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;connection&#34;</span>: [
</span></span><span style=display:flex><span>              {
</span></span><span style=display:flex><span>                <span style=color:navy>&#34;table&#34;</span>: [<span style=color:#d14>&#34;actor&#34;</span>],
</span></span><span style=display:flex><span>                <span style=color:navy>&#34;jdbcUrl&#34;</span>: [<span style=color:#d14>&#34;jdbc:mysql://localhost:3306/test&#34;</span>]
</span></span><span style=display:flex><span>              }
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:navy>&#34;writer&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:navy>&#34;name&#34;</span>: <span style=color:#d14>&#34;postgresqlwriter&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:navy>&#34;parameter&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;username&#34;</span>: <span style=color:#d14>&#34;root&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;password&#34;</span>: <span style=color:#d14>&#34;root&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;column&#34;</span>: [<span style=color:#d14>&#34;*&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;preSql&#34;</span>: [<span style=color:#d14>&#34;DELETE FROM actor&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;connection&#34;</span>: [
</span></span><span style=display:flex><span>              {
</span></span><span style=display:flex><span>                <span style=color:navy>&#34;jdbcUrl&#34;</span>: <span style=color:#d14>&#34;jdbc:postgresql://localhost:5432/test&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:navy>&#34;table&#34;</span>: [<span style=color:#d14>&#34;actor&#34;</span>]
</span></span><span style=display:flex><span>              }
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>可以看到，我们在 <code>actor.json</code> 配置文件指定了迁移所使用的 channel 数、错误百分比（错误数达到指定的百分比即会停止迁移），以及 reader（从哪读）和 writer（写到哪）部分。实际使用中，为了更好的控制迁移速度和错误率可以查询 DataX 文档来进行参数调整。</p><p>配置文件准备好后，使用如下 Shell 调用 DataX 即可对 actor 表进行迁移：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo /usr/local/datax/bin/datax.py actor.json
</span></span></code></pre></div><p>迁移完成后，会打印如下统计信息：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>2025-05-06 18:39:37.122 [job-0] INFO  JobContainer -
</span></span><span style=display:flex><span>任务启动时刻                    : 2025-05-06 18:39:26
</span></span><span style=display:flex><span>任务结束时刻                    : 2025-05-06 18:39:37
</span></span><span style=display:flex><span>任务总计耗时                    :                 11s
</span></span><span style=display:flex><span>任务平均流量                    :                1B/s
</span></span><span style=display:flex><span>记录写入速度                    :              0rec/s
</span></span><span style=display:flex><span>读出记录总数                    :                   2
</span></span><span style=display:flex><span>读写失败总数                    :                   0
</span></span></code></pre></div><h3 id=32-多表批量数据迁移>3.2 多表批量数据迁移</h3><p>单表迁移一般只用于测试，生产环境的数据迁移一般需要考虑如何实现多表批量数据迁移。</p><p>下面即编写一个 Shell 脚本，包装一下 DataX 以支持多表迁移，其目录结构如下：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>data-migration
</span></span><span style=display:flex><span>├─ table_template.json
</span></span><span style=display:flex><span>├─ tables.txt
</span></span><span style=display:flex><span>└─ start.sh
</span></span></code></pre></div><p>可以看到，我们将如上 <code>actor.json</code> 配置文件中的变量进行抽取，设计了一个针对单表迁移的通用模板文件 <code>table_template.json</code>；设计了一个 <code>tables.txt</code> 文件来放置所有待迁移的表名；最后，编写了一个 Shell 文件 <code>start.sh</code> 来读取表名文件、拷贝模板文件并替换里边的值，然后逐个表迁移，这样使用者直接调用它即可开始多表迁移了。</p><p>模板文件 <code>table_template.json</code> 的内容如下：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:navy>&#34;job&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;setting&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;speed&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:navy>&#34;channel&#34;</span>: <span style=color:#099>3</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;errorLimit&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:navy>&#34;record&#34;</span>: <span style=color:#099>0</span>,
</span></span><span style=display:flex><span>        <span style=color:navy>&#34;percentage&#34;</span>: <span style=color:#099>0.02</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:navy>&#34;content&#34;</span>: [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:navy>&#34;reader&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:navy>&#34;name&#34;</span>: <span style=color:#d14>&#34;mysqlreader&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:navy>&#34;parameter&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;username&#34;</span>: <span style=color:#d14>&#34;SOURCE_USERNAME&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;password&#34;</span>: <span style=color:#d14>&#34;SOURCE_PASSWORD&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;column&#34;</span>: [<span style=color:#d14>&#34;*&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;connection&#34;</span>: [
</span></span><span style=display:flex><span>              {
</span></span><span style=display:flex><span>                <span style=color:navy>&#34;table&#34;</span>: [<span style=color:#d14>&#34;TABLE_NAME&#34;</span>],
</span></span><span style=display:flex><span>                <span style=color:navy>&#34;jdbcUrl&#34;</span>: [<span style=color:#d14>&#34;SOURCE_URL&#34;</span>]
</span></span><span style=display:flex><span>              }
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:navy>&#34;writer&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:navy>&#34;name&#34;</span>: <span style=color:#d14>&#34;postgresqlwriter&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:navy>&#34;parameter&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;username&#34;</span>: <span style=color:#d14>&#34;TARGET_USERNAME&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;password&#34;</span>: <span style=color:#d14>&#34;TARGET_PASSWORD&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;column&#34;</span>: [<span style=color:#d14>&#34;*&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;preSql&#34;</span>: [<span style=color:#d14>&#34;DELETE FROM TABLE_NAME&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:navy>&#34;connection&#34;</span>: [
</span></span><span style=display:flex><span>              {
</span></span><span style=display:flex><span>                <span style=color:navy>&#34;jdbcUrl&#34;</span>: <span style=color:#d14>&#34;TARGET_URL&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:navy>&#34;table&#34;</span>: [<span style=color:#d14>&#34;TABLE_NAME&#34;</span>]
</span></span><span style=display:flex><span>              }
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>表名文件 <code>tables.txt</code> 的内容如下：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>actor
</span></span><span style=display:flex><span>movie
</span></span><span style=display:flex><span>actor_movie
</span></span></code></pre></div><p>启动文件 <code>start.sh</code> 的内容如下：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#999;font-weight:700;font-style:italic></span><span style=color:#0086b3>export</span> <span style=color:teal>DATAX_HOME</span><span style=color:#000;font-weight:700>=</span>/usr/local/datax
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># read params</span>
</span></span><span style=display:flex><span><span style=color:teal>SOURCE_URL</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;</span><span style=color:teal>$1</span><span style=color:#d14>&#34;</span>
</span></span><span style=display:flex><span><span style=color:teal>SOURCE_USERNAME</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;</span><span style=color:teal>$2</span><span style=color:#d14>&#34;</span>
</span></span><span style=display:flex><span><span style=color:teal>SOURCE_PASSWORD</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;</span><span style=color:teal>$3</span><span style=color:#d14>&#34;</span>
</span></span><span style=display:flex><span><span style=color:teal>TARGET_URL</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;</span><span style=color:teal>$4</span><span style=color:#d14>&#34;</span>
</span></span><span style=display:flex><span><span style=color:teal>TARGET_USERNAME</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;</span><span style=color:teal>$5</span><span style=color:#d14>&#34;</span>
</span></span><span style=display:flex><span><span style=color:teal>TARGET_PASSWORD</span><span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;</span><span style=color:teal>$6</span><span style=color:#d14>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># json files folder</span>
</span></span><span style=display:flex><span>mkdir json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># start migration</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>for</span> table in <span style=color:#d14>`</span>cat tables.txt<span style=color:#d14>`</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>do</span>
</span></span><span style=display:flex><span>  <span style=color:#0086b3>echo</span> <span style=color:#d14>&#34;migrate table: </span><span style=color:#d14>${</span><span style=color:teal>table</span><span style=color:#d14>}</span><span style=color:#d14>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#998;font-style:italic># json file</span>
</span></span><span style=display:flex><span>  <span style=color:teal>json_file</span><span style=color:#000;font-weight:700>=</span>json/<span style=color:#d14>${</span><span style=color:teal>table</span><span style=color:#d14>}</span>.json
</span></span><span style=display:flex><span>  cp table_template.json <span style=color:#d14>${</span><span style=color:teal>json_file</span><span style=color:#d14>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#998;font-style:italic># replace placeholders</span>
</span></span><span style=display:flex><span>  sed -i <span style=color:#d14>&#34;s#TABLE_NAME#</span><span style=color:#d14>${</span><span style=color:teal>table</span><span style=color:#d14>}</span><span style=color:#d14>#g&#34;</span> <span style=color:#d14>${</span><span style=color:teal>json_file</span><span style=color:#d14>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  sed -i <span style=color:#d14>&#34;s#SOURCE_URL#</span><span style=color:#d14>${</span><span style=color:teal>SOURCE_URL</span><span style=color:#d14>}</span><span style=color:#d14>#g&#34;</span> <span style=color:#d14>${</span><span style=color:teal>json_file</span><span style=color:#d14>}</span>
</span></span><span style=display:flex><span>  sed -i <span style=color:#d14>&#34;s#SOURCE_USERNAME#</span><span style=color:#d14>${</span><span style=color:teal>SOURCE_USERNAME</span><span style=color:#d14>}</span><span style=color:#d14>#g&#34;</span> <span style=color:#d14>${</span><span style=color:teal>json_file</span><span style=color:#d14>}</span>
</span></span><span style=display:flex><span>  sed -i <span style=color:#d14>&#34;s#SOURCE_PASSWORD#</span><span style=color:#d14>${</span><span style=color:teal>SOURCE_PASSWORD</span><span style=color:#d14>}</span><span style=color:#d14>#g&#34;</span> <span style=color:#d14>${</span><span style=color:teal>json_file</span><span style=color:#d14>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  sed -i <span style=color:#d14>&#34;s#TARGET_URL#</span><span style=color:#d14>${</span><span style=color:teal>TARGET_URL</span><span style=color:#d14>}</span><span style=color:#d14>#g&#34;</span> <span style=color:#d14>${</span><span style=color:teal>json_file</span><span style=color:#d14>}</span>
</span></span><span style=display:flex><span>  sed -i <span style=color:#d14>&#34;s#TARGET_USERNAME#</span><span style=color:#d14>${</span><span style=color:teal>TARGET_USERNAME</span><span style=color:#d14>}</span><span style=color:#d14>#g&#34;</span> <span style=color:#d14>${</span><span style=color:teal>json_file</span><span style=color:#d14>}</span>
</span></span><span style=display:flex><span>  sed -i <span style=color:#d14>&#34;s#TARGET_PASSWORD#</span><span style=color:#d14>${</span><span style=color:teal>TARGET_PASSWORD</span><span style=color:#d14>}</span><span style=color:#d14>#g&#34;</span> <span style=color:#d14>${</span><span style=color:teal>json_file</span><span style=color:#d14>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  python <span style=color:#d14>${</span><span style=color:teal>DATAX_HOME</span><span style=color:#d14>}</span>/bin/datax.py <span style=color:#d14>${</span><span style=color:teal>json_file</span><span style=color:#d14>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>done</span>
</span></span></code></pre></div><p>这样，即可像如下这样直接调用 <code>start.sh</code> 指定连接信息来进行多表数据迁移了：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo sh start.sh <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>  <span style=color:#d14>&#34;jdbc:mysql://localhost:3306/test&#34;</span> <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>  root <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>  root <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>  <span style=color:#d14>&#34;jdbc:postgresql://localhost:5432/test&#34;</span> <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>  root <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>  root
</span></span></code></pre></div><h2 id=4-小结>4 小结</h2><p>本文以实例的方式介绍了如何使用 DataX 进行 MySQL 到 PostgreSQL 的数据迁移，本文完整示例代码已提交至 <a href=https://github.com/leileiluoluo/daily-exercises/tree/main/datax>GitHub</a>，欢迎关注或 Fork。</p><blockquote><p>参考资料</p><p>[1] GitHub: Alibaba DataX - <a href=https://github.com/alibaba/datax>https://github.com/alibaba/datax</a></p></blockquote></div><div class=content-footer><div class=weixinhao><img src=/static/images/self/weixinhao-white.jpg></div><div class=post-tags><a href=/tags/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/>#工具使用</a>
<a href=/tags/mysql/>#MySQL</a>
<a href=/tags/postgresql/>#PostgreSQL</a></div><div class=license><i class=ti-info-alt></i><div class=info>版权声明：该博客文章由作者通过「<a href=https://creativecommons.org/licenses/by/4.0/deed.zh>知识共享署名 4.0 许可证</a>」进行授权，转载须注明文章原始链接。</div></div></div></div><div class="col-lg-8 mx-auto block shadow"><h3>相关文章</h3><ul><li><a href=/posts/how-does-spring-data-operate-both-mysql-and-neo4j.html>如何使用 Spring Data 同时访问 MySQL 和 Neo4j 数据库？</a></li><li><a href=/posts/postgres-jdbc-driver-issue.html>PostgreSQL JDBC Driver 42.3.0 读取 BigDecimal 时发生抹 0 的 Bug</a></li><li><a href=/posts/postgres-ddl.html>PostgreSQL 数据定义相关知识总结</a></li><li><a href=/posts/postgres-table-partitioning.html>PostgreSQL 表分区使用详解</a></li><li><a href=/posts/postgres-table-inheritance.html>PostgreSQL 表继承使用详解</a></li></ul></div><div class="col-lg-8 mx-auto block shadow"><div><h3>评论</h3><div id=comment-loading style=text-align:center;font-size:14px><img style=width:52px src=/static/images/site/mona-loading-default.gif>
<span>正在加载评论......</span></div><script>function handleMessage(e){if(e.origin!=="https://giscus.app")return;if(typeof e.data!="object"||!e.data.giscus)return;const t=document.getElementById("comment-loading");t.style.display="none"}window.addEventListener("message",handleMessage)</script><script src=https://giscus.app/client.js data-repo=leileiluoluo/leileiluoluo.github.io data-repo-id=R_kgDOJkLT8w data-category=General data-category-id=DIC_kwDOJkLT884CdtEh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></div></div></section><footer class="py-4 bg-lights border-top"><div class=container><div class="row justify-content-between text-center align-items-center"><div class="col-lg-4 text-center text-lg-left mb-4 mb-lg-0"></div><div class="col-lg-4 text-center mb-4 mb-lg-0"><ul class="list-inline mb-0"><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/sponsor>随喜打赏</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/about>关于本博</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/links>友情链接</a></li></ul></div><div class="col-lg-4 text-lg-right text-center mb-4 mb-lg-0"><ul class="list-inline social-icon mb-0"><li class=list-inline-item><a title=文章归档 href=/archives/><i class=ti-archive></i></a></li><li class=list-inline-item><a title=文章标签 href=/tags/><i class=ti-tag></i></a></li><li class=list-inline-item><a title="我的 GitHub" href=https://github.com/leileiluoluo><i class=ti-github></i></a></li><li class=list-inline-item><a title="网站 RSS" href=/index.xml><i class=ti-rss></i></a></li></ul></div></div><div style=text-align:center;font-size:18px;margin-bottom:22px><a style="-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-image:linear-gradient(to right,#14100f,#d55b5b,#4d14e6)" href=https://www.boyouquan.com/planet-shuttle>「博友圈 · 星球穿梭」</a></div><div class="text-center mt-4"><span>Made with <a href=https://gohugo.io/>Hugo</a> | Theme by <a href=https://github.com/themefisher/northendlab-hugo>NorthendLab</a> | <a href=https://beian.miit.gov.cn>辽ICP备2022012085号-5</a> | Copyright © 2017-2025</span></div></div></footer><script>var indexURL="https://leileiluoluo.github.io/index.json"</script><script src=https://leileiluoluo.github.io/js/jquery.min.js></script><script src=https://leileiluoluo.github.io/js/bootstrap.min.js></script><script src=https://leileiluoluo.github.io/js/fuse.min.js></script><script src=https://leileiluoluo.github.io/js/mark.js></script><script src=https://leileiluoluo.github.io/js/search.js></script><script src=https://leileiluoluo.github.io/js/script.min.js></script></body></html>