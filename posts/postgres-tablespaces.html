<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>PostgreSQL 表空间使用详解 - 磊磊落落</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=keywords content="PostgreSQL,表空间,Tablespaces"><meta name=description content="PostgreSQL Tablespaces (PostgreSQL 表空间使用详解)"><meta name=author content="磊磊落落"><meta name=generator content="Hugo 0.123.7"><link rel=stylesheet href=https://leileiluoluo.github.io/css/bootstrap.min.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/themify-icons.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/larry-custom-v1.6.css><link rel=stylesheet href=https://leileiluoluo.github.io/scss/style.min.css media=screen><link rel="shortcut icon" href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><link rel=icon href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?526723b767317055572c85bdb445353c",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><header class="fixed-top navigation"><div class=container><nav class="navbar navbar-expand-lg navbar-light bg-transparent"><a class=navbar-brand href=https://leileiluoluo.github.io/>磊磊落落</a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/></a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/>计算机</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E9%9A%8F%E7%AC%94/>随笔</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AF%BB%E4%B9%A6/>读书</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%A7%82%E5%BD%B1/>观影</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E7%BB%83%E5%AD%97/>练字</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/about>关于</a></li></ul><div class=search><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://leileiluoluo.github.io//search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder=键入关键字后回车...></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><div class="py-5 d-none d-lg-block"></div><section class=section><div class=container><div class=row><div class="col-lg-8 mx-auto block shadow mb-5"><h1>PostgreSQL 表空间使用详解</h1><div class="mb-3 post-meta">2022年03月26日
<a href=/categories/%e8%ae%a1%e7%ae%97%e6%9c%ba>计算机</a></div><div class="content mb-5"><p>PostgreSQL 的表空间允许在文件系统中定义数据库对象存储的位置。实际上就是为表、序列和索引等数据库对象的数据文件的存储指定了一个目录。</p><p>PostgreSQL 使用操作系统的文件系统进行存储。这与 Oracle 有点不同，后者实现了自己的“文件系统”。</p><p>PostgreSQL 中，一个表空间可供多个数据库使用；而一个数据库可以使用多个表空间，属“多对多”的关系。而在 Oracle 中，一个表空间只可供一个数据库使用；而一个数据库可以拥有多个表空间，属“一对多”的关系。</p><h3 id=1-何时使用表空间>1 何时使用表空间？</h3><ul><li><p>控制磁盘布局</p><p>因数据的不断增长，原有文件系统快满了，又因某些原因无法得到扩展。这时，即可在挂载的其它文件系统上创建新的表空间，并将现有对象移动到新的表空间上。</p></li><li><p>优化性能</p><p>表空间允许管理员根据数据库对象的使用模式来优化性能。如，可以使用表空间将使用频率高的索引或表的数据存储在一个 IOPS 更高的磁盘（如一种昂贵的固态设备）上；而将使用频率低或对性能要求不高的表的数据存储在价格低或慢一些的磁盘上。</p></li></ul><p>一句话概括，即使用表空间可以合理利用磁盘的性能和空间，从而以最优的物理存储方式来管理数据库对象。</p><h3 id=2-默认表空间>2 默认表空间</h3><p>从前文<a href=https://leileiluoluo.github.io/posts/install-postgres-on-centos-from-source.html>在 CentOS 上以源码安装 PostgreSQL</a>知道，PostgreSQL 初始化时需要指定一个数据目录（<code>$PGDATA</code>），命令如下：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ initdb -D /usr/local/pgsql/data
</span></span></code></pre></div><p>初始化完成后，该目录下会包含 PostgreSQL 要启动时的所有东西（配置文件、数据文件和消息队列等）。</p><p>PostgreSQL 启动后，所有数据库对象的数据文件都是在该文件夹下存储的。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ pg_ctl -D /usr/local/pgsql/data -l server.log start
</span></span></code></pre></div><p>该文件夹下的内容如下：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ls -lht /usr/local/pgsql/data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>total 124K
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>2</span> postgres postgres 4.0K Mar <span style=color:#099>28</span> 09:00 pg_stat_tmp
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>4</span> postgres postgres 4.0K Mar  <span style=color:#099>8</span> 17:52 pg_logical
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>2</span> postgres postgres 4.0K Mar  <span style=color:#099>8</span> 17:48 global
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>2</span> postgres postgres 4.0K Mar  <span style=color:#099>8</span> 17:47 pg_stat
</span></span><span style=display:flex><span>-rw------- <span style=color:#099>1</span> postgres postgres   <span style=color:#099>87</span> Mar  <span style=color:#099>8</span> 17:47 postmaster.pid
</span></span><span style=display:flex><span>-rw------- <span style=color:#099>1</span> postgres postgres   <span style=color:#099>59</span> Mar  <span style=color:#099>8</span> 17:47 postmaster.opts
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>6</span> postgres postgres 4.0K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> base
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>2</span> postgres postgres 4.0K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> pg_subtrans
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>3</span> postgres postgres 4.0K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> pg_wal
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>2</span> postgres postgres 4.0K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> pg_xact
</span></span><span style=display:flex><span>-rw------- <span style=color:#099>1</span> postgres postgres 1.6K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> pg_ident.conf
</span></span><span style=display:flex><span>-rw------- <span style=color:#099>1</span> postgres postgres 4.7K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> pg_hba.conf
</span></span><span style=display:flex><span>-rw------- <span style=color:#099>1</span> postgres postgres   <span style=color:#099>88</span> May <span style=color:#099>13</span>  <span style=color:#099>2021</span> postgresql.auto.conf
</span></span><span style=display:flex><span>-rw------- <span style=color:#099>1</span> postgres postgres  28K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> postgresql.conf
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>2</span> postgres postgres 4.0K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> pg_dynshmem
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>4</span> postgres postgres 4.0K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> pg_multixact
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>2</span> postgres postgres 4.0K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> pg_notify
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>2</span> postgres postgres 4.0K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> pg_replslot
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>2</span> postgres postgres 4.0K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> pg_serial
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>2</span> postgres postgres 4.0K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> pg_snapshots
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>2</span> postgres postgres 4.0K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> pg_tblspc
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>2</span> postgres postgres 4.0K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> pg_twophase
</span></span><span style=display:flex><span>-rw------- <span style=color:#099>1</span> postgres postgres    <span style=color:#099>3</span> May <span style=color:#099>13</span>  <span style=color:#099>2021</span> PG_VERSION
</span></span><span style=display:flex><span>drwx------ <span style=color:#099>2</span> postgres postgres 4.0K May <span style=color:#099>13</span>  <span style=color:#099>2021</span> pg_commit_ts
</span></span></code></pre></div><p>而简短一点说，表空间即是告诉 PostgreSQL 服务器数据库对象物理文件存储位置的一种方式。</p><p>在<code>psql</code>中使用<code>\db+</code>命令即可列出表空间的详情：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>postgres=# \db+
</span></span><span style=display:flex><span>                                  List of tablespaces
</span></span><span style=display:flex><span>    Name    |  Owner   | Location | Access privileges | Options |  Size  | Description
</span></span><span style=display:flex><span>------------+----------+----------+-------------------+---------+--------+-------------
</span></span><span style=display:flex><span> pg_default | postgres |          |                   |         | 31 MB  |
</span></span><span style=display:flex><span> pg_global  | postgres |          |                   |         | 559 kB |
</span></span><span style=display:flex><span>(2 rows)
</span></span></code></pre></div><p>这两个表空间（<code>pg_default</code>与<code>pg_global</code>）是在 PostgreSQL 初始化后自动创建的。<code>pg_default</code>是<code>template0</code>与<code>template1</code>数据库的默认表空间（因此，也将是其它数据库的默认表空间）；<code>pg_global</code>是共享系统目录表（<code>pg_database</code>、<code>pg_authid</code>、<code>pg_tablespace</code>、<code>pg_shdepend</code>等）及其索引的表空间。</p><p>我们注意到，上面的信息没有 Location。这是因为它们总是对应 PostgreSQL 数据目录（<code>$PGDATA</code>）下的两个子目录：<code>pg_default</code>使用<code>base</code>子目录，<code>pg_global</code>使用<code>global</code>子目录。</p><h3 id=3-使用表空间>3 使用表空间</h3><h4 id=31-创建表空间>3.1 创建表空间</h4><p>要创建一个新的表空间，需要提前创建一个新的空文件夹（注意不要在 PostgreSQL 数据文件夹<code>$PGDATA</code>下创建），且该文件夹的所有者须是<code>postgres</code>系统用户。示例如下：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ mkdir -p /data/postgres/testspace
</span></span><span style=display:flex><span>$ chown -R postgres:postgres /data/postgres/testspace
</span></span></code></pre></div><p>超级用户（superuser）可使用<code>CREATE TABLESPACE</code>命令来创建一个表空间。示例如下：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ psql -U postgres postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span><span style=color:#998;font-style:italic># CREATE TABLESPACE myspace LOCATION &#39;/data/postgres/testspace&#39;;</span>
</span></span></code></pre></div><p>这时，查阅<code>$PGDATA/pg_tblspc</code>目录，即可看到一个符号链接指向了新建表空间对应文件夹的位置（数字<code>24577</code>是表空间的 OID）：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ls -lht /usr/local/pgsql/data/pg_tblspc/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#099>1</span> postgres postgres <span style=color:#099>24</span> Mar <span style=color:#099>28</span> 15:17 <span style=color:#099>24577</span> -&gt; /data/postgres/testspace
</span></span></code></pre></div><p>要想让普通用户使用新建的表空间，须为普通用户赋予该表空间的<code>CREATE</code>权限。下面示例演示为普通用户<code>testuser</code>赋权限：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span><span style=color:#998;font-style:italic># GRANT CREATE ON TABLESPACE myspace TO testuser;</span>
</span></span></code></pre></div><p>随后，使用表空间<code>myspace</code>的所有对象都会将数据存储在该文件夹（<code>/data/postgres/testspace</code>）下。</p><p>下面示例演示使用普通用户<code>testuser</code>连接到数据库<code>postgres</code>，建表并为其指定表空间<code>myspace</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ psql -U testuser postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span>&gt; CREATE TABLE foo<span style=color:#000;font-weight:700>(</span>id int<span style=color:#000;font-weight:700>)</span> TABLESPACE myspace;
</span></span></code></pre></div><p>除了为表指定表空间外，还可以为索引或数据库指定表空间。示例如下：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span>&gt; CREATE INDEX foo_idx ON foo<span style=color:#000;font-weight:700>(</span>id<span style=color:#000;font-weight:700>)</span> TABLESPACE myspace;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span><span style=color:#998;font-style:italic># CREATE DATABASE testdb TABLESPACE myspace;</span>
</span></span></code></pre></div><h4 id=32-更改表空间>3.2 更改表空间</h4><p>使用对应的<code>ALTER</code>语句，可将现有数据库对象由一个表空间移动到另一个表空间。</p><p>下面示例演示使用<code>ALTER TABLE</code>和<code>ALTER INDEX</code>为表和索引指定新的表空间：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span>&gt; ALTER TABLE foo SET TABLESPACE pg_default;
</span></span><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span>&gt; ALTER INDEX foo_idx SET TABLESPACE pg_default;
</span></span></code></pre></div><p>也可以使用如下语句将一个表空间中的所有表或索引移至另一个表空间：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span>&gt; ALTER TABLE ALL IN TABLESPACE myspace SET TABLESPACE pg_default;
</span></span><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span>&gt; ALTER INDEX ALL IN TABLESPACE myspace SET TABLESPACE pg_default;
</span></span></code></pre></div><p>当重新指定表空间时，受影响的表或索引会被锁定，直至数据移动完成。</p><h4 id=33-更新表空间属性>3.3 更新表空间属性</h4><p>根据上述表空间使用场景，表空间常见用途是将表或索引移动到更快（IOPS 更高）的文件系统上。这时，就需要告知 PostgreSQL 查询规划器新的表空间到底有多快，这样即可使其更好的评估查询性能。</p><p>若您测评发现新的表空间的顺序访问及随机访问速度是之前的两倍，则可使用如下语句更新表空间属性：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>ALTER</span><span style=color:#bbb> </span>TABLESPACE<span style=color:#bbb> </span>myspace<span style=color:#bbb> </span><span style=color:#000;font-weight:700>SET</span><span style=color:#bbb> </span>(seq_page_cost<span style=color:#000;font-weight:700>=</span><span style=color:#099>0</span>.<span style=color:#099>5</span>,<span style=color:#bbb> </span>random_page_cost<span style=color:#000;font-weight:700>=</span><span style=color:#099>0</span>.<span style=color:#099>5</span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p>有关这两个参数的详情，请参阅文档<a href=https://www.postgresql.org/docs/14/runtime-config-query.html#GUC-SEQ-PAGE-COST>seq_page_cost </a>及<a href=https://www.postgresql.org/docs/14/runtime-config-query.html#GUC-RANDOM-PAGE-COST>random_page_cost</a>。</p><h4 id=34-临时表空间>3.4 临时表空间</h4><p>PostgreSQL 允许使用<code>temp_tablespaces</code>参数来指定临时表空间（可使用逗号分隔，指定多个表空间）。临时表空间用于定义临时表、临时索引以及大型 SQL（大型数据集的排序或聚合等）可能产生的临时文件的存储位置。PostgreSQL 每次创建这些临时对象时，即会从指定的表空间列表随机获取并使用。临时表空间参数未指定时，会使用默认表空间<code>pg_default</code>。</p><p>下面演示如何指定临时表空间。</p><p>首先，创建两个空文件夹，并将所有者设定为<code>postgres</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ mkdir /data/postgres/tempspace1
</span></span><span style=display:flex><span>$ mkdir /data/postgres/tempspace2
</span></span><span style=display:flex><span>$ chown -R postgres:postgres /data/postgres/tempspace1
</span></span><span style=display:flex><span>$ chown -R postgres:postgres /data/postgres/tempspace2
</span></span></code></pre></div><p>使用<code>superuser</code>新建两个表空间，位置对应刚刚建好的两个文件夹；并为普通用户<code>testuser</code>赋这两个表空间的<code>CREATE</code>权限：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ psql -U postgres postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span><span style=color:#998;font-style:italic># CREATE TABLESPACE tempspace1 LOCATION &#39;/data/postgres/tempspace1&#39;;</span>
</span></span><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span><span style=color:#998;font-style:italic># CREATE TABLESPACE tempspace2 LOCATION &#39;/data/postgres/tempspace2&#39;;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span><span style=color:#998;font-style:italic># GRANT CREATE ON TABLESPACE tempspace1 TO testuser;</span>
</span></span><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span><span style=color:#998;font-style:italic># GRANT CREATE ON TABLESPACE tempspace2 TO testuser;</span>
</span></span></code></pre></div><p>使用普通用户登录，将<code>temp_tablespaces</code>变量设置为<code>tempspace1, tempspace2</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ psql -U testuser postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span>&gt; SET <span style=color:teal>temp_tablespaces</span> <span style=color:#000;font-weight:700>=</span> tempspace1, tempspace2;
</span></span><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span>&gt; SHOW temp_tablespaces;
</span></span><span style=display:flex><span>    temp_tablespaces
</span></span><span style=display:flex><span>------------------------
</span></span><span style=display:flex><span> tempspace1, tempspace2
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#099>1</span> row<span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>这样，即可使用了。需要注意的是，该种设置方式只在当前会话生效。若要永久生效，需要更改系统配置（<code>postgresql.conf</code>）。</p><h4 id=35-删除表空间>3.5 删除表空间</h4><p>表空间一旦创建，只要用户有权限，即可供任意数据库使用。要想删除表空间，须先将使用该表空间的数据库对象全部移除。</p><p>这样，即可使用<code>DROP TABLESPACE</code>命令来删除一个空表空间了：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ psql -U postgres postgres
</span></span><span style=display:flex><span><span style=color:teal>postgres</span><span style=color:#000;font-weight:700>=</span><span style=color:#998;font-style:italic># DROP TABLESPACE myspace;</span>
</span></span></code></pre></div><h3 id=4-表空间相关的系统表>4 表空间相关的系统表</h3><p>除了上面使用过的在 psql 使用<code>\db+</code>命令外，PostgreSQL 还有一些与表空间相关的系统目录或系统表。</p><p>查看已创建的表空间：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>pg_tablespace;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- 表空间名及目录位置
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>spcname,<span style=color:#bbb> </span>pg_tablespace_location(oid)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>pg_tablespace;<span style=color:#bbb>
</span></span></span></code></pre></div><p>查看某个表空间被哪些表或索引使用：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>c</span>.relname<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>pg_class<span style=color:#bbb>      </span><span style=color:#000;font-weight:700>c</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>pg_tablespace<span style=color:#bbb> </span>t<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>c</span>.reltablespace<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>t.oid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>t.spcname<span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#39;myspace&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>pg_tables<span style=color:#bbb> </span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>tablespace<span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#39;myspace&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>pg_indexes<span style=color:#bbb> </span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>tablespace<span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#39;myspace&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>综上，完成了对 PostgreSQL 表空间使用场景及使用方式的总结。</p><blockquote><p>参考资料</p><p>[1] <a href=https://www.postgresql.org/docs/14/manage-ag-tablespaces.html>PostgreSQL: Documentation: 14: 23.6. Tablespaces</a></p><p>[2] <a href=https://pgdash.io/blog/tablespaces-postgres.html>All About Tablespaces in PostgreSQL</a></p><p>[3] <a href=https://www.cybertec-postgresql.com/en/when-to-use-tablespaces-in-postgresql/>When to use tablespaces in PostgreSQL</a></p><p>[4] <a href=https://stackoverflow.com/questions/4970966/how-can-i-tell-what-is-in-a-postgresql-tablespace>How can I tell what is in a Postgresql tablespace?</a></p><p>[5] <a href=https://www.cnblogs.com/lottu/p/9239535.html>PostgreSQL 的表空间</a></p></blockquote></div><div class=content-footer><div class=weixinhao><img src=/static/images/self/weixinhao-white.jpg></div><div class=post-tags><a href=/tags/postgresql/>#PostgreSQL</a></div><div class=license><i class=ti-info-alt></i><div class=info>版权声明：该博客文章由作者通过「<a href=https://creativecommons.org/licenses/by/4.0/deed.zh>知识共享署名 4.0 许可证</a>」进行授权，转载须注明文章原始链接。</div></div></div></div><div class="col-lg-8 mx-auto block shadow"><h3>相关文章</h3><ul><li><a href=/posts/postgres-foreign-data-wrappers.html>PostgreSQL 外部数据包装器 postgres_fdw 使用详解</a></li><li><a href=/posts/azure-postgres.html>Azure Database for PostgreSQL 学习总结</a></li><li><a href=/posts/postgres-jdbc-driver-issue.html>PostgreSQL JDBC Driver 42.3.0 读取 BigDecimal 时发生抹 0 的 Bug</a></li><li><a href=/posts/postgres-ddl.html>PostgreSQL 数据定义相关知识总结</a></li><li><a href=/posts/postgres-table-partitioning.html>PostgreSQL 表分区使用详解</a></li></ul></div><div class="col-lg-8 mx-auto block shadow"><div><h3>评论</h3><div id=comment-loading style=text-align:center;font-size:14px><img style=width:52px src=/static/images/site/mona-loading-default.gif>
<span>正在加载评论......</span></div><script>function handleMessage(e){if(e.origin!=="https://giscus.app")return;if(typeof e.data!="object"||!e.data.giscus)return;const t=document.getElementById("comment-loading");t.style.display="none"}window.addEventListener("message",handleMessage)</script><script src=https://giscus.app/client.js data-repo=leileiluoluo/leileiluoluo.github.io data-repo-id=R_kgDOJkLT8w data-category=General data-category-id=DIC_kwDOJkLT884CdtEh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></div></div></section><footer class="py-4 bg-lights border-top"><div class=container><div class="row justify-content-between text-center align-items-center"><div class="col-lg-4 text-center text-lg-left mb-4 mb-lg-0"></div><div class="col-lg-4 text-center mb-4 mb-lg-0"><ul class="list-inline mb-0"><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/sponsor>随喜打赏</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/about>关于本博</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/links>友情链接</a></li></ul></div><div class="col-lg-4 text-lg-right text-center mb-4 mb-lg-0"><ul class="list-inline social-icon mb-0"><li class=list-inline-item><a title=文章归档 href=/archives/><i class=ti-archive></i></a></li><li class=list-inline-item><a title=文章标签 href=/tags/><i class=ti-tag></i></a></li><li class=list-inline-item><a title="我的 GitHub" href=https://github.com/leileiluoluo><i class=ti-github></i></a></li><li class=list-inline-item><a title="网站 RSS" href=/index.xml><i class=ti-rss></i></a></li></ul></div></div><div style=text-align:center;font-size:18px;margin-bottom:22px><a style="-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-image:linear-gradient(to right,#14100f,#d55b5b,#4d14e6)" href=https://www.boyouquan.com/planet-shuttle>「博友圈 · 星球穿梭」</a></div><div class="text-center mt-4"><span>Made with <a href=https://gohugo.io/>Hugo</a> | Theme by <a href=https://github.com/themefisher/northendlab-hugo>NorthendLab</a> | <a href=https://beian.miit.gov.cn>辽ICP备2022012085号-5</a> | Copyright © 2017-2025</span></div></div></footer><script>var indexURL="https://leileiluoluo.github.io/index.json"</script><script src=https://leileiluoluo.github.io/js/jquery.min.js></script><script src=https://leileiluoluo.github.io/js/bootstrap.min.js></script><script src=https://leileiluoluo.github.io/js/fuse.min.js></script><script src=https://leileiluoluo.github.io/js/mark.js></script><script src=https://leileiluoluo.github.io/js/search.js></script><script src=https://leileiluoluo.github.io/js/script.min.js></script></body></html>