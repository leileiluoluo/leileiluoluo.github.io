<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>Java 10 主要引入了哪些新特性？ - 磊磊落落</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=keywords content="Java 10,新特性"><meta name=description content="本文重点回顾 Java 10 引入的那些主要特性，包括：局部变量类型推断、应用程序类数据共享、JDK 仓库由多个合并为了一个、更清晰的垃圾收集器接口、G1 Full GC 并行化、线程本地握手等。"><meta name=author content="磊磊落落"><meta name=generator content="Hugo 0.123.7"><link rel=stylesheet href=https://leileiluoluo.github.io/css/bootstrap.min.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/themify-icons.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/larry-custom-v1.6.css><link rel=stylesheet href=https://leileiluoluo.github.io/scss/style.min.css media=screen><link rel="shortcut icon" href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><link rel=icon href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?526723b767317055572c85bdb445353c",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><header class="fixed-top navigation"><div class=container><nav class="navbar navbar-expand-lg navbar-light bg-transparent"><a class=navbar-brand href=https://leileiluoluo.github.io/>磊磊落落</a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/></a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/>计算机</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E9%9A%8F%E7%AC%94/>随笔</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AF%BB%E4%B9%A6/>读书</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%A7%82%E5%BD%B1/>观影</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E7%BB%83%E5%AD%97/>练字</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/about>关于</a></li></ul><div class=search><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://leileiluoluo.github.io//search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder=键入关键字后回车...></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><div class="py-5 d-none d-lg-block"></div><section class=section><div class=container><div class=row><div class="col-lg-8 mx-auto block shadow mb-5"><h1>Java 10 主要引入了哪些新特性？</h1><div class="mb-3 post-meta">2024年08月06日
<a href=/categories/%e8%ae%a1%e7%ae%97%e6%9c%ba>计算机</a></div><div class="content mb-5"><p>本文重点回顾 Java 10 引入的那些主要特性。</p><p><img loading=lazy src=https://leileiluoluo.github.io/static/images/uploads/2024/08/java-10-new-features.svg alt="Java 10 主要新特性脑图"></p><div style=text-align:center>（Java 10 主要新特性脑图）</div><h2 id=1-局部变量类型推断>1 局部变量类型推断</h2><p>局部变量类型推断是 Java 10 引入的一个重要特性。这个特性使得开发者在声明局部变量时可以使用关键字 <code>var</code> 来代替显式地指定变量类型，而局部变量的类型会由编译器自行推断。</p><p>注意该特性只适用于带有初始化器的局部变量声明（对于不含初始化器的局部变量声明，如 <code>var x</code>，是不合法的，因为编译器无法对其类型做出推断），不能用于方法的形式参数、构造器参数、方法的返回类型、类的成员变量或实例变量、异常捕获参数或任何其它类型的变量声明。</p><p>下面看一个例子：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#998;font-style:italic>// src/main/java/LocalVariableTypeReferenceTest.java</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>import</span><span style=color:#bbb> </span><span style=color:#555>java.io.BufferedReader</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>import</span><span style=color:#bbb> </span><span style=color:#555>java.io.FileReader</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>import</span><span style=color:#bbb> </span><span style=color:#555>java.io.IOException</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>import</span><span style=color:#bbb> </span><span style=color:#555>java.util.ArrayList</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>import</span><span style=color:#bbb> </span><span style=color:#555>java.util.List</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>import</span><span style=color:#bbb> </span><span style=color:#555>java.util.Map</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>public</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>LocalVariableTypeReferenceTest</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>public</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>static</span><span style=color:#bbb> </span><span style=color:#458;font-weight:700>void</span><span style=color:#bbb> </span><span style=color:#900;font-weight:700>main</span>(String<span style=color:#000;font-weight:700>[]</span><span style=color:#bbb> </span>args)<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#998;font-style:italic>// 在基础类型变量声明、泛型类型变量声明中使用 var</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>var</span><span style=color:#bbb> </span>num<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>10;<span style=color:#bbb> </span><span style=color:#998;font-style:italic>// int num = 10;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>var</span><span style=color:#bbb> </span>message<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#34;Hello World!&#34;</span>;<span style=color:#bbb> </span><span style=color:#998;font-style:italic>// String message = &#34;Hello World!&#34;;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>var</span><span style=color:#bbb> </span>list<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>new</span><span style=color:#bbb> </span>ArrayList<span style=color:#000;font-weight:700>&lt;</span>Map<span style=color:#000;font-weight:700>&lt;</span>String,<span style=color:#bbb> </span>List<span style=color:#000;font-weight:700>&lt;</span>Integer<span style=color:#000;font-weight:700>&gt;&gt;&gt;</span>();<span style=color:#bbb> </span><span style=color:#998;font-style:italic>// List&lt;Map&lt;String, List&lt;Integer&gt;&gt;&gt; list = new ArrayList&lt;&gt;();</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#998;font-style:italic>// 在普通 for 循环中使用 var</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>for</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>var</span><span style=color:#bbb> </span>i<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>0;<span style=color:#bbb> </span>i<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#bbb> </span>10;<span style=color:#bbb> </span>i<span style=color:#000;font-weight:700>++</span>)<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>System.<span style=color:teal>out</span>.<span style=color:teal>println</span>(i);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#998;font-style:italic>// 在增强 for 循环中使用 var</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>for</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>var</span><span style=color:#bbb> </span>str<span style=color:#bbb> </span>:<span style=color:#bbb> </span>List.<span style=color:teal>of</span>(<span style=color:#d14>&#34;Larry&#34;</span>,<span style=color:#bbb> </span><span style=color:#d14>&#34;Jacky&#34;</span>,<span style=color:#bbb> </span><span style=color:#d14>&#34;Alice&#34;</span>))<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>System.<span style=color:teal>out</span>.<span style=color:teal>println</span>(str);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#998;font-style:italic>// 在 try-with-resources 语句中使用 var</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>String<span style=color:#bbb> </span>filePath<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>LocalVariableTypeReferenceTest.<span style=color:teal>class</span>.<span style=color:teal>getResource</span>(<span style=color:#d14>&#34;test.txt&#34;</span>).<span style=color:teal>getPath</span>();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>try</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>var</span><span style=color:#bbb> </span>br<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>new</span><span style=color:#bbb> </span>BufferedReader(<span style=color:#000;font-weight:700>new</span><span style=color:#bbb> </span>FileReader(filePath)))<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>System.<span style=color:teal>out</span>.<span style=color:teal>println</span>(br.<span style=color:teal>readLine</span>());<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>}<span style=color:#bbb> </span><span style=color:#000;font-weight:700>catch</span><span style=color:#bbb> </span>(IOException<span style=color:#bbb> </span>e)<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>e.<span style=color:teal>printStackTrace</span>();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>上述示例，首先演示了 <code>var</code> 关键字在基础类型、泛型类型局部变量声明中的使用，注意右侧表达式必须明确指定变量的类型，这样编译器才能根据右侧表达式推断出左侧变量的类型；然后演示了 <code>var</code> 关键字在普通 <code>for</code> 循环和增强 <code>for</code> 循环局部变量声明中的使用；最后演示了 <code>var</code> 关键字在 try-with-resources 语句局部变量声明中的使用。</p><p>总的来说，局部变量类型推断可以让 Java 开发者在不损失类型安全的前提下编写出更为简洁的代码，但局部变量类型推断只当用在简单表达式或类型明确的情形，对于复杂表达式的情形，显式类型声明可以使代码更具可读性。</p><h2 id=2-应用程序类数据共享>2 应用程序类数据共享</h2><p>类数据共享（Class-Data Sharing）是在 Java 1.5 引入的，其允许将一组类预处理为共享存档文件，然后可以在运行时对其进行内存映射以缩短启动时间。当多个 JVM 实例共享同一个存档文件时，它还可以减少动态内存占用。</p><p>不同于 Java 1.5 的类数据共享针对的是系统类库和通用 JVM 实例之间的共享优化，Java 10 引入的应用程序类数据共享（Application Class-Data Sharing）针对的是应用程序级别的类数据共享。它允许同一应用程序的多个 Java 运行时实例之间共享特定于该应用程序的类数据和资源，以进一步优化启动时间和内存占用。</p><p>默认情况下，仅为 JVM 的引导类加载器（Bootstrap Class Loader）启用了应用程序类数据共享。指定了 <code>-XX:+UseAppCDS</code> 命令行选项后即可为系统类加载器、平台类加载器和其它用户定义的类加载器启用类数据共享。</p><p>下面即演示一下应用程序类数据共享特性的使用：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#998;font-style:italic># 确定要存档的类</span>
</span></span><span style=display:flex><span>java -Xshare:off -XX:+UseAppCDS -XX:DumpLoadedClassList<span style=color:#000;font-weight:700>=</span>myapp.lst <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    -cp myapp.jar MyApp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># 创建存档文件</span>
</span></span><span style=display:flex><span>java -Xshare:dump -XX:+UseAppCDS -XX:SharedClassListFile<span style=color:#000;font-weight:700>=</span>myapp.lst <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    -XX:SharedArchiveFile<span style=color:#000;font-weight:700>=</span>myapp.jsa -cp myapp.jar
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># 使用存档文件</span>
</span></span><span style=display:flex><span>java -Xshare:on -XX:+UseAppCDS -XX:SharedArchiveFile<span style=color:#000;font-weight:700>=</span>myapp.jsa <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>    -cp myapp.jar MyApp
</span></span></code></pre></div><p>可以看到，如上示例共有三个步骤：第一步负责确定要存档的类，使用 <code>-XX:DumpLoadedClassList</code> 参数指定了要生成的共享类列表文件；第二步负责创建共享存档文件，使用 <code>-XX:SharedClassListFile</code> 参数指定了前一步生成的共享类列表文件，并使用 <code>-XX:SharedArchiveFile</code> 参数指定了要生成的共享存档文件；第三步负责使用存档文件，在应用程序启动时，使用 <code>-XX:SharedArchiveFile</code> 参数指定了前一步生成的共享存档文件，这样 JVM 将加载存档文件中预定义的类数据，而不需要重新解析和加载相同的类文件，加速了应用程序的启动过程并减少内存占用。</p><h2 id=3-jdk-仓库由多个合并为了一个>3 JDK 仓库由多个合并为了一个</h2><p>Java 10 将原先分散管理的多个 Mercurial JDK 源码仓库合并为了一个 Git 仓库，并托管在了 GitHub 上。在此之前，每个主要的 JDK 组件（如 HotSpot、JDK、JAXP 等）都拥有一个单独的 Mercurial 仓库。这样要做一个整体更新时，需要针对各个仓库做出修改，非常的不方便。而合并后的 Git 仓库在人员协作方面、管理方面就方便多了。</p><p>此外，这也为社区开发人员提交 Bug、贡献 PR、参与讨论提供了方便。不可否认，这是一个重要的基础设施变更，对于 JDK 的开发者和维护者来说具有重要的影响，也为未来 JDK 的高效发布提供了基础。</p><h2 id=4-更清晰的垃圾收集器接口>4 更清晰的垃圾收集器接口</h2><p>Java 10 以前，虽然每个垃圾收集器的实现都位于 <code>src/hotspot/share/gc/$NAME</code> 文件夹下（如：G1 在 <code>src/hotspot/share/gc/g1</code> 文件夹下，CMS 在 <code>src/hotspot/share/gc/cms</code> 文件夹下等），但垃圾收集器的一些公共部分的实现则散落在 HotSpot 源代码的各个位置。这样，在实现一个新的垃圾收集器时，需要从 HotSpot 代码中找出所有需要修改的位置，而且在构建时，很难排除一个或多个收集器。</p><p>Java 10 将这部分进行了梳理，设计了一组更加清晰的垃圾收集器接口，将极大地简化实现新的垃圾收集器的过程（只需要实现一组接口即可），而且在构建时，可以很容易排除一个或多个收集器。</p><h2 id=5-g1-full-gc-并行化>5 G1 Full GC 并行化</h2><p>Java 9 将 G1 垃圾收集器设置为了默认的垃圾收集器。为了提升垃圾收集器的性能，Java 10 将 G1 垃圾收集器的 Full GC 阶段进行了并行化改造。</p><p>我们知道，G1 垃圾收集器是 Java 7 引入的一种垃圾收集器，是传统吞吐量优先垃圾收集器（如并行收集器）的一种替代方案。它的设计目标是在处理大内存堆时相比传统的垃圾收集器具有更好的预测性和更低的停顿时间。</p><p>G1 垃圾收集器将堆内存分成多个区域（分年轻代和老年代，年轻代又分为 Eden 区和 Survivor 区），从而可以更加高效地管理内存。虽然 G1 垃圾收集器使用的增量和并发技术减少了多数收集阶段的停顿时间，但对于 Full GC 阶段，仍需要暂停所有应用程序线程，从而造成 Stop-The-World 事件。而 Java 10 将 G1 垃圾收集器的 Full GC 阶段进行并行化改造后，可以有效利用多核处理器的并行处理能力，从而减少停顿时间、提高应用程序的整体性能。</p><h2 id=6-线程本地握手>6 线程本地握手</h2><p>在传统的 Java 虚拟机中，线程之间的协作和通信通常依赖于全局的同步机制（如锁和信号量）。这些机制虽然功能强大，但在某些情况下（尤其是在高并发场景下）会导致性能瓶颈，为了解决这些问题，Java 10 引入了线程本地握手（Thread-Local Handshakes）机制。</p><p>线程本地握手允许 Java 虚拟机在线程状态发生变化时，仅对受影响的线程执行局部操作，而无需全局同步。这种操作是通过一种称为「握手」的机制实现的，其基本思想是允许线程在进入或退出关键区域时，通过与 Java 虚拟机发起握手来进行状态变更通知。</p><h2 id=7-备用内存设备上的堆分配>7 备用内存设备上的堆分配</h2><p>传统上，Java 的堆内存通常是分配在主内存中的。随着非易失性内存（NVM）等新型内存技术的发展，这些备用内存设备提供了更高的容量和更低的访问延迟，同时具有持久性特性。因此，Java 10 允许将堆内存扩展到这些设备上可以带来更多的灵活性和性能优势。</p><h2 id=8-基于-java-的实验型-jit-编译器>8 基于 Java 的实验型 JIT 编译器</h2><p>传统上，Java 虚拟机的 JIT 编译器（Just-In-Time Compiler）是用 C++ 语言编写的。然而，使用 Java 语言编写的 JIT 编译器具有一些潜在的优势，比如更容易理解和维护、更灵活的扩展性以及更好的跨平台兼容性。Java 10 引入了一个实验性的使用 Java 语言编写的 JIT（Just-In-Time）编译器，称为 Graal 编译器，它提供了一种替代 HotSpot JIT 编译器的选择。</p><p>需要注意的是，尽管 Graal 编译器在性能和延迟方面可能带来优势，但它仍然是一个实验性的特性，并且在某些情况下可能与特定的代码或库不兼容。此外，Graal 编译器在编译速度和内存消耗方面可能会有一些不足，具体取决于应用程序的特点和配置。为了启用 Graal 编译器，需要在 JDK 10 的启动参数中添加 <code>-XX:+UnlockExperimentalVMOptions -XX:+UseJVMCICompiler</code>。</p><h2 id=9-根证书>9 根证书</h2><p>根证书库（cacerts）中包含了一系列受信任的根证书，用于验证 SSL/TLS 连接和其他安全通信。这些根证书由各种受信任的证书颁发机构（CA，Certificate Authority）签发，包括常见的公共 CA 如 VeriSign、Thawte、DigiCert 等。Java 10 对根证书库进行了更新（位于 JDK 安装目录的 <code>jre/lib/security/cacerts</code> 目录下），以反映最新的根证书颁发机构和信任链。我们可以使用 JDK 提供的 <code>keytool</code> 工具来执行与根证书库相关的操作，例如查看证书、添加新的根证书、删除根证书等。</p><h2 id=10-collections-api-增强>10 Collections API 增强</h2><p>Java 10 在 Collections API 添加了新的 <code>copyOf()</code> 方法，方便创建不可变集合。<code>java.util.stream</code> 包中的 <code>Collectors</code> 类添加了新方法 <code>toUnmodifiableList()</code>、<code>toUnmodifiableSet()</code> 和 <code>toUnmodifiableMap()</code>，这些方法允许将 Stream 转换为一个不可修改的集合。</p><p>请看一段示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#998;font-style:italic>// src/main/java/CollectionsEnhancementsTest.java</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>import</span><span style=color:#bbb> </span><span style=color:#555>java.util.*</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>import</span><span style=color:#bbb> </span><span style=color:#555>java.util.stream.Collectors</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>import</span><span style=color:#bbb> </span><span style=color:#555>java.util.stream.Stream</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>public</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>CollectionsEnhancementsTest</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>static</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>Student</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>private</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>final</span><span style=color:#bbb> </span>String<span style=color:#bbb> </span>name;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>private</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>final</span><span style=color:#bbb> </span><span style=color:#458;font-weight:700>int</span><span style=color:#bbb> </span>age;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>public</span><span style=color:#bbb> </span><span style=color:#900;font-weight:700>Student</span>(String<span style=color:#bbb> </span>name,<span style=color:#bbb> </span><span style=color:#458;font-weight:700>int</span><span style=color:#bbb> </span>age)<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#000;font-weight:700>this</span>.<span style=color:teal>name</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>name;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#000;font-weight:700>this</span>.<span style=color:teal>age</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>age;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>public</span><span style=color:#bbb> </span>String<span style=color:#bbb> </span><span style=color:#900;font-weight:700>getName</span>()<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span>name;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>public</span><span style=color:#bbb> </span><span style=color:#458;font-weight:700>int</span><span style=color:#bbb> </span><span style=color:#900;font-weight:700>getAge</span>()<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span>age;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>public</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>static</span><span style=color:#bbb> </span><span style=color:#458;font-weight:700>void</span><span style=color:#bbb> </span><span style=color:#900;font-weight:700>main</span>(String<span style=color:#000;font-weight:700>[]</span><span style=color:#bbb> </span>args)<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#998;font-style:italic>// 根据原 List、Set 和 Map，使用 copyOf 创建一个不可变的 List、Set 和 Map</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>List<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span>originalList<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>new</span><span style=color:#bbb> </span>ArrayList<span style=color:#000;font-weight:700>&lt;&gt;</span>();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>List<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span>immutableList<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>List.<span style=color:teal>copyOf</span>(originalList);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>Set<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span>originalSet<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>new</span><span style=color:#bbb> </span>HashSet<span style=color:#000;font-weight:700>&lt;&gt;</span>();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>Set<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span>immutableSet<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>Set.<span style=color:teal>copyOf</span>(originalSet);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>Map<span style=color:#000;font-weight:700>&lt;</span>String,<span style=color:#bbb> </span>Integer<span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span>originalMap<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>new</span><span style=color:#bbb> </span>HashMap<span style=color:#000;font-weight:700>&lt;&gt;</span>();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>Map<span style=color:#000;font-weight:700>&lt;</span>String,<span style=color:#bbb> </span>Integer<span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span>immutableMap<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>Map.<span style=color:teal>copyOf</span>(originalMap);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#998;font-style:italic>// 转换为不可修改的 List、Set 和 Map</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>List<span style=color:#000;font-weight:700>&lt;</span>Integer<span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span>unmodifiableList<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>Stream.<span style=color:teal>of</span>(1,<span style=color:#bbb> </span>2,<span style=color:#bbb> </span>3)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span>.<span style=color:teal>collect</span>(Collectors.<span style=color:teal>toUnmodifiableList</span>());<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>Set<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span>unmodifiableSet<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>Stream.<span style=color:teal>of</span>(<span style=color:#d14>&#34;Larry&#34;</span>,<span style=color:#bbb> </span><span style=color:#d14>&#34;Jacky&#34;</span>,<span style=color:#bbb> </span><span style=color:#d14>&#34;Alice&#34;</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span>.<span style=color:teal>collect</span>(Collectors.<span style=color:teal>toUnmodifiableSet</span>());<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>Map<span style=color:#000;font-weight:700>&lt;</span>String,<span style=color:#bbb> </span>Integer<span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span>unmodifiableMap<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>Stream.<span style=color:teal>of</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span><span style=color:#000;font-weight:700>new</span><span style=color:#bbb> </span>Student(<span style=color:#d14>&#34;Larry&#34;</span>,<span style=color:#bbb> </span>28),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span><span style=color:#000;font-weight:700>new</span><span style=color:#bbb> </span>Student(<span style=color:#d14>&#34;Jacky&#34;</span>,<span style=color:#bbb> </span>29),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span><span style=color:#000;font-weight:700>new</span><span style=color:#bbb> </span>Student(<span style=color:#d14>&#34;Alice&#34;</span>,<span style=color:#bbb> </span>19)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>).<span style=color:teal>collect</span>(Collectors.<span style=color:teal>toUnmodifiableMap</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span>Student::getName,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span>Student::getAge)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>如上示例，首先演示了如何基于原 <code>List</code>、<code>Set</code> 和 <code>Map</code>，使用集合的静态 <code>copyOf</code> 方法创建一个不可变的 <code>List</code>、<code>Set</code> 和 <code>Map</code>，任何针对不可变集合的修改操作都会抛出 <code>UnsupportedOperationException</code>；然后演示了如何将 Stream 转换为一个不可修改的 <code>List</code>、<code>Set</code> 或 <code>Map</code>，针对不可修改集合的任何修改操作也都会抛出 <code>UnsupportedOperationException</code>。</p><h2 id=11-optional-类添加了-orelsethrow-方法>11 Optional 类添加了 orElseThrow() 方法</h2><p>Java 10 在 <code>Optional</code> 类添加了一个新的 <code>orElseThrow()</code> 方法，该方法允许我们从 <code>Optional</code> 对象中获取值时，如果值不存在，则抛出指定的异常。</p><p>请看一段示例代码：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#998;font-style:italic>// src/main/java/OptionalEnhancementsTest.java</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>import</span><span style=color:#bbb> </span><span style=color:#555>java.util.NoSuchElementException</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>import</span><span style=color:#bbb> </span><span style=color:#555>java.util.Optional</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>public</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>OptionalEnhancementsTest</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>public</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>static</span><span style=color:#bbb> </span><span style=color:#458;font-weight:700>void</span><span style=color:#bbb> </span><span style=color:#900;font-weight:700>main</span>(String<span style=color:#000;font-weight:700>[]</span><span style=color:#bbb> </span>args)<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#998;font-style:italic>// 使用 orElseThrow() 抛出自定义异常</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>Optional.<span style=color:teal>empty</span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span>.<span style=color:teal>orElseThrow</span>(()<span style=color:#bbb> </span><span style=color:#000;font-weight:700>-&gt;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>new</span><span style=color:#bbb> </span>NoSuchElementException(<span style=color:#d14>&#34;值不存在&#34;</span>));<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><p>可以看到，<code>orElseThrow()</code> 方法为 <code>Optional</code> 类增加了一种处理缺失值的方式，使得代码在处理可能为空的情况时更加优雅和安全。</p><p>综上，我们速览了 Java 10 引入的那些主要特性。本文涉及的所有示例代码已提交至 <a href=https://github.com/leileiluoluo/java-exercises/tree/main/java-10-new-features-demo/src/main/java>GitHub</a>，欢迎关注或 Fork。</p><blockquote><p>参考资料</p><p>[1] Oracle: Consolidated JDK 10 Release Notes - <a href=https://www.oracle.com/java/technologies/javase/10all-relnotes.html>https://www.oracle.com/java/technologies/javase/10all-relnotes.html</a></p><p>[2] OpenJDK: JDK 10 - <a href=https://openjdk.org/projects/jdk/10/>https://openjdk.org/projects/jdk/10/</a></p><p>[3] OpenJDK: Java SE 10 (18.3) (JSR 383) Final Release Specification - <a href=https://cr.openjdk.org/~iris/se/10/latestSpec/>https://cr.openjdk.org/~iris/se/10/latestSpec/</a></p><p>[4] OpenJDK: JEP 286: Local-Variable Type Inference - <a href=https://openjdk.org/jeps/286>https://openjdk.org/jeps/286</a></p><p>[5] 掘金：一口气读完 Java 8 ~ Java 21 所有新特性 - <a href=https://juejin.cn/post/7315730050577006592>https://juejin.cn/post/7315730050577006592</a></p><p>[6] 掘金：JDK 8 - JDK 17 新特性总结 - <a href=https://juejin.cn/post/7250734439709048869>https://juejin.cn/post/7250734439709048869</a></p></blockquote></div><div class=content-footer><div class=weixinhao><img src=/static/images/self/weixinhao-white.jpg></div><div class=post-tags><a href=/tags/java/>#Java</a></div><div class=license><i class=ti-info-alt></i><div class=info>版权声明：该博客文章由作者通过「<a href=https://creativecommons.org/licenses/by/4.0/deed.zh>知识共享署名 4.0 许可证</a>」进行授权，转载须注明文章原始链接。</div></div></div></div><div class="col-lg-8 mx-auto block shadow"><h3>相关文章</h3><ul><li><a href=/posts/spring-boot-and-thymeleaf-integration.html>Spring Boot 集成 Thymeleaf 搭建 Web 应用</a></li><li><a href=/posts/spring-cloud-config-server-setup.html>如何搭建 Spring Cloud 统一配置服务？</a></li><li><a href=/posts/java-13-new-features.html>Java 13 主要引入了哪些新特性？</a></li><li><a href=/posts/java-12-new-features.html>Java 12 主要引入了哪些新特性？</a></li><li><a href=/posts/java-11-new-features.html>Java 11 主要引入了哪些新特性？</a></li></ul></div><div class="col-lg-8 mx-auto block shadow"><div><h3>评论</h3><div id=comment-loading style=text-align:center;font-size:14px><img style=width:52px src=/static/images/site/mona-loading-default.gif>
<span>正在加载评论......</span></div><script>function handleMessage(e){if(e.origin!=="https://giscus.app")return;if(typeof e.data!="object"||!e.data.giscus)return;const t=document.getElementById("comment-loading");t.style.display="none"}window.addEventListener("message",handleMessage)</script><script src=https://giscus.app/client.js data-repo=leileiluoluo/leileiluoluo.github.io data-repo-id=R_kgDOJkLT8w data-category=General data-category-id=DIC_kwDOJkLT884CdtEh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></div></div></section><footer class="py-4 bg-lights border-top"><div class=container><div class="row justify-content-between text-center align-items-center"><div class="col-lg-4 text-center text-lg-left mb-4 mb-lg-0"></div><div class="col-lg-4 text-center mb-4 mb-lg-0"><ul class="list-inline mb-0"><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/sponsor>随喜打赏</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/about>关于本博</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/links>友情链接</a></li></ul></div><div class="col-lg-4 text-lg-right text-center mb-4 mb-lg-0"><ul class="list-inline social-icon mb-0"><li class=list-inline-item><a title=文章归档 href=/archives/><i class=ti-archive></i></a></li><li class=list-inline-item><a title=文章标签 href=/tags/><i class=ti-tag></i></a></li><li class=list-inline-item><a title="我的 GitHub" href=https://github.com/leileiluoluo><i class=ti-github></i></a></li><li class=list-inline-item><a title="网站 RSS" href=/index.xml><i class=ti-rss></i></a></li></ul></div></div><div style=text-align:center;font-size:18px;margin-bottom:22px><a style="-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-image:linear-gradient(to right,#14100f,#d55b5b,#4d14e6)" href=https://www.boyouquan.com/planet-shuttle>「博友圈 · 星球穿梭」</a></div><div class="text-center mt-4"><span>Made with <a href=https://gohugo.io/>Hugo</a> | Theme by <a href=https://github.com/themefisher/northendlab-hugo>NorthendLab</a> | <a href=https://beian.miit.gov.cn>辽ICP备2022012085号-5</a> | Copyright © 2017-2024</span></div></div></footer><script>var indexURL="https://leileiluoluo.github.io/index.json"</script><script src=https://leileiluoluo.github.io/js/jquery.min.js></script><script src=https://leileiluoluo.github.io/js/bootstrap.min.js></script><script src=https://leileiluoluo.github.io/js/fuse.min.js></script><script src=https://leileiluoluo.github.io/js/mark.js></script><script src=https://leileiluoluo.github.io/js/search.js></script><script src=https://leileiluoluo.github.io/js/script.min.js></script></body></html>