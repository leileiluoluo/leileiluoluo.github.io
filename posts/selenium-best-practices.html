<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>Selenium 自动化测试最佳实践 - 磊磊落落</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=keywords content="Selenium,自动化测试,最佳实践,Python,页面对象模型"><meta name=description content="本文总结了 Selenium 自动化测试的最佳实践，即构建一个大型测试项目时分析需求的基本指导思想、编排测试代码的实践策略（页面对象模型）以及使用定位器的推荐顺序。"><meta name=author content="磊磊落落"><meta name=generator content="Hugo 0.123.7"><link rel=stylesheet href=https://leileiluoluo.github.io/css/bootstrap.min.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/themify-icons.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/larry-custom-v1.6.css><link rel=stylesheet href=https://leileiluoluo.github.io/scss/style.min.css media=screen><link rel="shortcut icon" href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><link rel=icon href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?526723b767317055572c85bdb445353c",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><header class="fixed-top navigation"><div class=container><nav class="navbar navbar-expand-lg navbar-light bg-transparent"><a class=navbar-brand href=https://leileiluoluo.github.io/>磊磊落落</a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/></a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/>计算机</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E9%9A%8F%E7%AC%94/>随笔</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AF%BB%E4%B9%A6/>读书</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%A7%82%E5%BD%B1/>观影</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E7%BB%83%E5%AD%97/>练字</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/about>关于</a></li></ul><div class=search><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://leileiluoluo.github.io//search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder=键入关键字后回车...></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><div class="py-5 d-none d-lg-block"></div><section class=section><div class=container><div class=row><div class="col-lg-8 mx-auto block shadow mb-5"><h1>Selenium 自动化测试最佳实践</h1><div class="mb-3 post-meta">2023年05月10日
<a href=/categories/%e8%ae%a1%e7%ae%97%e6%9c%ba>计算机</a></div><div class="content mb-5"><p>前两篇文章「<a href=https://leileiluoluo.github.io/posts/selenium-webdriver.html>Selenium WebDriver 基础使用</a>」和「<a href=https://leileiluoluo.github.io/posts/selenium-webdriver-advanced-features.html>Selenium WebDriver 高级特性使用</a>」分别介绍了 Selenium WebDriver 的基础功能和高级功能的使用。这两篇文章更多的是从底层实现细节的角度去练习 Selenium WebDriver API 的使用。</p><p>本文将探讨「构建一个 Selenium 自动化测试项目的最佳实践是什么样的？」，该部分更多的是从上层设计与架构的角度自顶向下来思考一个大型测试项目的构建。包括：编码前有什么准备工作？有没有一个基本的指导思想。如何编排测试代码？如何根据情况使用适当的定位器？下面会一一讨论。</p><p>本文涉及的所有示例程序均使用 Python 语言描述。下面列出本文所使用的 Python 版本、Selenium 版本和 Chrome 浏览器版本信息。</p><ul><li>Python 版本：3.11.3</li><li>Selenium 版本：4.9.1</li><li>Chrome 浏览器版本：113</li></ul><h2 id=1-编码前的准备工作与基本指导思想>1 编码前的准备工作与基本指导思想</h2><p>测试一个网站就是针对该网站测试场景的一次项目开发，所以项目开发中的理念与思想可以借鉴过来。接到测试需求后，不要一开始就陷入按钮、字段、下拉框等页面元素怎么操作的技术细节当中，而要站在最终用户的角度去分析这个测试需求的交互逻辑和依赖关系，从而将其拆解为一个个相对独立的测试用例。而对于每一个测试用例，并不是每一步都必须使用 Selenium 去自动化实现，而是要根据实际情况将关键的部分自动化，其它非关键的部分可以通过植入数据或调用 API 来实现。</p><p>拆解完成后，应该如何编排测试代码？下面将探讨这个问题。</p><h2 id=2-如何编排测试代码>2 如何编排测试代码？</h2><p>如何编排测试代码？即采用何种策略组织与编排测试代码，从而让代码更简洁且更好维护。</p><p>我们依然使用实际的例子来说明将要探讨的问题。</p><p>下面是一个「<a href=https://www.selenium.dev/selenium/web/web-form.html>Selenium Web 表单示例页面</a>」的自动化测试动图：</p><p><img loading=lazy src=https://leileiluoluo.github.io/static/images/uploads/2023/05/selenium-web-form.gif#center alt="Selenium Web 表单示例页面"></p><p>可以看到，该动图展示的自动化测试代码对表单页面进行了文本输入、密码输入、下拉框选项选择和日期输入，并点击了提交按钮，最后跳转至已提交页面。</p><p>对应动图原始的 Python 测试代码（<a href=https://github.com/leileiluoluo/python-exercises/blob/main/selenium-best-practices/page-object-model/original_form_test.py>original_form_test.py</a>）如下：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>unittest</span> <span style=color:#000;font-weight:700>import</span> TestCase
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>selenium</span> <span style=color:#000;font-weight:700>import</span> webdriver
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>selenium.webdriver.common.by</span> <span style=color:#000;font-weight:700>import</span> By
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>selenium.webdriver.support.select</span> <span style=color:#000;font-weight:700>import</span> Select
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>selenium.webdriver.support.wait</span> <span style=color:#000;font-weight:700>import</span> WebDriverWait
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>selenium.webdriver.support</span> <span style=color:#000;font-weight:700>import</span> expected_conditions <span style=color:#000;font-weight:700>as</span> EC
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>TestForm</span>(TestCase):
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>def</span> <span style=color:#900;font-weight:700>setUp</span>(<span style=color:#999>self</span>) <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver <span style=color:#000;font-weight:700>=</span> webdriver<span style=color:#000;font-weight:700>.</span>Chrome()
</span></span><span style=display:flex><span>        <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>addCleanup(<span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>quit)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>def</span> <span style=color:#900;font-weight:700>test_web_form</span>(<span style=color:#999>self</span>) <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#998;font-style:italic># 打开表单页面</span>
</span></span><span style=display:flex><span>        <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>get(<span style=color:#d14>&#39;https://www.selenium.dev/selenium/web/web-form.html&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>assertEqual(<span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>title, <span style=color:#d14>&#39;Web form&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#998;font-style:italic># Text 输入</span>
</span></span><span style=display:flex><span>        text_input_elem <span style=color:#000;font-weight:700>=</span> <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>find_element(By<span style=color:#000;font-weight:700>.</span>ID, <span style=color:#d14>&#39;my-text-id&#39;</span>)
</span></span><span style=display:flex><span>        text_input_elem<span style=color:#000;font-weight:700>.</span>send_keys(<span style=color:#d14>&#39;Selenium&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#998;font-style:italic># Password 输入</span>
</span></span><span style=display:flex><span>        password_elem <span style=color:#000;font-weight:700>=</span> <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>find_element(By<span style=color:#000;font-weight:700>.</span>NAME, <span style=color:#d14>&#39;my-password&#39;</span>)
</span></span><span style=display:flex><span>        password_elem<span style=color:#000;font-weight:700>.</span>send_keys(<span style=color:#d14>&#39;Selenium&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#998;font-style:italic># Dropdown 选择</span>
</span></span><span style=display:flex><span>        dropdown_elem <span style=color:#000;font-weight:700>=</span> Select(<span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>find_element(By<span style=color:#000;font-weight:700>.</span>NAME, <span style=color:#d14>&#39;my-select&#39;</span>))
</span></span><span style=display:flex><span>        dropdown_elem<span style=color:#000;font-weight:700>.</span>select_by_value(<span style=color:#d14>&#39;2&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#998;font-style:italic># 日期输入</span>
</span></span><span style=display:flex><span>        date_input_elem <span style=color:#000;font-weight:700>=</span> <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>find_element(By<span style=color:#000;font-weight:700>.</span>XPATH, <span style=color:#d14>&#39;//input[@name=&#34;my-date&#34;]&#39;</span>)
</span></span><span style=display:flex><span>        date_input_elem<span style=color:#000;font-weight:700>.</span>send_keys(<span style=color:#d14>&#39;05/10/2023&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#998;font-style:italic># 点击 Submit 按钮</span>
</span></span><span style=display:flex><span>        submit_button_elem <span style=color:#000;font-weight:700>=</span> <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>find_element(By<span style=color:#000;font-weight:700>.</span>XPATH, <span style=color:#d14>&#39;//button[@type=&#34;submit&#34;]&#39;</span>)
</span></span><span style=display:flex><span>        submit_button_elem<span style=color:#000;font-weight:700>.</span>click()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#998;font-style:italic># 等待进入已提交页面</span>
</span></span><span style=display:flex><span>        WebDriverWait(<span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver, <span style=color:#099>10</span>)<span style=color:#000;font-weight:700>.</span>until(EC<span style=color:#000;font-weight:700>.</span>title_is(<span style=color:#d14>&#39;Web form - target page&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#998;font-style:italic># 断言</span>
</span></span><span style=display:flex><span>        message <span style=color:#000;font-weight:700>=</span> <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>find_element(By<span style=color:#000;font-weight:700>.</span>ID, <span style=color:#d14>&#39;message&#39;</span>)<span style=color:#000;font-weight:700>.</span>text
</span></span><span style=display:flex><span>        <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>assertEqual(message, <span style=color:#d14>&#39;Received!&#39;</span>)
</span></span></code></pre></div><p>可以看到，这是一种常见的最直接的测试代码编写方式。</p><p>然而这种写法存在几个问题：</p><ul><li><p>测试代码（<code>assertEqual</code>）和定位与操作元素的代码（<code>find_element ... send_keys ... click</code>）耦合在一起。这样，如果元素定位标识发生变化或者元素操作方式发生变化，这块测试代码都需要修改。</p></li><li><p>如果要编写针对该页面本身或者依赖该页面的其它测试代码，定位与操作元素的代码都需要重写一遍。</p></li></ul><p>要解决如上问题，须从代码结构与代码编排上着手，即引入一种设计模式 —— 页面对象模型。</p><p><strong>页面对象模型（Page Object Model）借鉴了面向对象编程的思想，是一种在自动化测试中被广泛使用的设计模式，用于减少重复代码并增加代码的可维护性。页面对象是一个面向对象的类，其将同一页面的 Web 元素存储在同一个对象中；当需要与该对象的 UI 进行交互时，不直接访问该页面的 Web 元素，而通过调用该对象提供的方法来实现。这样做的好处是如果某个页面的 UI 发生了改变，测试代码无须更改，只需要更改对应页面对象内的代码即可。</strong></p><p>总结一下，使用页面对象模型的好处包括：</p><ul><li>测试代码与特定于页面的代码分离（增加了简洁性）；</li><li>页面元素和功能被封装在页面对象的属性和方法中，而不是让其分散在整个测试代码中（减少了重复代码并增加了可维护性）。</li></ul><p>下面就使用页面对象模型设计一下测试项目的目录结构：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ tree
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>├─ pages
</span></span><span style=display:flex><span>│   ├─ form.py
</span></span><span style=display:flex><span>│   └─ form_target.py
</span></span><span style=display:flex><span>└─ optimized_form_test.py
</span></span></code></pre></div><p>可以看到，针对各个页面的页面对象被放在<code>pages</code>目录下，编写测试用例时调用其对应的方法即可。</p><p>下面看一下优化后的代码。</p><p><code>Form</code>页面对象代码（<a href=https://github.com/leileiluoluo/python-exercises/blob/main/selenium-best-practices/page-object-model/form.py>form.py</a>）：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>selenium.webdriver.common.by</span> <span style=color:#000;font-weight:700>import</span> By
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>selenium.webdriver.support.select</span> <span style=color:#000;font-weight:700>import</span> Select
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>selenium.webdriver.support.wait</span> <span style=color:#000;font-weight:700>import</span> WebDriverWait
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>selenium.webdriver.support</span> <span style=color:#000;font-weight:700>import</span> expected_conditions <span style=color:#000;font-weight:700>as</span> EC
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>pages.form_target</span> <span style=color:#000;font-weight:700>import</span> FormTarget
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>typing</span> <span style=color:#000;font-weight:700>import</span> Self
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>Form</span>:
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>def</span> __init__(<span style=color:#999>self</span>, driver) <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver <span style=color:#000;font-weight:700>=</span> driver
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>def</span> <span style=color:#900;font-weight:700>open</span>(<span style=color:#999>self</span>) <span style=color:#000;font-weight:700>-&gt;</span> Self:
</span></span><span style=display:flex><span>        <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>get(<span style=color:#d14>&#39;https://www.selenium.dev/selenium/web/web-form.html&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>return</span> <span style=color:#999>self</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>def</span> <span style=color:#900;font-weight:700>get_title</span>(<span style=color:#999>self</span>) <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#0086b3>str</span>:
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>return</span> <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>title
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>def</span> <span style=color:#900;font-weight:700>input_text</span>(<span style=color:#999>self</span>, text: <span style=color:#0086b3>str</span>) <span style=color:#000;font-weight:700>-&gt;</span> Self:
</span></span><span style=display:flex><span>        elem <span style=color:#000;font-weight:700>=</span> <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>find_element(By<span style=color:#000;font-weight:700>.</span>ID, <span style=color:#d14>&#39;my-text-id&#39;</span>)
</span></span><span style=display:flex><span>        elem<span style=color:#000;font-weight:700>.</span>send_keys(text)
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>return</span> <span style=color:#999>self</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>def</span> <span style=color:#900;font-weight:700>input_password</span>(<span style=color:#999>self</span>, password: <span style=color:#0086b3>str</span>) <span style=color:#000;font-weight:700>-&gt;</span> Self:
</span></span><span style=display:flex><span>        elem <span style=color:#000;font-weight:700>=</span> <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>find_element(By<span style=color:#000;font-weight:700>.</span>NAME, <span style=color:#d14>&#39;my-password&#39;</span>)
</span></span><span style=display:flex><span>        elem<span style=color:#000;font-weight:700>.</span>send_keys(password)
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>return</span> <span style=color:#999>self</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>def</span> <span style=color:#900;font-weight:700>select_from_dropdown</span>(<span style=color:#999>self</span>, value: <span style=color:#0086b3>str</span>) <span style=color:#000;font-weight:700>-&gt;</span> Self:
</span></span><span style=display:flex><span>        elem <span style=color:#000;font-weight:700>=</span> Select(<span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>find_element(By<span style=color:#000;font-weight:700>.</span>NAME, <span style=color:#d14>&#39;my-select&#39;</span>))
</span></span><span style=display:flex><span>        elem<span style=color:#000;font-weight:700>.</span>select_by_value(value)
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>return</span> <span style=color:#999>self</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>def</span> <span style=color:#900;font-weight:700>input_date</span>(<span style=color:#999>self</span>, date: <span style=color:#0086b3>str</span>) <span style=color:#000;font-weight:700>-&gt;</span> Self:
</span></span><span style=display:flex><span>        elem <span style=color:#000;font-weight:700>=</span> <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>find_element(By<span style=color:#000;font-weight:700>.</span>XPATH, <span style=color:#d14>&#39;//input[@name=&#34;my-date&#34;]&#39;</span>)
</span></span><span style=display:flex><span>        elem<span style=color:#000;font-weight:700>.</span>send_keys(date)
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>return</span> <span style=color:#999>self</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>def</span> <span style=color:#900;font-weight:700>submit</span>(<span style=color:#999>self</span>) <span style=color:#000;font-weight:700>-&gt;</span> FormTarget:
</span></span><span style=display:flex><span>        elem <span style=color:#000;font-weight:700>=</span> <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>find_element(By<span style=color:#000;font-weight:700>.</span>XPATH, <span style=color:#d14>&#39;//button[@type=&#34;submit&#34;]&#39;</span>)
</span></span><span style=display:flex><span>        elem<span style=color:#000;font-weight:700>.</span>click()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#998;font-style:italic># 等待进入已提交页面</span>
</span></span><span style=display:flex><span>        WebDriverWait(<span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver, <span style=color:#099>10</span>)<span style=color:#000;font-weight:700>.</span>until(EC<span style=color:#000;font-weight:700>.</span>title_is(<span style=color:#d14>&#39;Web form - target page&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#998;font-style:italic># 返回 FormTarget 对象</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>return</span> FormTarget(<span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver)
</span></span></code></pre></div><p><code>FormTarget</code>页面对象代码（<a href=https://github.com/leileiluoluo/python-exercises/blob/main/selenium-best-practices/page-object-model/form_target.py>form_target.py</a>）：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>selenium.webdriver.common.by</span> <span style=color:#000;font-weight:700>import</span> By
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>FormTarget</span>:
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>def</span> __init__(<span style=color:#999>self</span>, driver) <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver <span style=color:#000;font-weight:700>=</span> driver
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>def</span> <span style=color:#900;font-weight:700>get_message_text</span>(<span style=color:#999>self</span>) <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#0086b3>str</span>:
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>return</span> <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>find_element(By<span style=color:#000;font-weight:700>.</span>ID, <span style=color:#d14>&#39;message&#39;</span>)<span style=color:#000;font-weight:700>.</span>text
</span></span></code></pre></div><p>使用如上两个页面对象后的测试代码（<a href=https://github.com/leileiluoluo/python-exercises/blob/main/selenium-best-practices/page-object-model/optimized_form_test.py>optimized_form_test.py</a>）：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>unittest</span> <span style=color:#000;font-weight:700>import</span> TestCase
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>selenium</span> <span style=color:#000;font-weight:700>import</span> webdriver
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>pages.form</span> <span style=color:#000;font-weight:700>import</span> Form
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>TestForm</span>(TestCase):
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>def</span> <span style=color:#900;font-weight:700>setUp</span>(<span style=color:#999>self</span>) <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver <span style=color:#000;font-weight:700>=</span> webdriver<span style=color:#000;font-weight:700>.</span>Chrome()
</span></span><span style=display:flex><span>        <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>addCleanup(<span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver<span style=color:#000;font-weight:700>.</span>quit)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>def</span> <span style=color:#900;font-weight:700>test_web_form</span>(<span style=color:#999>self</span>) <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#998;font-style:italic># 打开表单页面</span>
</span></span><span style=display:flex><span>        form_page <span style=color:#000;font-weight:700>=</span> Form(<span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>driver)
</span></span><span style=display:flex><span>        form_page<span style=color:#000;font-weight:700>.</span>open()
</span></span><span style=display:flex><span>        <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>assertEqual(form_page<span style=color:#000;font-weight:700>.</span>get_title(), <span style=color:#d14>&#39;Web form&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#998;font-style:italic># 输入</span>
</span></span><span style=display:flex><span>        form_target_page <span style=color:#000;font-weight:700>=</span> form_page<span style=color:#000;font-weight:700>.</span>input_text(<span style=color:#d14>&#39;Selenium&#39;</span>) \
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>.</span>input_password(<span style=color:#d14>&#39;Selenium&#39;</span>) \
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>.</span>select_from_dropdown(<span style=color:#d14>&#39;2&#39;</span>) \
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>.</span>input_date(<span style=color:#d14>&#39;05/10/2023&#39;</span>) \
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>.</span>submit()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#998;font-style:italic># 断言</span>
</span></span><span style=display:flex><span>        message <span style=color:#000;font-weight:700>=</span> form_target_page<span style=color:#000;font-weight:700>.</span>get_message_text()
</span></span><span style=display:flex><span>        <span style=color:#999>self</span><span style=color:#000;font-weight:700>.</span>assertEqual(message, <span style=color:#d14>&#39;Received!&#39;</span>)
</span></span></code></pre></div><p>可以看到，经过优化后的代码清晰了许多。</p><p>下面总结一下使用页面对象模型时的几个注意事项：</p><ul><li>断言是测试逻辑的一部分，应放在测试代码中，因此，页面对象中不应有断言或验证相关的代码；</li><li>页面对象只应将页面提供的服务通过公共方法暴露出来，其它内部细节不要暴露出来。</li></ul><p>接下来关注一下实现细节，定位器的使用是编写 Selenium 测试代码时大量涉及的工作。下面看一下定位器使用相关的最佳实践。</p><h2 id=3-如何根据情况使用适当的定位器>3 如何根据情况使用适当的定位器？</h2><p>前文「<a href=https://leileiluoluo.github.io/posts/selenium-webdriver-advanced-features.html#3-%E5%85%83%E7%B4%A0%E5%AE%9A%E4%BD%8D%E4%B8%8E%E6%93%8D%E4%BD%9C>Selenium WebDriver 基础使用</a>」中介绍了 Selenium 有 8 种基本的元素定位方法。而什么时候使用什么样的定位器呢？下面给出其最佳实践。</p><p><code>id 定位器</code>为首选定位方法，准确快速；若元素没有<code>id</code>，则使用<code>css 选择器</code>；此两种不可用，再选择<code>xpath 定位器</code>（相对前两种性能较差）；一般在页面上会有多个相同 tag 的元素，所以<code>tag 定位器</code>一般用于选择一组元素。</p><p>综上，本文介绍了构建一个大型测试项目时分析需求的基本指导思想、编排测试代码的实践策略以及使用定位器的推荐顺序。本文涉及的所有代码均已上传至本人 <a href=https://github.com/leileiluoluo/python-exercises/tree/main/selenium-best-practices/page-object-model>GitHub</a>，欢迎关注。期待阅读完本文，我们对 Selenium 自动化测试从需求分析、编码实现到实现细节上都有了一个可以参考的规范。</p><blockquote><p>参考资料</p><p>[1] <a href=https://www.selenium.dev/documentation/test_practices/>Test Practices | Selenium - www.selenium.dev</a></p></blockquote></div><div class=content-footer><div class=weixinhao><img src=/static/images/self/weixinhao-white.jpg></div><div class=post-tags><a href=/tags/selenium/>#Selenium</a>
<a href=/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/>#自动化测试</a>
<a href=/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/>#架构设计</a>
<a href=/tags/python/>#Python</a></div><div class=license><i class=ti-info-alt></i><div class=info>版权声明：该博客文章由作者通过「<a href=https://creativecommons.org/licenses/by/4.0/deed.zh>知识共享署名 4.0 许可证</a>」进行授权，转载须注明文章原始链接。</div></div></div></div><div class="col-lg-8 mx-auto block shadow"><h3>相关文章</h3><ul><li><a href=/posts/selenium-webdriver-advanced-features.html>Selenium WebDriver 高级特性使用</a></li><li><a href=/posts/selenium-webdriver.html>Selenium WebDriver 基础使用</a></li><li><a href=/posts/selenium-grid.html>Selenium Grid 搭建及使用</a></li><li><a href=/posts/how-to-write-ui-test-cases-using-screenplay-pattern.html>如何使用 Screenplay 模式编写 UI 测试用例？</a></li><li><a href=/posts/how-to-perform-ui-testing-using-serenity-bdd.html>如何使用 Serenity BDD 进行 UI 测试？</a></li></ul></div><div class="col-lg-8 mx-auto block shadow"><div><h3>评论</h3><div id=comment-loading style=text-align:center;font-size:14px><img style=width:52px src=/static/images/site/mona-loading-default.gif>
<span>正在加载评论......</span></div><script>function handleMessage(e){if(e.origin!=="https://giscus.app")return;if(typeof e.data!="object"||!e.data.giscus)return;const t=document.getElementById("comment-loading");t.style.display="none"}window.addEventListener("message",handleMessage)</script><script src=https://giscus.app/client.js data-repo=leileiluoluo/leileiluoluo.github.io data-repo-id=R_kgDOJkLT8w data-category=General data-category-id=DIC_kwDOJkLT884CdtEh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></div></div></section><footer class="py-4 bg-lights border-top"><div class=container><div class="row justify-content-between text-center align-items-center"><div class="col-lg-4 text-center text-lg-left mb-4 mb-lg-0"></div><div class="col-lg-4 text-center mb-4 mb-lg-0"><ul class="list-inline mb-0"><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/sponsor>随喜打赏</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/about>关于本博</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/links>友情链接</a></li></ul></div><div class="col-lg-4 text-lg-right text-center mb-4 mb-lg-0"><ul class="list-inline social-icon mb-0"><li class=list-inline-item><a title=文章归档 href=/archives/><i class=ti-archive></i></a></li><li class=list-inline-item><a title=文章标签 href=/tags/><i class=ti-tag></i></a></li><li class=list-inline-item><a title="我的 GitHub" href=https://github.com/leileiluoluo><i class=ti-github></i></a></li><li class=list-inline-item><a title="网站 RSS" href=/index.xml><i class=ti-rss></i></a></li></ul></div></div><div style=text-align:center;font-size:18px;margin-bottom:22px><a style="-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-image:linear-gradient(to right,#14100f,#d55b5b,#4d14e6)" href=https://www.boyouquan.com/planet-shuttle>「博友圈 · 星球穿梭」</a></div><div class="text-center mt-4"><span>Made with <a href=https://gohugo.io/>Hugo</a> | Theme by <a href=https://github.com/themefisher/northendlab-hugo>NorthendLab</a> | <a href=https://beian.miit.gov.cn>辽ICP备2022012085号-5</a> | Copyright © 2017-2024</span></div></div></footer><script>var indexURL="https://leileiluoluo.github.io/index.json"</script><script src=https://leileiluoluo.github.io/js/jquery.min.js></script><script src=https://leileiluoluo.github.io/js/bootstrap.min.js></script><script src=https://leileiluoluo.github.io/js/fuse.min.js></script><script src=https://leileiluoluo.github.io/js/mark.js></script><script src=https://leileiluoluo.github.io/js/search.js></script><script src=https://leileiluoluo.github.io/js/script.min.js></script></body></html>