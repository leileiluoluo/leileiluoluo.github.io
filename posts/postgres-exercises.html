<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>PostgreSQL 基础知识在线练习 - 磊磊落落</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=keywords content="PostgreSQL,练习"><meta name=description content="PostgreSQL练习 (PostgreSQL Exercises)"><meta name=author content="磊磊落落"><meta name=generator content="Hugo 0.123.7"><link rel=stylesheet href=https://leileiluoluo.github.io/css/bootstrap.min.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/themify-icons.css><link rel=stylesheet href=https://leileiluoluo.github.io/css/larry-custom-v1.6.css><link rel=stylesheet href=https://leileiluoluo.github.io/scss/style.min.css media=screen><link rel="shortcut icon" href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><link rel=icon href=https://leileiluoluo.github.io/images/favicon.png type=image/x-icon><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?526723b767317055572c85bdb445353c",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></head><body><header class="fixed-top navigation"><div class=container><nav class="navbar navbar-expand-lg navbar-light bg-transparent"><a class=navbar-brand href=https://leileiluoluo.github.io/>磊磊落落</a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/></a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/>计算机</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E9%9A%8F%E7%AC%94/>随笔</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%AF%BB%E4%B9%A6/>读书</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E8%A7%82%E5%BD%B1/>观影</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/categories/%E7%BB%83%E5%AD%97/>练字</a></li><li class=nav-item><a class=nav-link href=https://leileiluoluo.github.io/about>关于</a></li></ul><div class=search><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://leileiluoluo.github.io//search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder=键入关键字后回车...></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><div class="py-5 d-none d-lg-block"></div><section class=section><div class=container><div class=row><div class="col-lg-8 mx-auto block shadow mb-5"><h1>PostgreSQL 基础知识在线练习</h1><div class="mb-3 post-meta">2021年07月31日
<a href=/categories/%e8%ae%a1%e7%ae%97%e6%9c%ba>计算机</a></div><div class="content mb-5"><p><a href=https://pgexercises.com/>PGExercises.com</a> 是一个非常不错的 PostgreSQL 在线实践网站。该网站基于一个简单的数据集，设立各类题目，我们可以通过回答这些问题来复习 SQL 知识。</p><p>该站的题目涉及“简单查询及 WHERE 条件”，“连接及 CASE 语句”，“聚集函数，窗口函数及递归查询”等多个门类，是一个不错的测试所学知识的地方。</p><p>下面简单介绍一下该站用到的数据集。</p><p>该数据集针对的是一个刚成立的乡村俱乐部的：有一组会员，一组体育设施，及这些体育设施的预定记录。</p><p>先看一下<code>members</code>表：</p><p>有 ID，基础信息，推荐人 ID，及加入时间等。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TABLE</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>memid<span style=color:#bbb> </span><span style=color:#0086b3>INTEGER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>                     </span><span style=color:#998;font-style:italic>-- 会员ID
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>surname<span style=color:#bbb> </span><span style=color:#0086b3>CHARACTER</span><span style=color:#bbb> </span><span style=color:#0086b3>VARYING</span>(<span style=color:#099>200</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>    </span><span style=color:#998;font-style:italic>-- 姓
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>firstname<span style=color:#bbb> </span><span style=color:#0086b3>CHARACTER</span><span style=color:#bbb> </span><span style=color:#0086b3>VARYING</span>(<span style=color:#099>200</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>  </span><span style=color:#998;font-style:italic>-- 名
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>address<span style=color:#bbb> </span><span style=color:#0086b3>CHARACTER</span><span style=color:#bbb> </span><span style=color:#0086b3>VARYING</span>(<span style=color:#099>300</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>    </span><span style=color:#998;font-style:italic>-- 地址
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>zipcode<span style=color:#bbb> </span><span style=color:#0086b3>INTEGER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>                   </span><span style=color:#998;font-style:italic>-- 邮政编码
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>telephone<span style=color:#bbb> </span><span style=color:#0086b3>CHARACTER</span><span style=color:#bbb> </span><span style=color:#0086b3>VARYING</span>(<span style=color:#099>20</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>   </span><span style=color:#998;font-style:italic>-- 电话
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>recommendedby<span style=color:#bbb> </span><span style=color:#0086b3>INTEGER</span>,<span style=color:#bbb>                      </span><span style=color:#998;font-style:italic>-- 推荐人
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>joindate<span style=color:#bbb> </span><span style=color:#000;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>                </span><span style=color:#998;font-style:italic>-- 加入时间
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>CONSTRAINT</span><span style=color:#bbb> </span>members_pk<span style=color:#bbb> </span><span style=color:#000;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>KEY</span><span style=color:#bbb> </span>(memid),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>CONSTRAINT</span><span style=color:#bbb> </span>fk_members_recommendedby<span style=color:#bbb> </span><span style=color:#000;font-weight:700>FOREIGN</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>KEY</span><span style=color:#bbb> </span>(recommendedby)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>REFERENCES</span><span style=color:#bbb> </span>cd.members(memid)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>ON</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>DELETE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p>接下来，看一下<code>facilities</code>表：</p><p>该表列出可供预定的设施，包含设施 ID，设施名称，会员预定花销，游客预定花销等。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TABLE</span><span style=color:#bbb> </span>cd.facilities<span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>facid<span style=color:#bbb> </span><span style=color:#0086b3>integer</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>                 </span><span style=color:#998;font-style:italic>-- 设施ID
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>name<span style=color:#bbb> </span><span style=color:#0086b3>character</span><span style=color:#bbb> </span><span style=color:#0086b3>varying</span>(<span style=color:#099>100</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>   </span><span style=color:#998;font-style:italic>-- 设施名称
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>membercost<span style=color:#bbb> </span><span style=color:#0086b3>numeric</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>            </span><span style=color:#998;font-style:italic>-- 会员预定花销
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>guestcost<span style=color:#bbb> </span><span style=color:#0086b3>numeric</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>             </span><span style=color:#998;font-style:italic>-- 游客预定花销
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>initialoutlay<span style=color:#bbb> </span><span style=color:#0086b3>numeric</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>monthlymaintenance<span style=color:#bbb> </span><span style=color:#0086b3>numeric</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>CONSTRAINT</span><span style=color:#bbb> </span>facilities_pk<span style=color:#bbb> </span><span style=color:#000;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>KEY</span><span style=color:#bbb> </span>(facid)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p>最后，看一下<code>bookings</code>表：</p><p>该表用于追踪各设施的预定情况，包含设施 ID，预定会员 ID，开始预定时间，及预定了多少个半小时的 slots 等。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TABLE</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>bookid<span style=color:#bbb> </span><span style=color:#0086b3>integer</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>facid<span style=color:#bbb> </span><span style=color:#0086b3>integer</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>        </span><span style=color:#998;font-style:italic>-- 设施ID
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>memid<span style=color:#bbb> </span><span style=color:#0086b3>integer</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>        </span><span style=color:#998;font-style:italic>-- 会员ID
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>starttime<span style=color:#bbb> </span><span style=color:#000;font-weight:700>timestamp</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>  </span><span style=color:#998;font-style:italic>-- 开始预定时间
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>slots<span style=color:#bbb> </span><span style=color:#0086b3>integer</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span>,<span style=color:#bbb>        </span><span style=color:#998;font-style:italic>-- 预定了多少个半小时
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>CONSTRAINT</span><span style=color:#bbb> </span>bookings_pk<span style=color:#bbb> </span><span style=color:#000;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>KEY</span><span style=color:#bbb> </span>(bookid),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>CONSTRAINT</span><span style=color:#bbb> </span>fk_bookings_facid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>FOREIGN</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>KEY</span><span style=color:#bbb> </span>(facid)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>REFERENCES</span><span style=color:#bbb> </span>cd.facilities(facid),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>CONSTRAINT</span><span style=color:#bbb> </span>fk_bookings_memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>FOREIGN</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>KEY</span><span style=color:#bbb> </span>(memid)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>REFERENCES</span><span style=color:#bbb> </span>cd.members(memid)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p>这三张表的关系如下图所示。</p><p><img loading=lazy src=https://leileiluoluo.github.io/static/images/uploads/2021/07/schema-horizontal.svg#center alt></p><p>介绍完数据集，下面就开始我们的练习吧。</p><h3 id=1-简单-sql-查询>1 简单 SQL 查询</h3><p>该栏目考察 SQL 基础，题目涵盖 SELECT, WHERE, CASE, UNION 等。</p><p><strong>1 控制取哪些行</strong></p><p>问题描述：</p><p>生成一个设备列表，这些设备对会员收费，且所收的费用不足月度维护费用的 50 分之一。该列表返回设备的 ID，名称，会员费，月度维护费用。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>facid,<span style=color:#bbb> </span>name,<span style=color:#bbb> </span>membercost,<span style=color:#bbb> </span>monthlymaintenance<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.facilities<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>membercost<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span><span style=color:#099>0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>membercost<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#bbb> </span>monthlymaintenance<span style=color:#000;font-weight:700>/</span><span style=color:#099>50</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>2 将结果分类</strong></p><p>问题描述：</p><p>生成一个设备列表，若月度维护费用大于 100 就标记为<code>expensive</code>，否则标记为<code>cheap</code>。返回相关设施的名称和月度维护情况。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>name,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>CASE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>WHEN</span><span style=color:#bbb> </span>monthlymaintenance<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span><span style=color:#099>100</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#d14>&#39;expensive&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>ELSE</span><span style=color:#bbb> </span><span style=color:#d14>&#39;cheap&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>END</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>cost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.facilities;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>3 日期处理</strong></p><p>问题描述：</p><p>生成一个会员列表，返回 2012 年 9 月及之后加入的会员。返回会员的 memid，surname，firstname 及 joindate。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>memid,<span style=color:#bbb> </span>surname,<span style=color:#bbb> </span>firstname,<span style=color:#bbb> </span>joindate<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>joindate<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&gt;=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-09-01&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>4 重复项移除及结果排序</strong></p><p>问题描述：</p><p>生成一个排序后的前 10 位会员的姓氏列表，且不要有重复。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>DISTINCT</span><span style=color:#bbb> </span>surname<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>surname<span style=color:#bbb> </span><span style=color:#000;font-weight:700>LIMIT</span><span style=color:#bbb> </span><span style=color:#099>10</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>5 组合多个查询的结果</strong></p><p>问题描述：</p><p>出于某种原因，您需要一个包含所有姓氏和所有设施名称的组合列表。请生成这个列表。</p><p>问题答案：</p><p>注意使用<code>UNION</code>会移除重复项，而<code>UNION ALL</code>并不会。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>surname<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>UNION</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>name<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.facilities;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>6 聚集函数使用</strong></p><p>问题描述：</p><p>您想获取最后一个加入的会员的名字，姓氏，加入时间。该如何做？</p><p>问题答案：</p><p>使用子查询实现。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>firstname,<span style=color:#bbb> </span>surname,<span style=color:#bbb> </span>joindate<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>joindate<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>max</span>(joindate)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members);<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=2-连接及子查询>2 连接及子查询</h3><p>该栏目主要考察关系型数据库的基础——连接。题目涵盖内连接，外连接，自连接，子查询。</p><p><strong>1 获取会员的预定开始时间</strong></p><p>问题描述：</p><p>获取会员名字为“David Farrell”的预定开始时间。</p><p>问题答案：</p><p>有两种实现方式，一种采用内连接，一种采用子查询。内连接又有两种写法。</p><p>a）内连接实现</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>b.starttime<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>b,<span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span>m<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>m.memid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>firstname<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;David&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>surname<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;Farrell&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- 另一种写法
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>b.starttime<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>b<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>INNER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>JOIN</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span>m<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>ON</span><span style=color:#bbb> </span>b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>m.memid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>firstname<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;David&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>surname<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;Farrell&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>b）子查询实现</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>starttime<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>IN</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>memid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>firstname<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;David&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>surname<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;Farrell&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>2 获取网球场的预定开始时间</strong></p><p>问题描述：</p><p>获取<code>2012-09-21</code>这一天预定“Tennis Court”的开始时间列表。返回开始时间及设备名称，按开始时间排序。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>b.starttime,<span style=color:#bbb> </span>f.name<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>b,<span style=color:#bbb> </span>cd.facilities<span style=color:#bbb> </span>f<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>b.facid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>f.facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>f.name<span style=color:#bbb> </span><span style=color:#000;font-weight:700>LIKE</span><span style=color:#bbb> </span><span style=color:#d14>&#39;Tennis Court%&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span><span style=color:#0086b3>date</span>(b.starttime)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-09-21&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>b.starttime;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>3 获取推荐过其他会员的所有会员列表</strong></p><p>问题描述：</p><p>获取推荐过其他会员的所有会员列表，确保结果不含重复项，且结果以姓和名排序。</p><p>问题答案：</p><p>采用自连接实现，采用 DISTINCT 去重。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>DISTINCT</span><span style=color:#bbb> </span>m2.firstname,<span style=color:#bbb> </span>m2.surname<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span>m1,<span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span>m2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>m1.recommendedby<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>m2.memid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>m2.surname,<span style=color:#bbb> </span>m2.firstname;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>4 获取所有会员及其推荐人</strong></p><p>问题描述：</p><p>获取所有会员及其推荐人（如果有的话），确保结果以姓和名排序。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>m1.firstname,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>	</span>m1.surname,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>	</span>m2.firstname,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>	</span>m2.surname<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span>m1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>LEFT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>OUTER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>JOIN</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span>m2<span style=color:#bbb> </span><span style=color:#000;font-weight:700>ON</span><span style=color:#bbb> </span>m1.recommendedby<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>m2.memid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>m1.surname,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>	</span>m1.firstname;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>5 列出所有使用过网球场的会员</strong></p><p>问题描述：</p><p>找出使用过网球场的所有会员的列表。输出包含网球场名，合为一列的会员姓名。确保没有重复数据，并按会员姓名后跟设施名称排序。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>DISTINCT</span><span style=color:#bbb> </span>(m.firstname<span style=color:#bbb> </span><span style=color:#000;font-weight:700>||</span><span style=color:#bbb> </span><span style=color:#d14>&#39; &#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>||</span><span style=color:#bbb> </span>m.surname)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>member,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>f.name<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>facility<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>b,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>cd.members<span style=color:#bbb> </span>m,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>cd.facilities<span style=color:#bbb> </span>f<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>b.facid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>f.facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>m.memid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>f.name<span style=color:#bbb> </span><span style=color:#000;font-weight:700>LIKE</span><span style=color:#bbb> </span><span style=color:#d14>&#39;Tennis Court%&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>member,<span style=color:#bbb> </span>facility;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>6 生成一份昂贵的预订清单</strong></p><p>问题描述：</p><p>生成<code>2012-09-14</code>这一天会员或游客花费超过 30 元的预订清单。</p><p>注意：游客和会员的预定费用不同，且游客的 ID 始终为 0。输出中包括设施名称，会员姓名及预定费用。结果按费用降序排序，且不使用任何子查询。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>(m.firstname<span style=color:#bbb> </span><span style=color:#000;font-weight:700>||</span><span style=color:#bbb> </span><span style=color:#d14>&#39; &#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>||</span><span style=color:#bbb> </span>m.surname)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>member,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>f.name<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>facility,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>(<span style=color:#000;font-weight:700>CASE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>WHEN</span><span style=color:#bbb> </span>b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>THEN</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.guestcost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>ELSE</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.membercost<span style=color:#bbb> </span><span style=color:#000;font-weight:700>END</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>cost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>b,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>cd.members<span style=color:#bbb> </span>m,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>cd.facilities<span style=color:#bbb> </span>f<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>m.memid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>b.facid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>f.facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span><span style=color:#0086b3>date</span>(b.starttime)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-09-14&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>((b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>0</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.guestcost<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span><span style=color:#099>30</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>OR</span><span style=color:#bbb> </span>(b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>!=</span><span style=color:#bbb> </span><span style=color:#099>0</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.membercost<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span><span style=color:#099>30</span>))<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>cost<span style=color:#bbb> </span><span style=color:#000;font-weight:700>DESC</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>7 使用子查询生成一份昂贵的预订清单</strong></p><p>问题描述：</p><p>对于上一个问题，实现的有点啰嗦：我们必须在 WHERE 子句和 CASE 语句中两次计算预订成本。尝试使用子查询简化此计算。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>(m.firstname<span style=color:#bbb> </span><span style=color:#000;font-weight:700>||</span><span style=color:#bbb> </span><span style=color:#d14>&#39; &#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>||</span><span style=color:#bbb> </span>surname)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>member,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span>f.name<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>facility,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span>(<span style=color:#000;font-weight:700>CASE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#000;font-weight:700>WHEN</span><span style=color:#bbb> </span>b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#000;font-weight:700>THEN</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.guestcost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#000;font-weight:700>ELSE</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.membercost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#000;font-weight:700>END</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>cost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>b,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>cd.members<span style=color:#bbb> </span>m,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>cd.facilities<span style=color:#bbb> </span>f<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>m.memid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>b.facid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>f.facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span><span style=color:#0086b3>date</span>(b.starttime)<span style=color:#bbb> </span>s<span style=color:#bbb> </span><span style=color:#d14>&#39;2012-09-14&#39;</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>t<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>t.cost<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span><span style=color:#099>30</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>t.cost<span style=color:#bbb> </span><span style=color:#000;font-weight:700>DESC</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>8 不使用连接生成所有成员及其推荐人列表</strong></p><p>问题描述：</p><p>不使用任何连接的情况下输出所有成员的列表，包括其推荐人（如果有的话）。确保列表中没有重复项，且名字姓氏对被格式化为一列并有序。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>DISTINCT</span><span style=color:#bbb> </span>(m.firstname<span style=color:#bbb> </span><span style=color:#000;font-weight:700>||</span><span style=color:#bbb> </span><span style=color:#d14>&#39; &#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>||</span><span style=color:#bbb> </span>m.surname)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>member,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>(<span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>(firstname<span style=color:#bbb> </span><span style=color:#000;font-weight:700>||</span><span style=color:#bbb> </span><span style=color:#d14>&#39; &#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>||</span><span style=color:#bbb> </span>surname)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>recommender<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>m.recommendedby)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span>m<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>member;<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=3-数据修改>3 数据修改</h3><p>本栏目涉及插入、更新和删除。像这样更改数据的操作统称为 DML（数据操作语言）。</p><p><strong>1 单行插入</strong></p><p>问题描述：</p><p>俱乐部正在增加一个新设施——SPA。我们需要将它添加到设施表中。值如下。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>facid: 9, name: &#39;Spa&#39;, membercost: 20, guestcost: 30, initialoutlay: 100000, monthlymaintenance: 800
</span></span></code></pre></div><p>问题答案：</p><p>可以显示指定列名，也可以省略列名  按建表字段顺序插入。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>INSERT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>INTO</span><span style=color:#bbb> </span>cd.facilities<span style=color:#bbb> </span>(facid,<span style=color:#bbb> </span>name,<span style=color:#bbb> </span>membercost,<span style=color:#bbb> </span>guestcost,<span style=color:#bbb> </span>initialoutlay,<span style=color:#bbb> </span>monthlymaintenance)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>VALUES</span><span style=color:#bbb> </span>(<span style=color:#099>9</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;Spa&#39;</span>,<span style=color:#bbb> </span><span style=color:#099>20</span>,<span style=color:#bbb> </span><span style=color:#099>30</span>,<span style=color:#bbb> </span><span style=color:#099>100000</span>,<span style=color:#bbb> </span><span style=color:#099>800</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- 按照建表字段顺序插入
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>INSERT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>INTO</span><span style=color:#bbb> </span>cd.facilities<span style=color:#bbb> </span><span style=color:#000;font-weight:700>VALUES</span><span style=color:#bbb> </span>(<span style=color:#099>9</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;Spa&#39;</span>,<span style=color:#bbb> </span><span style=color:#099>20</span>,<span style=color:#bbb> </span><span style=color:#099>30</span>,<span style=color:#bbb> </span><span style=color:#099>100000</span>,<span style=color:#bbb> </span><span style=color:#099>800</span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>2 多行插入</strong></p><p>问题描述：</p><p>使用一行命令一次加入多个设备。值如下。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>facid: 9, name: &#39;Spa&#39;, membercost: 20, guestcost: 30, initialoutlay: 100000, monthlymaintenance: 800
</span></span><span style=display:flex><span>facid: 10, name: &#39;Squash Court 2&#39;, membercost: 3.5, guestcost: 17.5, initialoutlay: 5000, monthlymaintenance: 80
</span></span></code></pre></div><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>INSERT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>INTO</span><span style=color:#bbb> </span>cd.facilities<span style=color:#bbb> </span>(facid,<span style=color:#bbb> </span>name,<span style=color:#bbb> </span>membercost,<span style=color:#bbb> </span>guestcost,<span style=color:#bbb> </span>initialoutlay,<span style=color:#bbb> </span>monthlymaintenance)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>VALUES</span><span style=color:#bbb> </span>(<span style=color:#099>9</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;Spa&#39;</span>,<span style=color:#bbb> </span><span style=color:#099>20</span>,<span style=color:#bbb> </span><span style=color:#099>30</span>,<span style=color:#bbb> </span><span style=color:#099>100000</span>,<span style=color:#bbb> </span><span style=color:#099>800</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>           </span>(<span style=color:#099>10</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;Squash Court 2&#39;</span>,<span style=color:#bbb> </span><span style=color:#099>3</span>.<span style=color:#099>5</span>,<span style=color:#bbb> </span><span style=color:#099>17</span>.<span style=color:#099>5</span>,<span style=color:#bbb> </span><span style=color:#099>5000</span>,<span style=color:#bbb> </span><span style=color:#099>80</span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>3 计算后的数据插入</strong></p><p>问题描述：</p><p>这一次不再指定设备 ID，而是自动计算下一个 facid 值。其它字段值如下。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>name: &#39;Spa&#39;, membercost: 20, guestcost: 30, initialoutlay: 100000, monthlymaintenance: 800.
</span></span></code></pre></div><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>INSERT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>INTO</span><span style=color:#bbb> </span>cd.facilities<span style=color:#bbb> </span>(facid,<span style=color:#bbb> </span>name,<span style=color:#bbb> </span>membercost,<span style=color:#bbb> </span>guestcost,<span style=color:#bbb> </span>initialoutlay,<span style=color:#bbb> </span>monthlymaintenance)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>max</span>(facid)<span style=color:#000;font-weight:700>+</span><span style=color:#099>1</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.facilities),<span style=color:#bbb> </span><span style=color:#d14>&#39;Spa&#39;</span>,<span style=color:#bbb> </span><span style=color:#099>20</span>,<span style=color:#bbb> </span><span style=color:#099>30</span>,<span style=color:#bbb> </span><span style=color:#099>100000</span>,<span style=color:#bbb> </span><span style=color:#099>800</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>4 根据现有内容作更新</strong></p><p>问题描述：</p><p>我们想改变第二个网球场的价格，使其比第一个网球场贵 10%。尝试在不指定常量值的情况下执行此操作，以便我们可以根据需要重用该语句。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>UPDATE</span><span style=color:#bbb> </span>cd.facilities<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>SET</span><span style=color:#bbb> </span>membercost<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>1</span>.<span style=color:#099>1</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>membercost,<span style=color:#bbb> </span>guestcost<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>1</span>.<span style=color:#099>1</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>guestcost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>name<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;Tennis Court 2&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>5 根据子查询作删除</strong></p><p>问题描述：</p><p>删除所有从未预定过设施的成员。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>DELETE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>memid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>IN</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>DISTINCT</span><span style=color:#bbb> </span>memid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- 另一种实现是使用相关子查询
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>DELETE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span>m<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>EXISTS</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#099>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>m.memid);<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=4-聚合>4 聚合</h3><p>聚合是一个让人能真正体会到关系型数据库强大能力的功能。该栏目深度覆盖聚合，使用标准分组以及最新的窗口函数来测试我们的掌握情况。</p><p><strong>1 计算各成员的推荐数</strong></p><p>问题描述：</p><p>生成各成员的推荐数列表，以成员 ID 排序。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>recommendedby,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>count</span>(<span style=color:#000;font-weight:700>*</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>recommendedby<span style=color:#bbb> </span><span style=color:#000;font-weight:700>IS</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>NULL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>ecommendedby<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>recommendedby;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>2 列出每个设施的预订总段数</strong></p><p>问题描述：</p><p>生成每个设施的预订总段数。输出设施 ID 和预定总段数，按设施 ID 排序。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>facid,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>sum</span>(slots)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>facid;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>3 列出给定月份每个设施的预订总段数</strong></p><p>问题描述：</p><p>生成 2012 年 9 月每个设施的预订总段数。输出设施 ID 和预定总段数，按总段数排序。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>facid,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>sum</span>(slots)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>totalslots<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>starttime<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&gt;=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-09-01&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>starttime<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-10-01&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>totalslots;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>4 列出每个设施每月的预订总段数</strong></p><p>问题描述：</p><p>生成 2012 年每个设施每月的预订总段数。输出设施 ID 和预定总段数，按设施 ID 和月份排序。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>facid,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>extract</span>(<span style=color:#000;font-weight:700>month</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>from</span><span style=color:#bbb> </span>starttime)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>month</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>sum</span>(slots)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>starttime<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&gt;=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-01-01&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>starttime<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2013-01-01&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>facid,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>month</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>facid,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>month</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>5 列出预订已超过 1000 个段的设施</strong></p><p>问题描述：</p><p>生成预订已超过 1000 个段的设施列表。输出设施 ID 和预定总段数，按设施 ID 排序。</p><p>问题答案：</p><p>使用<code>HAVING</code>来过滤聚合后的结果。<code>WHERE</code>用于聚合前的数据筛选，而<code>HAVING</code>用于聚合后的数据筛选，这即是两者的区别。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>facid,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>sum</span>(slots)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>HAVING</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>sum</span>(slots)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span><span style=color:#099>1000</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>facid;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>6 列出每个设施的总收入</strong></p><p>问题描述：</p><p>列出每个设施的总收入。输出应包括设施名和总收入，按总收入排序。记住，游客和会员的计费是不同的。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>f.name,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>sum</span>(<span style=color:#000;font-weight:700>CASE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#000;font-weight:700>WHEN</span><span style=color:#bbb> </span>b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#000;font-weight:700>THEN</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.guestcost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#000;font-weight:700>ELSE</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.membercost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>END</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>revenue<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>b,<span style=color:#bbb> </span>cd.facilities<span style=color:#bbb> </span>f<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>b.facid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>f.facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>f.name<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>revenue;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>7 列出总收入低于 1000 的设施</strong></p><p>问题描述：</p><p>列出总收入小于 1000 的设施列表。输出包括设施名称和总收入，按收入排序。记住，游客和会员的计费是不同的。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>f.name,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>sum</span>(<span style=color:#000;font-weight:700>CASE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:#000;font-weight:700>WHEN</span><span style=color:#bbb> </span>b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:#000;font-weight:700>THEN</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.guestcost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:#000;font-weight:700>ELSE</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.membercost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#000;font-weight:700>END</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>revenue<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>b,<span style=color:#bbb> </span>cd.facilities<span style=color:#bbb> </span>f<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>b.facid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>f.facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>f.name)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>t<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>t.revenue<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#bbb> </span><span style=color:#099>1000</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>revenue;<span style=color:#bbb>
</span></span></span></code></pre></div><p>注意如下写法是错误的：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>f.name,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>sum</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>CASE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>WHEN</span><span style=color:#bbb> </span>b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>THEN</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.guestcost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>ELSE</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.membercost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>END</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>revenue<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>b,<span style=color:#bbb> </span>cd.facilities<span style=color:#bbb> </span>f<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>b.facid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>f.facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>f.name<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>HAVING</span><span style=color:#bbb> </span>revenue<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#bbb> </span><span style=color:#099>1000</span><span style=color:#bbb> </span><span style=color:#998;font-style:italic>-- PostgreSQL不允许在HAVING中直接使用列名
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>revenue;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>8 输出预订段数最多的设施 ID</strong></p><p>问题描述：</p><p>输出预订段数最多的设施 ID。尝试不使用<code>LIMIT</code>来实现（看起来可能会乱一点）。</p><p>问题答案：</p><p>第一种写法，看起来笨一些。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>facid,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>sum</span>(slots)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>HAVING</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>sum</span>(slots)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>max</span>(totalslots)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>facid,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>sum</span>(slots)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>totalslots<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>facid)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>t);<span style=color:#bbb>
</span></span></span></code></pre></div><p>第二种写法，使用<code>WITH</code>表达式提取出公用部分，更紧凑。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>WITH</span><span style=color:#bbb> </span>t<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>facid,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>sum</span>(slots)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>totalslots<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>facid)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>t<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>totalslots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>max</span>(totalslots)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>t);<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>9 输出每个设施的预订总小时数</strong></p><p>问题描述：</p><p>输出每个设施的预订总小时数，注意一个时段为半小时。输出应包含设施 ID、设施名称和预订小时数，按设施 ID 排序。尝试将小时数格式化为两位小数。</p><p>问题答案：</p><p>PostgreSQL 默认是整除的，若需采用浮点除法，需要显式指定一下。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>b.facid,<span style=color:#bbb> </span>f.name,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>round(<span style=color:#000;font-weight:700>sum</span>(b.slots)::<span style=color:#0086b3>numeric</span><span style=color:#000;font-weight:700>/</span><span style=color:#099>2</span>::<span style=color:#0086b3>numeric</span>,<span style=color:#bbb> </span><span style=color:#099>2</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>b,<span style=color:#bbb> </span>cd.facilities<span style=color:#bbb> </span>f<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>b.facid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>f.facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>b.facid,<span style=color:#bbb> </span>f.name<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>b.facid;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>10 列出每位会员在 2012 年 9 月 1 日之后的首次预订</strong></p><p>问题描述：</p><p>列出每位会员的姓名、ID 和他们在 2012 年 9 月 1 日之后的第一次设施预订时间。按会员 ID 排序。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>m.surname,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>m.firstname,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>b.memid,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>min</span>(b.starttime)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>b,<span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span>m<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>m.memid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>AND</span><span style=color:#bbb> </span>b.starttime<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&gt;=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-09-01&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>m.surname,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>m.firstname,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>b.memid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>b.memid;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>11 生成会员名称列表，每行包含会员总数</strong></p><p>问题描述：</p><p>生成会员（包括游客）名称列表，每行包含会员总数。按加入日期排序。</p><p>问题答案：</p><p>使用窗口函数实现。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>count</span>(<span style=color:#000;font-weight:700>*</span>)<span style=color:#bbb> </span>over<span style=color:#bbb> </span>(),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>firstname,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>surname<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>joindate;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>12 生成一份带编号的会员名单</strong></p><p>问题描述：</p><p>生成一份会员（包括游客）的单调递增编号列表，按加入日期排序。注意，不保证会员 ID 是连续的。</p><p>问题答案：</p><p>使用窗口函数实现。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>row_number()<span style=color:#bbb> </span>OVER<span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>joindate),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>firstname,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>surname<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>joindate;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>13 查找前三大创收设施</strong></p><p>问题描述：</p><p>列出前三个创收设施（包含排名相同的）。输出设施名称和排名，按排名和设施名称排序。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>f.name,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>rank()<span style=color:#bbb> </span>OVER<span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>sum</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#000;font-weight:700>CASE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span><span style=color:#000;font-weight:700>WHEN</span><span style=color:#bbb> </span>b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span><span style=color:#000;font-weight:700>THEN</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.guestcost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span><span style=color:#000;font-weight:700>ELSE</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.membercost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#000;font-weight:700>END</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>DESC</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>rank<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>b,<span style=color:#bbb> </span>cd.facilities<span style=color:#bbb> </span>f<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>b.facid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>f.facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>f.name)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>t<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>t.rank<span style=color:#bbb> </span><span style=color:#000;font-weight:700>&lt;=</span><span style=color:#bbb> </span><span style=color:#099>3</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>14 按营收额对设施进行分类</strong></p><p>问题描述：</p><p>根据营收额将设施等分为高、中和低三类。按分类和设施名称排序。</p><p>问题答案：</p><p>主要考察<code>ntile</code>窗口函数的使用，其会将值尽可能的等分为指定的分组数。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>name,<span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>CASE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>WHEN</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>class</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#d14>&#39;high&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>WHEN</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>class</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#d14>&#39;average&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>ELSE</span><span style=color:#bbb> </span><span style=color:#d14>&#39;low&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>END</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>revenue<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>f.name,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>ntile(<span style=color:#099>3</span>)<span style=color:#bbb> </span>over(<span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>sum</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#000;font-weight:700>CASE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#000;font-weight:700>WHEN</span><span style=color:#bbb> </span>b.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>0</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#000;font-weight:700>THEN</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.guestcost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#000;font-weight:700>ELSE</span><span style=color:#bbb> </span>b.slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>f.membercost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#000;font-weight:700>END</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>DESC</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>class</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>b,<span style=color:#bbb> </span>cd.facilities<span style=color:#bbb> </span>f<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>b.facid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>f.facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>f.name)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>t<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>class</span>,<span style=color:#bbb> </span>name;<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=5-日期处理>5 日期处理</h3><p>本栏目涉及日期处理，详情请参阅<a href=https://www.postgresql.org/docs/current/functions-datetime.html>PostgreSQL 日期时间函数文档</a>。</p><p><strong>1 生成 2012 年 8 月 31 日凌晨 1 点的时间戳</strong></p><p>问题描述：</p><p>生成 2012 年 8 月 31 日凌晨 1 点这个时间的时间戳。</p><p>问题答案：</p><p>有三种写法，前两种是 PostgreSQL 的语法，最后一种是 SQL 标准语法。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#998;font-style:italic>-- 第一种写法
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-08-31 01:00:00&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- 第二种写法
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-08-31 01:00:00&#39;</span>::<span style=color:#000;font-weight:700>TIMESTAMP</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- 第三种写法
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>CAST</span>(<span style=color:#d14>&#39;2012-08-31 01:00:00&#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TIMESTAMP</span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>2 时间戳相减</strong></p><p>问题描述：</p><p>计算时间戳<code>2012-08-31 01:00:00</code>减去时间戳<code>2012-07-30 01:00:00</code>的结果。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-08-31 01:00:00&#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>-</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-07-30 01:00:00&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>3 生成 2012 年 10 月的所有日期</strong></p><p>问题描述：</p><p>生成 2012 年 10 月的所有日期。可以输出为时间戳（时间部分为<code>00:00:00</code>）或日期。</p><p>问题答案：</p><p>使用 PostgreSQL 的<code>generate_series</code>函数来生成时间序列。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>generate_series(<span style=color:#000;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-10-01&#39;</span>,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-10-31&#39;</span>,<span style=color:#bbb> </span><span style=color:#0086b3>INTERVAL</span><span style=color:#bbb> </span><span style=color:#d14>&#39;1 day&#39;</span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>4 从时间戳获取其属于月份中的哪一天</strong></p><p>问题描述：</p><p>从时间戳<code>2012-08-31</code>中获取其属于月份中的第几天。</p><p>问题答案：</p><p>使用<code>date_part</code>或<code>extract</code>函数实现。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#998;font-style:italic>-- 写法一
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>date_part(<span style=color:#d14>&#39;day&#39;</span>,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-08-31&#39;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- 写法二
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>extract</span>(<span style=color:#000;font-weight:700>day</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-08-31&#39;</span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>5 计算时间戳之间的秒数</strong></p><p>问题描述：</p><p>计算时间戳<code>2012-08-31 01:00:00</code>和<code>2012-09-02 00:00:00</code>之间的秒数。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#998;font-style:italic>-- 手动实现方式
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>extract</span>(<span style=color:#000;font-weight:700>day</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>t.<span style=color:#0086b3>int</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span><span style=color:#099>24</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span><span style=color:#099>60</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span><span style=color:#099>60</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>+</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>extract</span>(hour<span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>t.<span style=color:#0086b3>int</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span><span style=color:#099>60</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span><span style=color:#099>60</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>+</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>extract</span>(<span style=color:#000;font-weight:700>minute</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>t.<span style=color:#0086b3>int</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span><span style=color:#099>60</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>+</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>extract</span>(<span style=color:#000;font-weight:700>second</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>t.<span style=color:#0086b3>int</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>age(<span style=color:#000;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-09-02 00:00:00&#39;</span>,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-08-31 01:00:00&#39;</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span><span style=color:#0086b3>int</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>t;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- 使用PostgreSQL函数
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>extract</span>(epoch<span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>age(<span style=color:#000;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-09-02 00:00:00&#39;</span>,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-08-31 01:00:00&#39;</span>));<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>6 输出 2012 年每个月的天数</strong></p><p>问题描述：</p><p>输出 2012 年的每个月及该月的天数。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>extract</span>(<span style=color:#000;font-weight:700>month</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>t.<span style=color:#000;font-weight:700>month</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>month</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>(t.<span style=color:#000;font-weight:700>month</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>+</span><span style=color:#bbb> </span><span style=color:#0086b3>INTERVAL</span><span style=color:#bbb> </span><span style=color:#d14>&#39;1 month&#39;</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>-</span><span style=color:#bbb> </span>t.<span style=color:#000;font-weight:700>month</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>length</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>generate_series(<span style=color:#0086b3>DATE</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-01-01&#39;</span>,<span style=color:#bbb> </span><span style=color:#0086b3>DATE</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-12-31&#39;</span>,<span style=color:#bbb> </span><span style=color:#0086b3>interval</span><span style=color:#bbb> </span><span style=color:#d14>&#39;1 month&#39;</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>month</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>t;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>7 计算给定月的剩余天数</strong></p><p>问题描述：</p><p>给定时间戳<code>2012-02-11 01:00:00</code>，计算其对应月的剩余天数（不论给定的时间戳是几点，都应算作剩余的一整天）。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>date_trunc(<span style=color:#d14>&#39;month&#39;</span>,<span style=color:#bbb> </span>t.ts)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>+</span><span style=color:#bbb> </span><span style=color:#0086b3>INTERVAL</span><span style=color:#bbb> </span><span style=color:#d14>&#39;1 month&#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>-</span><span style=color:#bbb> </span>date_trunc(<span style=color:#d14>&#39;day&#39;</span>,<span style=color:#bbb> </span>t.ts)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:#d14>&#39;2012-02-11 01:00:00&#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>ts)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>t;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>8 计算预订的结束时间</strong></p><p>问题描述：</p><p>在系统中返回最近 10 个预订的开始和结束时间，先按结束时间排序，然后按开始时间排序。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>starttime,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>starttime<span style=color:#bbb> </span><span style=color:#000;font-weight:700>+</span><span style=color:#bbb> </span>slots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>(<span style=color:#0086b3>interval</span><span style=color:#bbb> </span><span style=color:#d14>&#39;0.5 hour&#39;</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>endtime<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>endtime<span style=color:#bbb> </span><span style=color:#000;font-weight:700>DESC</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>starttime<span style=color:#bbb> </span><span style=color:#000;font-weight:700>DESC</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>LIMIT</span><span style=color:#bbb> </span><span style=color:#099>10</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>9 返回每个月的预订数</strong></p><p>问题描述：</p><p>返回每个月的预订数，结果按月排序。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>date_trunc(<span style=color:#d14>&#39;month&#39;</span>,<span style=color:#bbb> </span>starttime)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>month</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>count</span>(<span style=color:#000;font-weight:700>*</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>month</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>month</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>10 按月计算每个设施的利用率</strong></p><p>问题描述：</p><p>按月计算每个设施的利用率，按名称和月份排序，四舍五入到小数点后一位。开门时间是早上 8 点，关门时间是晚上 8:30。您可以将每个月视为整月，无论俱乐部是否有某些日期未开放。</p><p>问题答案：</p><p>每天开门的时间是<code>12.5 * 2</code>个半小时，所以每个设备当月的预定总段数除以这个数就是当月的利用率。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>name,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>month</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>round((totalslots<span style=color:#bbb> </span><span style=color:#000;font-weight:700>/</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>extract</span>(<span style=color:#000;font-weight:700>day</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>month</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>+</span><span style=color:#bbb> </span><span style=color:#0086b3>interval</span><span style=color:#bbb> </span><span style=color:#d14>&#39;1 month&#39;</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>-</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>month</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span><span style=color:#099>12</span>.<span style=color:#099>5</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span><span style=color:#099>2</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span><span style=color:#099>100</span>)::<span style=color:#0086b3>NUMERIC</span>,<span style=color:#bbb> </span><span style=color:#099>1</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>utilization<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>(<span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>f.name,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>date_trunc(<span style=color:#d14>&#39;month&#39;</span>,<span style=color:#bbb> </span>b.starttime)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>month</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#000;font-weight:700>sum</span>(b.slots)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>totalslots<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.bookings<span style=color:#bbb> </span>b,<span style=color:#bbb> </span>cd.facilities<span style=color:#bbb> </span>f<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>b.facid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>f.facid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>f.name,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>MONTH</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>t<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>name,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>month</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=6-字符串操作>6 字符串操作</h3><p>本栏目涉及基础字符串操作，<code>LIKE</code>使用，正则表达式使用。详情请参阅<a href=https://www.postgresql.org/docs/current/functions-matching.html>PostgreSQL 正则匹配文档</a>。</p><p><strong>1 格式化会员名称</strong></p><p>问题描述：</p><p>输出所有会员的名字，格式为<code>Surname, Firstname</code>。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>surname<span style=color:#bbb> </span><span style=color:#000;font-weight:700>||</span><span style=color:#bbb> </span><span style=color:#d14>&#39;, &#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>||</span><span style=color:#bbb> </span>firstname<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>2 按名称前缀查找设施</strong></p><p>问题描述：</p><p>查找名称以<code>Tennis</code>开头的所有设施。输出所有列。</p><p>问题答案：</p><p><code>LIKE</code>中<code>%</code>用于匹配任何字符串，而<code>_</code>用于匹配任何单个字符。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.facilities<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>name<span style=color:#bbb> </span><span style=color:#000;font-weight:700>LIKE</span><span style=color:#bbb> </span><span style=color:#d14>&#39;Tennis%&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>3 执行不区分大小写的搜索</strong></p><p>问题描述：</p><p>不区分大小写以查找名称以<code>tennis</code>开头的所有设施。输出所有列。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#998;font-style:italic>-- SQL标准写法
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.facilities<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>LOWER</span>(name)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>LIKE</span><span style=color:#bbb> </span><span style=color:#d14>&#39;tennis%&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- PostgreSQL独有，使用ILIKE
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.facilities<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>name<span style=color:#bbb> </span><span style=color:#000;font-weight:700>ILIKE</span><span style=color:#bbb> </span><span style=color:#d14>&#39;tennis%&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>4 查找带括号的电话号码</strong></p><p>问题描述：</p><p>您可能已经注意到俱乐部的会员表中的电话号码格式很不一致。查找所有包含括号的电话号码，返回会员 ID 和电话号码，按会员 ID 排序。</p><p>问题答案：</p><p>PostgreSQL 有三种字符串匹配方法：<code>LIKE</code>，<code>SIMILAR TO</code>，及 POSIX 正则表达式。</p><p><code>SIMILAR TO</code>与<code>LIKE</code>类似，只是其采用 SQL 正则表达式，是一种 LIKE 与 POSIX 正则表达式的结合体。<code>SIMILAR TO</code>不像常规正则表达式一样可以匹配子字符串，其与<code>LIKE</code>一样，想匹配成成功，必须匹配整个字符串。<code>SIMILAR TO</code>与<code>LIKE</code>一样，分别使用<code>_</code>及<code>%</code>表示任意单个字符及任意字符串，而<code>.</code>在<code>SIMILAR TO</code>中不表示任意单个字符。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#998;font-style:italic>-- 使用LIKE
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>memid,<span style=color:#bbb> </span>telephone<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>telephone<span style=color:#bbb> </span><span style=color:#000;font-weight:700>LIKE</span><span style=color:#bbb> </span><span style=color:#d14>&#39;(%)%&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- ~~与LIKE等价
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>memid,<span style=color:#bbb> </span>telephone<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>telephone<span style=color:#bbb> </span><span style=color:#000;font-weight:700>~~</span><span style=color:#bbb> </span><span style=color:#d14>&#39;(%)%&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- 使用SIMILAR TO
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>memid,<span style=color:#bbb> </span>telephone<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>telephone<span style=color:#bbb> </span><span style=color:#000;font-weight:700>SIMILAR</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>TO</span><span style=color:#bbb> </span><span style=color:#d14>&#39;\(%\)%&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- 采用POSIX正则表达式
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>memid,<span style=color:#bbb> </span>telephone<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>telephone<span style=color:#bbb> </span><span style=color:#000;font-weight:700>~</span><span style=color:#bbb> </span><span style=color:#d14>&#39;^\(\d*\)\s\d{3}-\d{4}$&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>5 用前导零填充邮政编码</strong></p><p>问题描述：</p><p>由于存储时<code>zipcode</code>为数值类型，我们示例数据集中的邮政编码已经从它们中删除了前导零。从成员表中检索所有邮政编码，用前导零填充任何少于 5 个字符的邮政编码。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#998;font-style:italic>-- 使用lpad函数
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>lpad(<span style=color:#000;font-weight:700>cast</span>(zipcode<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb> </span><span style=color:#0086b3>char</span>(<span style=color:#099>5</span>)),<span style=color:#bbb> </span><span style=color:#099>5</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;0&#39;</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- 使用tochar
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>to_char(zipcode,<span style=color:#bbb> </span><span style=color:#d14>&#39;FM09999&#39;</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>6 计算姓氏以每个字母开头的会员数量</strong></p><p>问题描述：</p><p>计算会员姓氏分别以各字母开头的数量。按字母排序，如果计数为 0，就不要打印这个字母。</p><p>问题答案：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#998;font-style:italic>-- 使用substr
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>substr(surname,<span style=color:#bbb> </span><span style=color:#099>1</span>,<span style=color:#bbb> </span><span style=color:#099>1</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>firstletter,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>count</span>(<span style=color:#000;font-weight:700>*</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>firstletter<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>firstletter;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- 使用left
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>left</span>(surname,<span style=color:#bbb> </span><span style=color:#099>1</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>firstletter,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>count</span>(<span style=color:#000;font-weight:700>*</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>firstletter<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>firstletter;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- 使用substring
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>substring</span>(surname<span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span><span style=color:#d14>&#39;#&#34;_#&#34;%&#39;</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>FOR</span><span style=color:#bbb> </span><span style=color:#d14>&#39;#&#39;</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>firstletter,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>count</span>(<span style=color:#000;font-weight:700>*</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>firstletter<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>firstletter;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>7 清理电话号码</strong></p><p>问题描述：</p><p>数据库中的电话号码格式非常不一致。您想打印会员 ID 和删除&rsquo;-&rsquo;、&rsquo;(&rsquo;、&rsquo;)&rsquo;，及&rsquo; &lsquo;字符后的号码。按会员 ID 排序。</p><p>问题答案：</p><p>使用 regexp_replace 函数实现。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>memid,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>regexp_replace(telephone,<span style=color:#bbb> </span><span style=color:#d14>&#39;[\s\-\(\)]&#39;</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;&#39;</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;g&#39;</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>memid;<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=7-递归查询>7 递归查询</h3><p>本栏目涉及递归查询。在 PostgreSQL，可以使用<code>WITH RECURSIVE</code>进行递归查询。这对处理树和图结构数据非常实用。详情请参阅<a href=https://www.postgresql.org/docs/current/queries-with.html>WITH Queries</a>。</p><p><strong>1 追溯会员的上游推荐链</strong></p><p>问题描述：</p><p>寻找会员 ID 为 27 的上游推荐链：即寻找会员 ID 为 27 的推荐人，会员 ID 为 27 的推荐人的推荐人，以此类推。返回会员 ID、名字和姓氏。</p><p>问题答案：</p><p>使用<code>WITH RECURSIVE</code>表达式实现。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>WITH</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>RECURSIVE</span><span style=color:#bbb> </span>recommenders(id)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>recommendedby<span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>27</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>UNION</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>ALL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>recommendedby<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span>m,<span style=color:#bbb> </span>recommenders<span style=color:#bbb> </span>r<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>m.memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>r.id<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>r.id,<span style=color:#bbb> </span>m.firstname,<span style=color:#bbb> </span>m.surname<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>recommenders<span style=color:#bbb> </span>r,<span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span>m<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>r.id<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>m.memid;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>2 追溯会员的下游推荐链</strong></p><p>问题描述：</p><p>寻找会员 ID 为 1 的下游推荐链：即寻找 ID 为 1 的会员推荐了哪些人，ID 为 1 的会员推荐的这些人又推荐了哪些人，以此类推。返回会员 ID、名字和姓氏，按会员 ID 排序。</p><p>问题答案：</p><p>使用<code>WITH RECURSIVE</code>表达式实现。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>WITH</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>RECURSIVE</span><span style=color:#bbb> </span>recommendeds(id)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>memid<span style=color:#bbb> </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>recommendedby<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>UNION</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>ALL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>m.memid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span>m,<span style=color:#bbb> </span>recommendeds<span style=color:#bbb> </span>r<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>m.recommendedby<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>r.id<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>SELECT</span><span style=color:#bbb> </span>r.id,<span style=color:#bbb> </span>m.firstname,<span style=color:#bbb> </span>m.surname<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>recommendeds<span style=color:#bbb> </span>r,<span style=color:#bbb> </span>cd.members<span style=color:#bbb> </span>m<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>r.id<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>m.memid<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>id;<span style=color:#bbb>
</span></span></span></code></pre></div><blockquote><p>参考资料</p><p>[1]<a href=https://pgexercises.com/>postgresql exercises</a></p><p>[2]<a href=https://www.postgresql.org/docs/current/functions-datetime.html>postgresql date/time functions and operators</a></p><p>[3]<a href=https://www.postgresql.org/docs/current/functions-matching.html>postgresql pattern matching</a></p><p>[4]<a href=https://www.postgresql.org/docs/current/queries-with.html>postgresql with queries (common table expressions)</a></p></blockquote></div><div class=content-footer><div class=weixinhao><img src=/static/images/self/weixinhao-white.jpg></div><div class=post-tags><a href=/tags/postgresql/>#PostgreSQL</a></div><div class=license><i class=ti-info-alt></i><div class=info>版权声明：该博客文章由作者通过「<a href=https://creativecommons.org/licenses/by/4.0/deed.zh>知识共享署名 4.0 许可证</a>」进行授权，转载须注明文章原始链接。</div></div></div></div><div class="col-lg-8 mx-auto block shadow"><h3>相关文章</h3><ul><li><a href=/posts/postgres-getting-started.html>PostgreSQL 初探</a></li><li><a href=/posts/install-postgres-on-centos-from-source.html>在 CentOS 上以源码安装 PostgreSQL</a></li><li><a href=/posts/postgres-jdbc-driver-issue.html>PostgreSQL JDBC Driver 42.3.0 读取 BigDecimal 时发生抹 0 的 Bug</a></li><li><a href=/posts/postgres-ddl.html>PostgreSQL 数据定义相关知识总结</a></li><li><a href=/posts/postgres-table-partitioning.html>PostgreSQL 表分区使用详解</a></li></ul></div><div class="col-lg-8 mx-auto block shadow"><div><h3>评论</h3><div id=comment-loading style=text-align:center;font-size:14px><img style=width:52px src=/static/images/site/mona-loading-default.gif>
<span>正在加载评论......</span></div><script>function handleMessage(e){if(e.origin!=="https://giscus.app")return;if(typeof e.data!="object"||!e.data.giscus)return;const t=document.getElementById("comment-loading");t.style.display="none"}window.addEventListener("message",handleMessage)</script><script src=https://giscus.app/client.js data-repo=leileiluoluo/leileiluoluo.github.io data-repo-id=R_kgDOJkLT8w data-category=General data-category-id=DIC_kwDOJkLT884CdtEh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></div></div></section><footer class="py-4 bg-lights border-top"><div class=container><div class="row justify-content-between text-center align-items-center"><div class="col-lg-4 text-center text-lg-left mb-4 mb-lg-0"></div><div class="col-lg-4 text-center mb-4 mb-lg-0"><ul class="list-inline mb-0"><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/sponsor>随喜打赏</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/about>关于本博</a></li><li class=list-inline-item><a class="text-dark d-block p-2" href=https://leileiluoluo.github.io/links>友情链接</a></li></ul></div><div class="col-lg-4 text-lg-right text-center mb-4 mb-lg-0"><ul class="list-inline social-icon mb-0"><li class=list-inline-item><a title=文章归档 href=/archives/><i class=ti-archive></i></a></li><li class=list-inline-item><a title=文章标签 href=/tags/><i class=ti-tag></i></a></li><li class=list-inline-item><a title="我的 GitHub" href=https://github.com/leileiluoluo><i class=ti-github></i></a></li><li class=list-inline-item><a title="网站 RSS" href=/index.xml><i class=ti-rss></i></a></li></ul></div></div><div style=text-align:center;font-size:18px;margin-bottom:22px><a style="-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-image:linear-gradient(to right,#14100f,#d55b5b,#4d14e6)" href=https://www.boyouquan.com/planet-shuttle>「博友圈 · 星球穿梭」</a></div><div class="text-center mt-4"><span>Made with <a href=https://gohugo.io/>Hugo</a> | Theme by <a href=https://github.com/themefisher/northendlab-hugo>NorthendLab</a> | <a href=https://beian.miit.gov.cn>辽ICP备2022012085号-5</a> | Copyright © 2017-2024</span></div></div></footer><script>var indexURL="https://leileiluoluo.github.io/index.json"</script><script src=https://leileiluoluo.github.io/js/jquery.min.js></script><script src=https://leileiluoluo.github.io/js/bootstrap.min.js></script><script src=https://leileiluoluo.github.io/js/fuse.min.js></script><script src=https://leileiluoluo.github.io/js/mark.js></script><script src=https://leileiluoluo.github.io/js/search.js></script><script src=https://leileiluoluo.github.io/js/script.min.js></script></body></html>